import{T as Bl,a as Zo,b as qa,L as Xa,c as un,F as Qn,M as as,V as xt,C as os,d as is,S as ps,e as jl,P as zs,D as hs,f as Hs,g as Pe,I as Ya,Q as wn,h as zl,O as Ja,i as Vl,j as Kl,B as dn,k as Wl,l as Za,N as ql,m as Xl,n as Yl,o as Qo,p as Qa,R as ei,q as Jl,r as Zl,s as Ql,t as Po,u as er,v as kt,w as Ds,x as Bt,y as ec,z as bi,A as tc,E as it,G as sc,H as tr,J as nc,K as oc,U as Xt,W as Rn,X as sr,Y as ic,Z as ac,_ as rc,$ as lc,a0 as cc,a1 as nr,a2 as uc,a3 as Bi,a4 as ji,a5 as zi,a6 as Vi,a7 as ti,a8 as dc,a9 as fc,aa as wt,ab as hc,ac as pc,ad as qt,ae as fo,af as ho,ag as po,ah as mc,ai as gc,aj as Ks,ak as Vs,al as Ki,am as _c,an as or,ao as Vn,ap as Wi,aq as qi,ar as yc,as as vc}from"./three-CMa1BHJO.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=s(o);fetch(o.href,i)}})();const bc="debug";function f(...e){switch(bc){case"debug":console.log(...e);break}}/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function wi(e){const t=Object.create(null);for(const s of e.split(","))t[s]=1;return s=>s in t}const Ve={},Ws=[],Yt=()=>{},ir=()=>!1,mo=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Si=e=>e.startsWith("onUpdate:"),ft=Object.assign,Ti=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},wc=Object.prototype.hasOwnProperty,Ne=(e,t)=>wc.call(e,t),ge=Array.isArray,qs=e=>go(e)==="[object Map]",ar=e=>go(e)==="[object Set]",ye=e=>typeof e=="function",ot=e=>typeof e=="string",Es=e=>typeof e=="symbol",Xe=e=>e!==null&&typeof e=="object",rr=e=>(Xe(e)||ye(e))&&ye(e.then)&&ye(e.catch),lr=Object.prototype.toString,go=e=>lr.call(e),Sc=e=>go(e).slice(8,-1),cr=e=>go(e)==="[object Object]",Ai=e=>ot(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,fn=wi(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),_o=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},Tc=/-\w/g,Ms=_o(e=>e.replace(Tc,t=>t.slice(1).toUpperCase())),Ac=/\B([A-Z])/g,Fs=_o(e=>e.replace(Ac,"-$1").toLowerCase()),ur=_o(e=>e.charAt(0).toUpperCase()+e.slice(1)),Lo=_o(e=>e?`on${ur(e)}`:""),As=(e,t)=>!Object.is(e,t),Io=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},dr=(e,t,s,n=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:n,value:s})},Mc=e=>{const t=parseFloat(e);return isNaN(t)?e:t},Cc=e=>{const t=ot(e)?Number(e):NaN;return isNaN(t)?e:t};let Xi;const yo=()=>Xi||(Xi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function jt(e){if(ge(e)){const t={};for(let s=0;s<e.length;s++){const n=e[s],o=ot(n)?Rc(n):jt(n);if(o)for(const i in o)t[i]=o[i]}return t}else if(ot(e)||Xe(e))return e}const xc=/;(?![^(]*\))/g,Ec=/:([^]+)/,kc=/\/\*[^]*?\*\//g;function Rc(e){const t={};return e.replace(kc,"").split(xc).forEach(s=>{if(s){const n=s.split(Ec);n.length>1&&(t[n[0].trim()]=n[1].trim())}}),t}function nt(e){let t="";if(ot(e))t=e;else if(ge(e))for(let s=0;s<e.length;s++){const n=nt(e[s]);n&&(t+=n+" ")}else if(Xe(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const $c="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Pc=wi($c);function fr(e){return!!e||e===""}const hr=e=>!!(e&&e.__v_isRef===!0),ee=e=>ot(e)?e:e==null?"":ge(e)||Xe(e)&&(e.toString===lr||!ye(e.toString))?hr(e)?ee(e.value):JSON.stringify(e,pr,2):String(e),pr=(e,t)=>hr(t)?pr(e,t.value):qs(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[n,o],i)=>(s[Oo(n,i)+" =>"]=o,s),{})}:ar(t)?{[`Set(${t.size})`]:[...t.values()].map(s=>Oo(s))}:Es(t)?Oo(t):Xe(t)&&!ge(t)&&!cr(t)?String(t):t,Oo=(e,t="")=>{var s;return Es(e)?`Symbol(${(s=e.description)!=null?s:t})`:e};function Lc(e){return e==null?"initial":typeof e=="string"?e===""?" ":e:String(e)}/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Et;class Ic{constructor(t=!1){this.detached=t,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Et,!t&&Et&&(this.index=(Et.scopes||(Et.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].pause();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].resume();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].resume()}}run(t){if(this._active){const s=Et;try{return Et=this,t()}finally{Et=s}}}on(){++this._on===1&&(this.prevScope=Et,Et=this)}off(){this._on>0&&--this._on===0&&(Et=this.prevScope,this.prevScope=void 0)}stop(t){if(this._active){this._active=!1;let s,n;for(s=0,n=this.effects.length;s<n;s++)this.effects[s].stop();for(this.effects.length=0,s=0,n=this.cleanups.length;s<n;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,n=this.scopes.length;s<n;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const o=this.parent.scopes.pop();o&&o!==this&&(this.parent.scopes[this.index]=o,o.index=this.index)}this.parent=void 0}}}function Oc(){return Et}let We;const Do=new WeakSet;class mr{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Et&&Et.active&&Et.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Do.has(this)&&(Do.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||_r(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Yi(this),yr(this);const t=We,s=Jt;We=this,Jt=!0;try{return this.fn()}finally{vr(this),We=t,Jt=s,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)xi(t);this.deps=this.depsTail=void 0,Yi(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Do.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){si(this)&&this.run()}get dirty(){return si(this)}}let gr=0,hn,pn;function _r(e,t=!1){if(e.flags|=8,t){e.next=pn,pn=e;return}e.next=hn,hn=e}function Mi(){gr++}function Ci(){if(--gr>0)return;if(pn){let t=pn;for(pn=void 0;t;){const s=t.next;t.next=void 0,t.flags&=-9,t=s}}let e;for(;hn;){let t=hn;for(hn=void 0;t;){const s=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(n){e||(e=n)}t=s}}if(e)throw e}function yr(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function vr(e){let t,s=e.depsTail,n=s;for(;n;){const o=n.prevDep;n.version===-1?(n===s&&(s=o),xi(n),Dc(n)):t=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=o}e.deps=t,e.depsTail=s}function si(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(br(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function br(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Sn)||(e.globalVersion=Sn,!e.isSSR&&e.flags&128&&(!e.deps&&!e._dirty||!si(e))))return;e.flags|=2;const t=e.dep,s=We,n=Jt;We=e,Jt=!0;try{yr(e);const o=e.fn(e._value);(t.version===0||As(o,e._value))&&(e.flags|=128,e._value=o,t.version++)}catch(o){throw t.version++,o}finally{We=s,Jt=n,vr(e),e.flags&=-3}}function xi(e,t=!1){const{dep:s,prevSub:n,nextSub:o}=e;if(n&&(n.nextSub=o,e.prevSub=void 0),o&&(o.prevSub=n,e.nextSub=void 0),s.subs===e&&(s.subs=n,!n&&s.computed)){s.computed.flags&=-5;for(let i=s.computed.deps;i;i=i.nextDep)xi(i,!0)}!t&&!--s.sc&&s.map&&s.map.delete(s.key)}function Dc(e){const{prevDep:t,nextDep:s}=e;t&&(t.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=t,e.nextDep=void 0)}let Jt=!0;const wr=[];function ms(){wr.push(Jt),Jt=!1}function gs(){const e=wr.pop();Jt=e===void 0?!0:e}function Yi(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const s=We;We=void 0;try{t()}finally{We=s}}}let Sn=0;class Nc{constructor(t,s){this.sub=t,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Ei{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(t){if(!We||!Jt||We===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==We)s=this.activeLink=new Nc(We,this),We.deps?(s.prevDep=We.depsTail,We.depsTail.nextDep=s,We.depsTail=s):We.deps=We.depsTail=s,Sr(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const n=s.nextDep;n.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=n),s.prevDep=We.depsTail,s.nextDep=void 0,We.depsTail.nextDep=s,We.depsTail=s,We.deps===s&&(We.deps=n)}return s}trigger(t){this.version++,Sn++,this.notify(t)}notify(t){Mi();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{Ci()}}}function Sr(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let n=t.deps;n;n=n.nextDep)Sr(n)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const ni=new WeakMap,Gs=Symbol(""),oi=Symbol(""),Tn=Symbol("");function mt(e,t,s){if(Jt&&We){let n=ni.get(e);n||ni.set(e,n=new Map);let o=n.get(s);o||(n.set(s,o=new Ei),o.map=n,o.key=s),o.track()}}function ds(e,t,s,n,o,i){const a=ni.get(e);if(!a){Sn++;return}const r=l=>{l&&l.trigger()};if(Mi(),t==="clear")a.forEach(r);else{const l=ge(e),u=l&&Ai(s);if(l&&s==="length"){const c=Number(n);a.forEach((d,p)=>{(p==="length"||p===Tn||!Es(p)&&p>=c)&&r(d)})}else switch((s!==void 0||a.has(void 0))&&r(a.get(s)),u&&r(a.get(Tn)),t){case"add":l?u&&r(a.get("length")):(r(a.get(Gs)),qs(e)&&r(a.get(oi)));break;case"delete":l||(r(a.get(Gs)),qs(e)&&r(a.get(oi)));break;case"set":qs(e)&&r(a.get(Gs));break}}Ci()}function Bs(e){const t=Oe(e);return t===e?t:(mt(t,"iterate",Tn),Wt(e)?t:t.map(dt))}function vo(e){return mt(e=Oe(e),"iterate",Tn),e}const Hc={__proto__:null,[Symbol.iterator](){return No(this,Symbol.iterator,dt)},concat(...e){return Bs(this).concat(...e.map(t=>ge(t)?Bs(t):t))},entries(){return No(this,"entries",e=>(e[1]=dt(e[1]),e))},every(e,t){return rs(this,"every",e,t,void 0,arguments)},filter(e,t){return rs(this,"filter",e,t,s=>s.map(dt),arguments)},find(e,t){return rs(this,"find",e,t,dt,arguments)},findIndex(e,t){return rs(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return rs(this,"findLast",e,t,dt,arguments)},findLastIndex(e,t){return rs(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return rs(this,"forEach",e,t,void 0,arguments)},includes(...e){return Ho(this,"includes",e)},indexOf(...e){return Ho(this,"indexOf",e)},join(e){return Bs(this).join(e)},lastIndexOf(...e){return Ho(this,"lastIndexOf",e)},map(e,t){return rs(this,"map",e,t,void 0,arguments)},pop(){return on(this,"pop")},push(...e){return on(this,"push",e)},reduce(e,...t){return Ji(this,"reduce",e,t)},reduceRight(e,...t){return Ji(this,"reduceRight",e,t)},shift(){return on(this,"shift")},some(e,t){return rs(this,"some",e,t,void 0,arguments)},splice(...e){return on(this,"splice",e)},toReversed(){return Bs(this).toReversed()},toSorted(e){return Bs(this).toSorted(e)},toSpliced(...e){return Bs(this).toSpliced(...e)},unshift(...e){return on(this,"unshift",e)},values(){return No(this,"values",dt)}};function No(e,t,s){const n=vo(e),o=n[t]();return n!==e&&!Wt(e)&&(o._next=o.next,o.next=()=>{const i=o._next();return i.done||(i.value=s(i.value)),i}),o}const Gc=Array.prototype;function rs(e,t,s,n,o,i){const a=vo(e),r=a!==e&&!Wt(e),l=a[t];if(l!==Gc[t]){const d=l.apply(e,i);return r?dt(d):d}let u=s;a!==e&&(r?u=function(d,p){return s.call(this,dt(d),p,e)}:s.length>2&&(u=function(d,p){return s.call(this,d,p,e)}));const c=l.call(a,u,n);return r&&o?o(c):c}function Ji(e,t,s,n){const o=vo(e);let i=s;return o!==e&&(Wt(e)?s.length>3&&(i=function(a,r,l){return s.call(this,a,r,l,e)}):i=function(a,r,l){return s.call(this,a,dt(r),l,e)}),o[t](i,...n)}function Ho(e,t,s){const n=Oe(e);mt(n,"iterate",Tn);const o=n[t](...s);return(o===-1||o===!1)&&Pi(s[0])?(s[0]=Oe(s[0]),n[t](...s)):o}function on(e,t,s=[]){ms(),Mi();const n=Oe(e)[t].apply(e,s);return Ci(),gs(),n}const Fc=wi("__proto__,__v_isRef,__isVue"),Tr=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Es));function Uc(e){Es(e)||(e=String(e));const t=Oe(this);return mt(t,"has",e),t.hasOwnProperty(e)}class Ar{constructor(t=!1,s=!1){this._isReadonly=t,this._isShallow=s}get(t,s,n){if(s==="__v_skip")return t.__v_skip;const o=this._isReadonly,i=this._isShallow;if(s==="__v_isReactive")return!o;if(s==="__v_isReadonly")return o;if(s==="__v_isShallow")return i;if(s==="__v_raw")return n===(o?i?Jc:Er:i?xr:Cr).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const a=ge(t);if(!o){let l;if(a&&(l=Hc[s]))return l;if(s==="hasOwnProperty")return Uc}const r=Reflect.get(t,s,gt(t)?t:n);if((Es(s)?Tr.has(s):Fc(s))||(o||mt(t,"get",s),i))return r;if(gt(r)){const l=a&&Ai(s)?r:r.value;return o&&Xe(l)?ai(l):l}return Xe(r)?o?ai(r):Ri(r):r}}class Mr extends Ar{constructor(t=!1){super(!1,t)}set(t,s,n,o){let i=t[s];if(!this._isShallow){const l=Cs(i);if(!Wt(n)&&!Cs(n)&&(i=Oe(i),n=Oe(n)),!ge(t)&&gt(i)&&!gt(n))return l||(i.value=n),!0}const a=ge(t)&&Ai(s)?Number(s)<t.length:Ne(t,s),r=Reflect.set(t,s,n,gt(t)?t:o);return t===Oe(o)&&(a?As(n,i)&&ds(t,"set",s,n):ds(t,"add",s,n)),r}deleteProperty(t,s){const n=Ne(t,s);t[s];const o=Reflect.deleteProperty(t,s);return o&&n&&ds(t,"delete",s,void 0),o}has(t,s){const n=Reflect.has(t,s);return(!Es(s)||!Tr.has(s))&&mt(t,"has",s),n}ownKeys(t){return mt(t,"iterate",ge(t)?"length":Gs),Reflect.ownKeys(t)}}class Bc extends Ar{constructor(t=!1){super(!0,t)}set(t,s){return!0}deleteProperty(t,s){return!0}}const jc=new Mr,zc=new Bc,Vc=new Mr(!0);const ii=e=>e,Nn=e=>Reflect.getPrototypeOf(e);function Kc(e,t,s){return function(...n){const o=this.__v_raw,i=Oe(o),a=qs(i),r=e==="entries"||e===Symbol.iterator&&a,l=e==="keys"&&a,u=o[e](...n),c=s?ii:t?eo:dt;return!t&&mt(i,"iterate",l?oi:Gs),{next(){const{value:d,done:p}=u.next();return p?{value:d,done:p}:{value:r?[c(d[0]),c(d[1])]:c(d),done:p}},[Symbol.iterator](){return this}}}}function Hn(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function Wc(e,t){const s={get(o){const i=this.__v_raw,a=Oe(i),r=Oe(o);e||(As(o,r)&&mt(a,"get",o),mt(a,"get",r));const{has:l}=Nn(a),u=t?ii:e?eo:dt;if(l.call(a,o))return u(i.get(o));if(l.call(a,r))return u(i.get(r));i!==a&&i.get(o)},get size(){const o=this.__v_raw;return!e&&mt(Oe(o),"iterate",Gs),o.size},has(o){const i=this.__v_raw,a=Oe(i),r=Oe(o);return e||(As(o,r)&&mt(a,"has",o),mt(a,"has",r)),o===r?i.has(o):i.has(o)||i.has(r)},forEach(o,i){const a=this,r=a.__v_raw,l=Oe(r),u=t?ii:e?eo:dt;return!e&&mt(l,"iterate",Gs),r.forEach((c,d)=>o.call(i,u(c),u(d),a))}};return ft(s,e?{add:Hn("add"),set:Hn("set"),delete:Hn("delete"),clear:Hn("clear")}:{add(o){!t&&!Wt(o)&&!Cs(o)&&(o=Oe(o));const i=Oe(this);return Nn(i).has.call(i,o)||(i.add(o),ds(i,"add",o,o)),this},set(o,i){!t&&!Wt(i)&&!Cs(i)&&(i=Oe(i));const a=Oe(this),{has:r,get:l}=Nn(a);let u=r.call(a,o);u||(o=Oe(o),u=r.call(a,o));const c=l.call(a,o);return a.set(o,i),u?As(i,c)&&ds(a,"set",o,i):ds(a,"add",o,i),this},delete(o){const i=Oe(this),{has:a,get:r}=Nn(i);let l=a.call(i,o);l||(o=Oe(o),l=a.call(i,o)),r&&r.call(i,o);const u=i.delete(o);return l&&ds(i,"delete",o,void 0),u},clear(){const o=Oe(this),i=o.size!==0,a=o.clear();return i&&ds(o,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(o=>{s[o]=Kc(o,e,t)}),s}function ki(e,t){const s=Wc(e,t);return(n,o,i)=>o==="__v_isReactive"?!e:o==="__v_isReadonly"?e:o==="__v_raw"?n:Reflect.get(Ne(s,o)&&o in n?s:n,o,i)}const qc={get:ki(!1,!1)},Xc={get:ki(!1,!0)},Yc={get:ki(!0,!1)};const Cr=new WeakMap,xr=new WeakMap,Er=new WeakMap,Jc=new WeakMap;function Zc(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Qc(e){return e.__v_skip||!Object.isExtensible(e)?0:Zc(Sc(e))}function Ri(e){return Cs(e)?e:$i(e,!1,jc,qc,Cr)}function eu(e){return $i(e,!1,Vc,Xc,xr)}function ai(e){return $i(e,!0,zc,Yc,Er)}function $i(e,t,s,n,o){if(!Xe(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const i=Qc(e);if(i===0)return e;const a=o.get(e);if(a)return a;const r=new Proxy(e,i===2?n:s);return o.set(e,r),r}function Xs(e){return Cs(e)?Xs(e.__v_raw):!!(e&&e.__v_isReactive)}function Cs(e){return!!(e&&e.__v_isReadonly)}function Wt(e){return!!(e&&e.__v_isShallow)}function Pi(e){return e?!!e.__v_raw:!1}function Oe(e){const t=e&&e.__v_raw;return t?Oe(t):e}function tu(e){return!Ne(e,"__v_skip")&&Object.isExtensible(e)&&dr(e,"__v_skip",!0),e}const dt=e=>Xe(e)?Ri(e):e,eo=e=>Xe(e)?ai(e):e;function gt(e){return e?e.__v_isRef===!0:!1}function Z(e){return su(e,!1)}function su(e,t){return gt(e)?e:new nu(e,t)}class nu{constructor(t,s){this.dep=new Ei,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?t:Oe(t),this._value=s?t:dt(t),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(t){const s=this._rawValue,n=this.__v_isShallow||Wt(t)||Cs(t);t=n?t:Oe(t),As(t,s)&&(this._rawValue=t,this._value=n?t:dt(t),this.dep.trigger())}}function Ae(e){return gt(e)?e.value:e}const ou={get:(e,t,s)=>t==="__v_raw"?e:Ae(Reflect.get(e,t,s)),set:(e,t,s,n)=>{const o=e[t];return gt(o)&&!gt(s)?(o.value=s,!0):Reflect.set(e,t,s,n)}};function kr(e){return Xs(e)?e:new Proxy(e,ou)}class iu{constructor(t,s,n){this.fn=t,this.setter=s,this._value=void 0,this.dep=new Ei(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Sn-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&We!==this)return _r(this,!0),!0}get value(){const t=this.dep.track();return br(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function au(e,t,s=!1){let n,o;return ye(e)?n=e:(n=e.get,o=e.set),new iu(n,o,s)}const Gn={},to=new WeakMap;let Os;function ru(e,t=!1,s=Os){if(s){let n=to.get(s);n||to.set(s,n=[]),n.push(e)}}function lu(e,t,s=Ve){const{immediate:n,deep:o,once:i,scheduler:a,augmentJob:r,call:l}=s,u=M=>o?M:Wt(M)||o===!1||o===0?fs(M,1):fs(M);let c,d,p,m,g=!1,v=!1;if(gt(e)?(d=()=>e.value,g=Wt(e)):Xs(e)?(d=()=>u(e),g=!0):ge(e)?(v=!0,g=e.some(M=>Xs(M)||Wt(M)),d=()=>e.map(M=>{if(gt(M))return M.value;if(Xs(M))return u(M);if(ye(M))return l?l(M,2):M()})):ye(e)?t?d=l?()=>l(e,2):e:d=()=>{if(p){ms();try{p()}finally{gs()}}const M=Os;Os=c;try{return l?l(e,3,[m]):e(m)}finally{Os=M}}:d=Yt,t&&o){const M=d,F=o===!0?1/0:o;d=()=>fs(M(),F)}const y=Oc(),$=()=>{c.stop(),y&&y.active&&Ti(y.effects,c)};if(i&&t){const M=t;t=(...F)=>{M(...F),$()}}let C=v?new Array(e.length).fill(Gn):Gn;const S=M=>{if(!(!(c.flags&1)||!c.dirty&&!M))if(t){const F=c.run();if(o||g||(v?F.some((X,Y)=>As(X,C[Y])):As(F,C))){p&&p();const X=Os;Os=c;try{const Y=[F,C===Gn?void 0:v&&C[0]===Gn?[]:C,m];C=F,l?l(t,3,Y):t(...Y)}finally{Os=X}}}else c.run()};return r&&r(S),c=new mr(d),c.scheduler=a?()=>a(S,!1):S,m=M=>ru(M,!1,c),p=c.onStop=()=>{const M=to.get(c);if(M){if(l)l(M,4);else for(const F of M)F();to.delete(c)}},t?n?S(!0):C=c.run():a?a(S.bind(null,!0),!0):c.run(),$.pause=c.pause.bind(c),$.resume=c.resume.bind(c),$.stop=$,$}function fs(e,t=1/0,s){if(t<=0||!Xe(e)||e.__v_skip||(s=s||new Map,(s.get(e)||0)>=t))return e;if(s.set(e,t),t--,gt(e))fs(e.value,t,s);else if(ge(e))for(let n=0;n<e.length;n++)fs(e[n],t,s);else if(ar(e)||qs(e))e.forEach(n=>{fs(n,t,s)});else if(cr(e)){for(const n in e)fs(e[n],t,s);for(const n of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,n)&&fs(e[n],t,s)}return e}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function $n(e,t,s,n){try{return n?e(...n):e()}catch(o){bo(o,t,s)}}function Zt(e,t,s,n){if(ye(e)){const o=$n(e,t,s,n);return o&&rr(o)&&o.catch(i=>{bo(i,t,s)}),o}if(ge(e)){const o=[];for(let i=0;i<e.length;i++)o.push(Zt(e[i],t,s,n));return o}}function bo(e,t,s,n=!0){const o=t?t.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:a}=t&&t.appContext.config||Ve;if(t){let r=t.parent;const l=t.proxy,u=`https://vuejs.org/error-reference/#runtime-${s}`;for(;r;){const c=r.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](e,l,u)===!1)return}r=r.parent}if(i){ms(),$n(i,null,10,[e,l,u]),gs();return}}cu(e,s,o,n,a)}function cu(e,t,s,n=!0,o=!1){if(o)throw e;console.error(e)}const St=[];let es=-1;const Ys=[];let Ss=null,js=0;const Rr=Promise.resolve();let so=null;function An(e){const t=so||Rr;return e?t.then(this?e.bind(this):e):t}function uu(e){let t=es+1,s=St.length;for(;t<s;){const n=t+s>>>1,o=St[n],i=Mn(o);i<e||i===e&&o.flags&2?t=n+1:s=n}return t}function Li(e){if(!(e.flags&1)){const t=Mn(e),s=St[St.length-1];!s||!(e.flags&2)&&t>=Mn(s)?St.push(e):St.splice(uu(t),0,e),e.flags|=1,$r()}}function $r(){so||(so=Rr.then(Ir))}function Pr(e){ge(e)?Ys.push(...e):Ss&&e.id===-1?Ss.splice(js+1,0,e):e.flags&1||(Ys.push(e),e.flags|=1),$r()}function Zi(e,t,s=es+1){for(;s<St.length;s++){const n=St[s];if(n&&n.flags&2){if(e&&n.id!==e.uid)continue;St.splice(s,1),s--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function Lr(e){if(Ys.length){const t=[...new Set(Ys)].sort((s,n)=>Mn(s)-Mn(n));if(Ys.length=0,Ss){Ss.push(...t);return}for(Ss=t,js=0;js<Ss.length;js++){const s=Ss[js];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}Ss=null,js=0}}const Mn=e=>e.id==null?e.flags&2?-1:1/0:e.id;function Ir(e){try{for(es=0;es<St.length;es++){const t=St[es];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),$n(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;es<St.length;es++){const t=St[es];t&&(t.flags&=-2)}es=-1,St.length=0,Lr(),so=null,(St.length||Ys.length)&&Ir()}}let zt=null,Or=null;function no(e){const t=zt;return zt=e,Or=e&&e.type.__scopeId||null,t}function Dr(e,t=zt,s){if(!t||e._n)return e;const n=(...o)=>{n._d&&ao(-1);const i=no(t);let a;try{a=e(...o)}finally{no(i),n._d&&ao(1)}return a};return n._n=!0,n._c=!0,n._d=!0,n}function Nr(e,t){if(zt===null)return e;const s=Mo(zt),n=e.dirs||(e.dirs=[]);for(let o=0;o<t.length;o++){let[i,a,r,l=Ve]=t[o];i&&(ye(i)&&(i={mounted:i,updated:i}),i.deep&&fs(a),n.push({dir:i,instance:s,value:a,oldValue:void 0,arg:r,modifiers:l}))}return e}function Rs(e,t,s,n){const o=e.dirs,i=t&&t.dirs;for(let a=0;a<o.length;a++){const r=o[a];i&&(r.oldValue=i[a].value);let l=r.dir[n];l&&(ms(),Zt(l,s,8,[e.el,r,e,t]),gs())}}const Hr=Symbol("_vte"),Gr=e=>e.__isTeleport,mn=e=>e&&(e.disabled||e.disabled===""),Qi=e=>e&&(e.defer||e.defer===""),ea=e=>typeof SVGElement<"u"&&e instanceof SVGElement,ta=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,ri=(e,t)=>{const s=e&&e.to;return ot(s)?t?t(s):null:s},Fr={name:"Teleport",__isTeleport:!0,process(e,t,s,n,o,i,a,r,l,u){const{mc:c,pc:d,pbc:p,o:{insert:m,querySelector:g,createText:v,createComment:y}}=u,$=mn(t.props);let{shapeFlag:C,children:S,dynamicChildren:M}=t;if(e==null){const F=t.el=v(""),X=t.anchor=v("");m(F,s,n),m(X,s,n);const Y=(R,V)=>{C&16&&c(S,R,V,o,i,a,r,l)},P=()=>{const R=t.target=ri(t.props,g),V=Br(R,t,v,m);R&&(a!=="svg"&&ea(R)?a="svg":a!=="mathml"&&ta(R)&&(a="mathml"),o&&o.isCE&&(o.ce._teleportTargets||(o.ce._teleportTargets=new Set)).add(R),$||(Y(R,V),Kn(t,!1)))};$&&(Y(s,X),Kn(t,!0)),Qi(t.props)?(t.el.__isMounted=!1,bt(()=>{P(),delete t.el.__isMounted},i)):P()}else{if(Qi(t.props)&&e.el.__isMounted===!1){bt(()=>{Fr.process(e,t,s,n,o,i,a,r,l,u)},i);return}t.el=e.el,t.targetStart=e.targetStart;const F=t.anchor=e.anchor,X=t.target=e.target,Y=t.targetAnchor=e.targetAnchor,P=mn(e.props),R=P?s:X,V=P?F:Y;if(a==="svg"||ea(X)?a="svg":(a==="mathml"||ta(X))&&(a="mathml"),M?(p(e.dynamicChildren,M,R,o,i,a,r),Ni(e,t,!0)):l||d(e,t,R,V,o,i,a,r,!1),$)P?t.props&&e.props&&t.props.to!==e.props.to&&(t.props.to=e.props.to):Fn(t,s,F,u,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const N=t.target=ri(t.props,g);N&&Fn(t,N,null,u,0)}else P&&Fn(t,X,Y,u,1);Kn(t,$)}},remove(e,t,s,{um:n,o:{remove:o}},i){const{shapeFlag:a,children:r,anchor:l,targetStart:u,targetAnchor:c,target:d,props:p}=e;if(d&&(o(u),o(c)),i&&o(l),a&16){const m=i||!mn(p);for(let g=0;g<r.length;g++){const v=r[g];n(v,t,s,m,!!v.dynamicChildren)}}},move:Fn,hydrate:du};function Fn(e,t,s,{o:{insert:n},m:o},i=2){i===0&&n(e.targetAnchor,t,s);const{el:a,anchor:r,shapeFlag:l,children:u,props:c}=e,d=i===2;if(d&&n(a,t,s),(!d||mn(c))&&l&16)for(let p=0;p<u.length;p++)o(u[p],t,s,2);d&&n(r,t,s)}function du(e,t,s,n,o,i,{o:{nextSibling:a,parentNode:r,querySelector:l,insert:u,createText:c}},d){function p(v,y,$,C){y.anchor=d(a(v),y,r(v),s,n,o,i),y.targetStart=$,y.targetAnchor=C}const m=t.target=ri(t.props,l),g=mn(t.props);if(m){const v=m._lpa||m.firstChild;if(t.shapeFlag&16)if(g)p(e,t,v,v&&a(v));else{t.anchor=a(e);let y=v;for(;y;){if(y&&y.nodeType===8){if(y.data==="teleport start anchor")t.targetStart=y;else if(y.data==="teleport anchor"){t.targetAnchor=y,m._lpa=t.targetAnchor&&a(t.targetAnchor);break}}y=a(y)}t.targetAnchor||Br(m,t,c,u),d(v&&a(v),t,m,s,n,o,i)}Kn(t,g)}else g&&t.shapeFlag&16&&p(e,t,e,a(e));return t.anchor&&a(t.anchor)}const Ur=Fr;function Kn(e,t){const s=e.ctx;if(s&&s.ut){let n,o;for(t?(n=e.el,o=e.anchor):(n=e.targetStart,o=e.targetAnchor);n&&n!==o;)n.nodeType===1&&n.setAttribute("data-v-owner",s.uid),n=n.nextSibling;s.ut()}}function Br(e,t,s,n){const o=t.targetStart=s(""),i=t.targetAnchor=s("");return o[Hr]=i,e&&(n(o,e),n(i,e)),i}const us=Symbol("_leaveCb"),Un=Symbol("_enterCb");function fu(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Rt(()=>{e.isMounted=!0}),ys(()=>{e.isUnmounting=!0}),e}const Ft=[Function,Array],jr={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ft,onEnter:Ft,onAfterEnter:Ft,onEnterCancelled:Ft,onBeforeLeave:Ft,onLeave:Ft,onAfterLeave:Ft,onLeaveCancelled:Ft,onBeforeAppear:Ft,onAppear:Ft,onAfterAppear:Ft,onAppearCancelled:Ft},zr=e=>{const t=e.subTree;return t.component?zr(t.component):t},hu={name:"BaseTransition",props:jr,setup(e,{slots:t}){const s=Gi(),n=fu();return()=>{const o=t.default&&Wr(t.default(),!0);if(!o||!o.length)return;const i=Vr(o),a=Oe(e),{mode:r}=a;if(n.isLeaving)return Go(i);const l=sa(i);if(!l)return Go(i);let u=li(l,a,n,s,d=>u=d);l.type!==Tt&&Cn(l,u);let c=s.subTree&&sa(s.subTree);if(c&&c.type!==Tt&&!Ns(c,l)&&zr(s).type!==Tt){let d=li(c,a,n,s);if(Cn(c,d),r==="out-in"&&l.type!==Tt)return n.isLeaving=!0,d.afterLeave=()=>{n.isLeaving=!1,s.job.flags&8||s.update(),delete d.afterLeave,c=void 0},Go(i);r==="in-out"&&l.type!==Tt?d.delayLeave=(p,m,g)=>{const v=Kr(n,c);v[String(c.key)]=c,p[us]=()=>{m(),p[us]=void 0,delete u.delayedLeave,c=void 0},u.delayedLeave=()=>{g(),delete u.delayedLeave,c=void 0}}:c=void 0}else c&&(c=void 0);return i}}};function Vr(e){let t=e[0];if(e.length>1){for(const s of e)if(s.type!==Tt){t=s;break}}return t}const pu=hu;function Kr(e,t){const{leavingVNodes:s}=e;let n=s.get(t.type);return n||(n=Object.create(null),s.set(t.type,n)),n}function li(e,t,s,n,o){const{appear:i,mode:a,persisted:r=!1,onBeforeEnter:l,onEnter:u,onAfterEnter:c,onEnterCancelled:d,onBeforeLeave:p,onLeave:m,onAfterLeave:g,onLeaveCancelled:v,onBeforeAppear:y,onAppear:$,onAfterAppear:C,onAppearCancelled:S}=t,M=String(e.key),F=Kr(s,e),X=(R,V)=>{R&&Zt(R,n,9,V)},Y=(R,V)=>{const N=V[1];X(R,V),ge(R)?R.every(b=>b.length<=1)&&N():R.length<=1&&N()},P={mode:a,persisted:r,beforeEnter(R){let V=l;if(!s.isMounted)if(i)V=y||l;else return;R[us]&&R[us](!0);const N=F[M];N&&Ns(e,N)&&N.el[us]&&N.el[us](),X(V,[R])},enter(R){let V=u,N=c,b=d;if(!s.isMounted)if(i)V=$||u,N=C||c,b=S||d;else return;let L=!1;const O=R[Un]=B=>{L||(L=!0,B?X(b,[R]):X(N,[R]),P.delayedLeave&&P.delayedLeave(),R[Un]=void 0)};V?Y(V,[R,O]):O()},leave(R,V){const N=String(e.key);if(R[Un]&&R[Un](!0),s.isUnmounting)return V();X(p,[R]);let b=!1;const L=R[us]=O=>{b||(b=!0,V(),O?X(v,[R]):X(g,[R]),R[us]=void 0,F[N]===e&&delete F[N])};F[N]=e,m?Y(m,[R,L]):L()},clone(R){const V=li(R,t,s,n,o);return o&&o(V),V}};return P}function Go(e){if(wo(e))return e=xs(e),e.children=null,e}function sa(e){if(!wo(e))return Gr(e.type)&&e.children?Vr(e.children):e;if(e.component)return e.component.subTree;const{shapeFlag:t,children:s}=e;if(s){if(t&16)return s[0];if(t&32&&ye(s.default))return s.default()}}function Cn(e,t){e.shapeFlag&6&&e.component?(e.transition=t,Cn(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Wr(e,t=!1,s){let n=[],o=0;for(let i=0;i<e.length;i++){let a=e[i];const r=s==null?a.key:String(s)+String(a.key!=null?a.key:i);a.type===Be?(a.patchFlag&128&&o++,n=n.concat(Wr(a.children,t,r))):(t||a.type!==Tt)&&n.push(r!=null?xs(a,{key:r}):a)}if(o>1)for(let i=0;i<n.length;i++)n[i].patchFlag=-2;return n}function qr(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}const oo=new WeakMap;function gn(e,t,s,n,o=!1){if(ge(e)){e.forEach((g,v)=>gn(g,t&&(ge(t)?t[v]:t),s,n,o));return}if(_n(n)&&!o){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&gn(e,t,s,n.component.subTree);return}const i=n.shapeFlag&4?Mo(n.component):n.el,a=o?null:i,{i:r,r:l}=e,u=t&&t.r,c=r.refs===Ve?r.refs={}:r.refs,d=r.setupState,p=Oe(d),m=d===Ve?ir:g=>Ne(p,g);if(u!=null&&u!==l){if(na(t),ot(u))c[u]=null,m(u)&&(d[u]=null);else if(gt(u)){u.value=null;const g=t;g.k&&(c[g.k]=null)}}if(ye(l))$n(l,r,12,[a,c]);else{const g=ot(l),v=gt(l);if(g||v){const y=()=>{if(e.f){const $=g?m(l)?d[l]:c[l]:l.value;if(o)ge($)&&Ti($,i);else if(ge($))$.includes(i)||$.push(i);else if(g)c[l]=[i],m(l)&&(d[l]=c[l]);else{const C=[i];l.value=C,e.k&&(c[e.k]=C)}}else g?(c[l]=a,m(l)&&(d[l]=a)):v&&(l.value=a,e.k&&(c[e.k]=a))};if(a){const $=()=>{y(),oo.delete(e)};$.id=-1,oo.set(e,$),bt($,s)}else na(e),y()}}}function na(e){const t=oo.get(e);t&&(t.flags|=8,oo.delete(e))}yo().requestIdleCallback;yo().cancelIdleCallback;const _n=e=>!!e.type.__asyncLoader,wo=e=>e.type.__isKeepAlive;function mu(e,t){Xr(e,"a",t)}function gu(e,t){Xr(e,"da",t)}function Xr(e,t,s=At){const n=e.__wdc||(e.__wdc=()=>{let o=s;for(;o;){if(o.isDeactivated)return;o=o.parent}return e()});if(So(t,n,s),s){let o=s.parent;for(;o&&o.parent;)wo(o.parent.vnode)&&_u(n,t,s,o),o=o.parent}}function _u(e,t,s,n){const o=So(t,e,n,!0);Ii(()=>{Ti(n[t],o)},s)}function So(e,t,s=At,n=!1){if(s){const o=s[e]||(s[e]=[]),i=t.__weh||(t.__weh=(...a)=>{ms();const r=Pn(s),l=Zt(t,s,e,a);return r(),gs(),l});return n?o.unshift(i):o.push(i),i}}const _s=e=>(t,s=At)=>{(!En||e==="sp")&&So(e,(...n)=>t(...n),s)},yu=_s("bm"),Rt=_s("m"),Yr=_s("bu"),vu=_s("u"),ys=_s("bum"),Ii=_s("um"),bu=_s("sp"),wu=_s("rtg"),Su=_s("rtc");function Tu(e,t=At){So("ec",e,t)}const Au=Symbol.for("v-ndc");function Dt(e,t,s,n){let o;const i=s,a=ge(e);if(a||ot(e)){const r=a&&Xs(e);let l=!1,u=!1;r&&(l=!Wt(e),u=Cs(e),e=vo(e)),o=new Array(e.length);for(let c=0,d=e.length;c<d;c++)o[c]=t(l?u?eo(dt(e[c])):dt(e[c]):e[c],c,void 0,i)}else if(typeof e=="number"){o=new Array(e);for(let r=0;r<e;r++)o[r]=t(r+1,r,void 0,i)}else if(Xe(e))if(e[Symbol.iterator])o=Array.from(e,(r,l)=>t(r,l,void 0,i));else{const r=Object.keys(e);o=new Array(r.length);for(let l=0,u=r.length;l<u;l++){const c=r[l];o[l]=t(e[c],c,l,i)}}else o=[];return o}const ci=e=>e?ml(e)?Mo(e):ci(e.parent):null,yn=ft(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>ci(e.parent),$root:e=>ci(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>Zr(e),$forceUpdate:e=>e.f||(e.f=()=>{Li(e.update)}),$nextTick:e=>e.n||(e.n=An.bind(e.proxy)),$watch:e=>Ku.bind(e)}),Fo=(e,t)=>e!==Ve&&!e.__isScriptSetup&&Ne(e,t),Mu={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:s,setupState:n,data:o,props:i,accessCache:a,type:r,appContext:l}=e;let u;if(t[0]!=="$"){const m=a[t];if(m!==void 0)switch(m){case 1:return n[t];case 2:return o[t];case 4:return s[t];case 3:return i[t]}else{if(Fo(n,t))return a[t]=1,n[t];if(o!==Ve&&Ne(o,t))return a[t]=2,o[t];if((u=e.propsOptions[0])&&Ne(u,t))return a[t]=3,i[t];if(s!==Ve&&Ne(s,t))return a[t]=4,s[t];ui&&(a[t]=0)}}const c=yn[t];let d,p;if(c)return t==="$attrs"&&mt(e.attrs,"get",""),c(e);if((d=r.__cssModules)&&(d=d[t]))return d;if(s!==Ve&&Ne(s,t))return a[t]=4,s[t];if(p=l.config.globalProperties,Ne(p,t))return p[t]},set({_:e},t,s){const{data:n,setupState:o,ctx:i}=e;return Fo(o,t)?(o[t]=s,!0):n!==Ve&&Ne(n,t)?(n[t]=s,!0):Ne(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(i[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:n,appContext:o,propsOptions:i,type:a}},r){let l,u;return!!(s[r]||e!==Ve&&r[0]!=="$"&&Ne(e,r)||Fo(t,r)||(l=i[0])&&Ne(l,r)||Ne(n,r)||Ne(yn,r)||Ne(o.config.globalProperties,r)||(u=a.__cssModules)&&u[r])},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:Ne(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function oa(e){return ge(e)?e.reduce((t,s)=>(t[s]=null,t),{}):e}let ui=!0;function Cu(e){const t=Zr(e),s=e.proxy,n=e.ctx;ui=!1,t.beforeCreate&&ia(t.beforeCreate,e,"bc");const{data:o,computed:i,methods:a,watch:r,provide:l,inject:u,created:c,beforeMount:d,mounted:p,beforeUpdate:m,updated:g,activated:v,deactivated:y,beforeDestroy:$,beforeUnmount:C,destroyed:S,unmounted:M,render:F,renderTracked:X,renderTriggered:Y,errorCaptured:P,serverPrefetch:R,expose:V,inheritAttrs:N,components:b,directives:L,filters:O}=t;if(u&&xu(u,n,null),a)for(const ae in a){const de=a[ae];ye(de)&&(n[ae]=de.bind(s))}if(o){const ae=o.call(s,s);Xe(ae)&&(e.data=Ri(ae))}if(ui=!0,i)for(const ae in i){const de=i[ae],xe=ye(de)?de.bind(s,s):ye(de.get)?de.get.bind(s,s):Yt,Ye=!ye(de)&&ye(de.set)?de.set.bind(s):Yt,H=ze({get:xe,set:Ye});Object.defineProperty(n,ae,{enumerable:!0,configurable:!0,get:()=>H.value,set:ce=>H.value=ce})}if(r)for(const ae in r)Jr(r[ae],n,s,ae);if(l){const ae=ye(l)?l.call(s):l;Reflect.ownKeys(ae).forEach(de=>{Lu(de,ae[de])})}c&&ia(c,e,"c");function ie(ae,de){ge(de)?de.forEach(xe=>ae(xe.bind(s))):de&&ae(de.bind(s))}if(ie(yu,d),ie(Rt,p),ie(Yr,m),ie(vu,g),ie(mu,v),ie(gu,y),ie(Tu,P),ie(Su,X),ie(wu,Y),ie(ys,C),ie(Ii,M),ie(bu,R),ge(V))if(V.length){const ae=e.exposed||(e.exposed={});V.forEach(de=>{Object.defineProperty(ae,de,{get:()=>s[de],set:xe=>s[de]=xe,enumerable:!0})})}else e.exposed||(e.exposed={});F&&e.render===Yt&&(e.render=F),N!=null&&(e.inheritAttrs=N),b&&(e.components=b),L&&(e.directives=L),R&&qr(e)}function xu(e,t,s=Yt){ge(e)&&(e=di(e));for(const n in e){const o=e[n];let i;Xe(o)?"default"in o?i=Wn(o.from||n,o.default,!0):i=Wn(o.from||n):i=Wn(o),gt(i)?Object.defineProperty(t,n,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):t[n]=i}}function ia(e,t,s){Zt(ge(e)?e.map(n=>n.bind(t.proxy)):e.bind(t.proxy),t,s)}function Jr(e,t,s,n){let o=n.includes(".")?ul(s,n):()=>s[n];if(ot(e)){const i=t[e];ye(i)&&Nt(o,i)}else if(ye(e))Nt(o,e.bind(s));else if(Xe(e))if(ge(e))e.forEach(i=>Jr(i,t,s,n));else{const i=ye(e.handler)?e.handler.bind(s):t[e.handler];ye(i)&&Nt(o,i,e)}}function Zr(e){const t=e.type,{mixins:s,extends:n}=t,{mixins:o,optionsCache:i,config:{optionMergeStrategies:a}}=e.appContext,r=i.get(t);let l;return r?l=r:!o.length&&!s&&!n?l=t:(l={},o.length&&o.forEach(u=>io(l,u,a,!0)),io(l,t,a)),Xe(t)&&i.set(t,l),l}function io(e,t,s,n=!1){const{mixins:o,extends:i}=t;i&&io(e,i,s,!0),o&&o.forEach(a=>io(e,a,s,!0));for(const a in t)if(!(n&&a==="expose")){const r=Eu[a]||s&&s[a];e[a]=r?r(e[a],t[a]):t[a]}return e}const Eu={data:aa,props:ra,emits:ra,methods:cn,computed:cn,beforeCreate:vt,created:vt,beforeMount:vt,mounted:vt,beforeUpdate:vt,updated:vt,beforeDestroy:vt,beforeUnmount:vt,destroyed:vt,unmounted:vt,activated:vt,deactivated:vt,errorCaptured:vt,serverPrefetch:vt,components:cn,directives:cn,watch:Ru,provide:aa,inject:ku};function aa(e,t){return t?e?function(){return ft(ye(e)?e.call(this,this):e,ye(t)?t.call(this,this):t)}:t:e}function ku(e,t){return cn(di(e),di(t))}function di(e){if(ge(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function vt(e,t){return e?[...new Set([].concat(e,t))]:t}function cn(e,t){return e?ft(Object.create(null),e,t):t}function ra(e,t){return e?ge(e)&&ge(t)?[...new Set([...e,...t])]:ft(Object.create(null),oa(e),oa(t??{})):t}function Ru(e,t){if(!e)return t;if(!t)return e;const s=ft(Object.create(null),e);for(const n in t)s[n]=vt(e[n],t[n]);return s}function Qr(){return{app:null,config:{isNativeTag:ir,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let $u=0;function Pu(e,t){return function(n,o=null){ye(n)||(n=ft({},n)),o!=null&&!Xe(o)&&(o=null);const i=Qr(),a=new WeakSet,r=[];let l=!1;const u=i.app={_uid:$u++,_component:n,_props:o,_container:null,_context:i,_instance:null,version:pd,get config(){return i.config},set config(c){},use(c,...d){return a.has(c)||(c&&ye(c.install)?(a.add(c),c.install(u,...d)):ye(c)&&(a.add(c),c(u,...d))),u},mixin(c){return i.mixins.includes(c)||i.mixins.push(c),u},component(c,d){return d?(i.components[c]=d,u):i.components[c]},directive(c,d){return d?(i.directives[c]=d,u):i.directives[c]},mount(c,d,p){if(!l){const m=u._ceVNode||Qe(n,o);return m.appContext=i,p===!0?p="svg":p===!1&&(p=void 0),e(m,c,p),l=!0,u._container=c,c.__vue_app__=u,Mo(m.component)}},onUnmount(c){r.push(c)},unmount(){l&&(Zt(r,u._instance,16),e(null,u._container),delete u._container.__vue_app__)},provide(c,d){return i.provides[c]=d,u},runWithContext(c){const d=Js;Js=u;try{return c()}finally{Js=d}}};return u}}let Js=null;function Lu(e,t){if(At){let s=At.provides;const n=At.parent&&At.parent.provides;n===s&&(s=At.provides=Object.create(n)),s[e]=t}}function Wn(e,t,s=!1){const n=Gi();if(n||Js){let o=Js?Js._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(o&&e in o)return o[e];if(arguments.length>1)return s&&ye(t)?t.call(n&&n.proxy):t}}const el={},tl=()=>Object.create(el),sl=e=>Object.getPrototypeOf(e)===el;function Iu(e,t,s,n=!1){const o={},i=tl();e.propsDefaults=Object.create(null),nl(e,t,o,i);for(const a in e.propsOptions[0])a in o||(o[a]=void 0);s?e.props=n?o:eu(o):e.type.props?e.props=o:e.props=i,e.attrs=i}function Ou(e,t,s,n){const{props:o,attrs:i,vnode:{patchFlag:a}}=e,r=Oe(o),[l]=e.propsOptions;let u=!1;if((n||a>0)&&!(a&16)){if(a&8){const c=e.vnode.dynamicProps;for(let d=0;d<c.length;d++){let p=c[d];if(To(e.emitsOptions,p))continue;const m=t[p];if(l)if(Ne(i,p))m!==i[p]&&(i[p]=m,u=!0);else{const g=Ms(p);o[g]=fi(l,r,g,m,e,!1)}else m!==i[p]&&(i[p]=m,u=!0)}}}else{nl(e,t,o,i)&&(u=!0);let c;for(const d in r)(!t||!Ne(t,d)&&((c=Fs(d))===d||!Ne(t,c)))&&(l?s&&(s[d]!==void 0||s[c]!==void 0)&&(o[d]=fi(l,r,d,void 0,e,!0)):delete o[d]);if(i!==r)for(const d in i)(!t||!Ne(t,d))&&(delete i[d],u=!0)}u&&ds(e.attrs,"set","")}function nl(e,t,s,n){const[o,i]=e.propsOptions;let a=!1,r;if(t)for(let l in t){if(fn(l))continue;const u=t[l];let c;o&&Ne(o,c=Ms(l))?!i||!i.includes(c)?s[c]=u:(r||(r={}))[c]=u:To(e.emitsOptions,l)||(!(l in n)||u!==n[l])&&(n[l]=u,a=!0)}if(i){const l=Oe(s),u=r||Ve;for(let c=0;c<i.length;c++){const d=i[c];s[d]=fi(o,l,d,u[d],e,!Ne(u,d))}}return a}function fi(e,t,s,n,o,i){const a=e[s];if(a!=null){const r=Ne(a,"default");if(r&&n===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&ye(l)){const{propsDefaults:u}=o;if(s in u)n=u[s];else{const c=Pn(o);n=u[s]=l.call(null,t),c()}}else n=l;o.ce&&o.ce._setProp(s,n)}a[0]&&(i&&!r?n=!1:a[1]&&(n===""||n===Fs(s))&&(n=!0))}return n}const Du=new WeakMap;function ol(e,t,s=!1){const n=s?Du:t.propsCache,o=n.get(e);if(o)return o;const i=e.props,a={},r=[];let l=!1;if(!ye(e)){const c=d=>{l=!0;const[p,m]=ol(d,t,!0);ft(a,p),m&&r.push(...m)};!s&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!i&&!l)return Xe(e)&&n.set(e,Ws),Ws;if(ge(i))for(let c=0;c<i.length;c++){const d=Ms(i[c]);la(d)&&(a[d]=Ve)}else if(i)for(const c in i){const d=Ms(c);if(la(d)){const p=i[c],m=a[d]=ge(p)||ye(p)?{type:p}:ft({},p),g=m.type;let v=!1,y=!0;if(ge(g))for(let $=0;$<g.length;++$){const C=g[$],S=ye(C)&&C.name;if(S==="Boolean"){v=!0;break}else S==="String"&&(y=!1)}else v=ye(g)&&g.name==="Boolean";m[0]=v,m[1]=y,(v||Ne(m,"default"))&&r.push(d)}}const u=[a,r];return Xe(e)&&n.set(e,u),u}function la(e){return e[0]!=="$"&&!fn(e)}const Oi=e=>e==="_"||e==="_ctx"||e==="$stable",Di=e=>ge(e)?e.map(ss):[ss(e)],Nu=(e,t,s)=>{if(t._n)return t;const n=Dr((...o)=>Di(t(...o)),s);return n._c=!1,n},il=(e,t,s)=>{const n=e._ctx;for(const o in e){if(Oi(o))continue;const i=e[o];if(ye(i))t[o]=Nu(o,i,n);else if(i!=null){const a=Di(i);t[o]=()=>a}}},al=(e,t)=>{const s=Di(t);e.slots.default=()=>s},rl=(e,t,s)=>{for(const n in t)(s||!Oi(n))&&(e[n]=t[n])},Hu=(e,t,s)=>{const n=e.slots=tl();if(e.vnode.shapeFlag&32){const o=t._;o?(rl(n,t,s),s&&dr(n,"_",o,!0)):il(t,n)}else t&&al(e,t)},Gu=(e,t,s)=>{const{vnode:n,slots:o}=e;let i=!0,a=Ve;if(n.shapeFlag&32){const r=t._;r?s&&r===1?i=!1:rl(o,t,s):(i=!t.$stable,il(t,o)),a=t}else t&&(al(e,t),a={default:1});if(i)for(const r in o)!Oi(r)&&a[r]==null&&delete o[r]},bt=ed;function Fu(e){return Uu(e)}function Uu(e,t){const s=yo();s.__VUE__=!0;const{insert:n,remove:o,patchProp:i,createElement:a,createText:r,createComment:l,setText:u,setElementText:c,parentNode:d,nextSibling:p,setScopeId:m=Yt,insertStaticContent:g}=e,v=(_,w,E,U=null,x=null,z=null,se=void 0,Q=null,J=!!w.dynamicChildren)=>{if(_===w)return;_&&!Ns(_,w)&&(U=ke(_),ce(_,x,z,!0),_=null),w.patchFlag===-2&&(J=!1,w.dynamicChildren=null);const{type:W,ref:he,shapeFlag:ne}=w;switch(W){case Ao:y(_,w,E,U);break;case Tt:$(_,w,E,U);break;case vn:_==null&&C(w,E,U,se);break;case Be:b(_,w,E,U,x,z,se,Q,J);break;default:ne&1?F(_,w,E,U,x,z,se,Q,J):ne&6?L(_,w,E,U,x,z,se,Q,J):(ne&64||ne&128)&&W.process(_,w,E,U,x,z,se,Q,J,Je)}he!=null&&x?gn(he,_&&_.ref,z,w||_,!w):he==null&&_&&_.ref!=null&&gn(_.ref,null,z,_,!0)},y=(_,w,E,U)=>{if(_==null)n(w.el=r(w.children),E,U);else{const x=w.el=_.el;w.children!==_.children&&u(x,w.children)}},$=(_,w,E,U)=>{_==null?n(w.el=l(w.children||""),E,U):w.el=_.el},C=(_,w,E,U)=>{[_.el,_.anchor]=g(_.children,w,E,U,_.el,_.anchor)},S=({el:_,anchor:w},E,U)=>{let x;for(;_&&_!==w;)x=p(_),n(_,E,U),_=x;n(w,E,U)},M=({el:_,anchor:w})=>{let E;for(;_&&_!==w;)E=p(_),o(_),_=E;o(w)},F=(_,w,E,U,x,z,se,Q,J)=>{w.type==="svg"?se="svg":w.type==="math"&&(se="mathml"),_==null?X(w,E,U,x,z,se,Q,J):R(_,w,x,z,se,Q,J)},X=(_,w,E,U,x,z,se,Q)=>{let J,W;const{props:he,shapeFlag:ne,transition:ue,dirs:me}=_;if(J=_.el=a(_.type,z,he&&he.is,he),ne&8?c(J,_.children):ne&16&&P(_.children,J,null,U,x,Uo(_,z),se,Q),me&&Rs(_,null,U,"created"),Y(J,_,_.scopeId,se,U),he){for(const Ge in he)Ge!=="value"&&!fn(Ge)&&i(J,Ge,null,he[Ge],z,U);"value"in he&&i(J,"value",null,he.value,z),(W=he.onVnodeBeforeMount)&&Qt(W,U,_)}me&&Rs(_,null,U,"beforeMount");const Me=Bu(x,ue);Me&&ue.beforeEnter(J),n(J,w,E),((W=he&&he.onVnodeMounted)||Me||me)&&bt(()=>{W&&Qt(W,U,_),Me&&ue.enter(J),me&&Rs(_,null,U,"mounted")},x)},Y=(_,w,E,U,x)=>{if(E&&m(_,E),U)for(let z=0;z<U.length;z++)m(_,U[z]);if(x){let z=x.subTree;if(w===z||fl(z.type)&&(z.ssContent===w||z.ssFallback===w)){const se=x.vnode;Y(_,se,se.scopeId,se.slotScopeIds,x.parent)}}},P=(_,w,E,U,x,z,se,Q,J=0)=>{for(let W=J;W<_.length;W++){const he=_[W]=Q?Ts(_[W]):ss(_[W]);v(null,he,w,E,U,x,z,se,Q)}},R=(_,w,E,U,x,z,se)=>{const Q=w.el=_.el;let{patchFlag:J,dynamicChildren:W,dirs:he}=w;J|=_.patchFlag&16;const ne=_.props||Ve,ue=w.props||Ve;let me;if(E&&$s(E,!1),(me=ue.onVnodeBeforeUpdate)&&Qt(me,E,w,_),he&&Rs(w,_,E,"beforeUpdate"),E&&$s(E,!0),(ne.innerHTML&&ue.innerHTML==null||ne.textContent&&ue.textContent==null)&&c(Q,""),W?V(_.dynamicChildren,W,Q,E,U,Uo(w,x),z):se||de(_,w,Q,null,E,U,Uo(w,x),z,!1),J>0){if(J&16)N(Q,ne,ue,E,x);else if(J&2&&ne.class!==ue.class&&i(Q,"class",null,ue.class,x),J&4&&i(Q,"style",ne.style,ue.style,x),J&8){const Me=w.dynamicProps;for(let Ge=0;Ge<Me.length;Ge++){const Le=Me[Ge],ht=ne[Le],pt=ue[Le];(pt!==ht||Le==="value")&&i(Q,Le,ht,pt,x,E)}}J&1&&_.children!==w.children&&c(Q,w.children)}else!se&&W==null&&N(Q,ne,ue,E,x);((me=ue.onVnodeUpdated)||he)&&bt(()=>{me&&Qt(me,E,w,_),he&&Rs(w,_,E,"updated")},U)},V=(_,w,E,U,x,z,se)=>{for(let Q=0;Q<w.length;Q++){const J=_[Q],W=w[Q],he=J.el&&(J.type===Be||!Ns(J,W)||J.shapeFlag&198)?d(J.el):E;v(J,W,he,null,U,x,z,se,!0)}},N=(_,w,E,U,x)=>{if(w!==E){if(w!==Ve)for(const z in w)!fn(z)&&!(z in E)&&i(_,z,w[z],null,x,U);for(const z in E){if(fn(z))continue;const se=E[z],Q=w[z];se!==Q&&z!=="value"&&i(_,z,Q,se,x,U)}"value"in E&&i(_,"value",w.value,E.value,x)}},b=(_,w,E,U,x,z,se,Q,J)=>{const W=w.el=_?_.el:r(""),he=w.anchor=_?_.anchor:r("");let{patchFlag:ne,dynamicChildren:ue,slotScopeIds:me}=w;me&&(Q=Q?Q.concat(me):me),_==null?(n(W,E,U),n(he,E,U),P(w.children||[],E,he,x,z,se,Q,J)):ne>0&&ne&64&&ue&&_.dynamicChildren?(V(_.dynamicChildren,ue,E,x,z,se,Q),(w.key!=null||x&&w===x.subTree)&&Ni(_,w,!0)):de(_,w,E,he,x,z,se,Q,J)},L=(_,w,E,U,x,z,se,Q,J)=>{w.slotScopeIds=Q,_==null?w.shapeFlag&512?x.ctx.activate(w,E,U,se,J):O(w,E,U,x,z,se,J):B(_,w,J)},O=(_,w,E,U,x,z,se)=>{const Q=_.component=rd(_,U,x);if(wo(_)&&(Q.ctx.renderer=Je),ld(Q,!1,se),Q.asyncDep){if(x&&x.registerDep(Q,ie,se),!_.el){const J=Q.subTree=Qe(Tt);$(null,J,w,E),_.placeholder=J.el}}else ie(Q,_,w,E,x,z,se)},B=(_,w,E)=>{const U=w.component=_.component;if(Zu(_,w,E))if(U.asyncDep&&!U.asyncResolved){ae(U,w,E);return}else U.next=w,U.update();else w.el=_.el,U.vnode=w},ie=(_,w,E,U,x,z,se)=>{const Q=()=>{if(_.isMounted){let{next:ne,bu:ue,u:me,parent:Me,vnode:Ge}=_;{const Gt=ll(_);if(Gt){ne&&(ne.el=Ge.el,ae(_,ne,se)),Gt.asyncDep.then(()=>{_.isUnmounted||Q()});return}}let Le=ne,ht;$s(_,!1),ne?(ne.el=Ge.el,ae(_,ne,se)):ne=Ge,ue&&Io(ue),(ht=ne.props&&ne.props.onVnodeBeforeUpdate)&&Qt(ht,Me,ne,Ge),$s(_,!0);const pt=ua(_),Ht=_.subTree;_.subTree=pt,v(Ht,pt,d(Ht.el),ke(Ht),_,x,z),ne.el=pt.el,Le===null&&Qu(_,pt.el),me&&bt(me,x),(ht=ne.props&&ne.props.onVnodeUpdated)&&bt(()=>Qt(ht,Me,ne,Ge),x)}else{let ne;const{el:ue,props:me}=w,{bm:Me,m:Ge,parent:Le,root:ht,type:pt}=_,Ht=_n(w);$s(_,!1),Me&&Io(Me),!Ht&&(ne=me&&me.onVnodeBeforeMount)&&Qt(ne,Le,w),$s(_,!0);{ht.ce&&ht.ce._def.shadowRoot!==!1&&ht.ce._injectChildStyle(pt);const Gt=_.subTree=ua(_);v(null,Gt,E,U,_,x,z),w.el=Gt.el}if(Ge&&bt(Ge,x),!Ht&&(ne=me&&me.onVnodeMounted)){const Gt=w;bt(()=>Qt(ne,Le,Gt),x)}(w.shapeFlag&256||Le&&_n(Le.vnode)&&Le.vnode.shapeFlag&256)&&_.a&&bt(_.a,x),_.isMounted=!0,w=E=U=null}};_.scope.on();const J=_.effect=new mr(Q);_.scope.off();const W=_.update=J.run.bind(J),he=_.job=J.runIfDirty.bind(J);he.i=_,he.id=_.uid,J.scheduler=()=>Li(he),$s(_,!0),W()},ae=(_,w,E)=>{w.component=_;const U=_.vnode.props;_.vnode=w,_.next=null,Ou(_,w.props,U,E),Gu(_,w.children,E),ms(),Zi(_),gs()},de=(_,w,E,U,x,z,se,Q,J=!1)=>{const W=_&&_.children,he=_?_.shapeFlag:0,ne=w.children,{patchFlag:ue,shapeFlag:me}=w;if(ue>0){if(ue&128){Ye(W,ne,E,U,x,z,se,Q,J);return}else if(ue&256){xe(W,ne,E,U,x,z,se,Q,J);return}}me&8?(he&16&&He(W,x,z),ne!==W&&c(E,ne)):he&16?me&16?Ye(W,ne,E,U,x,z,se,Q,J):He(W,x,z,!0):(he&8&&c(E,""),me&16&&P(ne,E,U,x,z,se,Q,J))},xe=(_,w,E,U,x,z,se,Q,J)=>{_=_||Ws,w=w||Ws;const W=_.length,he=w.length,ne=Math.min(W,he);let ue;for(ue=0;ue<ne;ue++){const me=w[ue]=J?Ts(w[ue]):ss(w[ue]);v(_[ue],me,E,null,x,z,se,Q,J)}W>he?He(_,x,z,!0,!1,ne):P(w,E,U,x,z,se,Q,J,ne)},Ye=(_,w,E,U,x,z,se,Q,J)=>{let W=0;const he=w.length;let ne=_.length-1,ue=he-1;for(;W<=ne&&W<=ue;){const me=_[W],Me=w[W]=J?Ts(w[W]):ss(w[W]);if(Ns(me,Me))v(me,Me,E,null,x,z,se,Q,J);else break;W++}for(;W<=ne&&W<=ue;){const me=_[ne],Me=w[ue]=J?Ts(w[ue]):ss(w[ue]);if(Ns(me,Me))v(me,Me,E,null,x,z,se,Q,J);else break;ne--,ue--}if(W>ne){if(W<=ue){const me=ue+1,Me=me<he?w[me].el:U;for(;W<=ue;)v(null,w[W]=J?Ts(w[W]):ss(w[W]),E,Me,x,z,se,Q,J),W++}}else if(W>ue)for(;W<=ne;)ce(_[W],x,z,!0),W++;else{const me=W,Me=W,Ge=new Map;for(W=Me;W<=ue;W++){const yt=w[W]=J?Ts(w[W]):ss(w[W]);yt.key!=null&&Ge.set(yt.key,W)}let Le,ht=0;const pt=ue-Me+1;let Ht=!1,Gt=0;const ks=new Array(pt);for(W=0;W<pt;W++)ks[W]=0;for(W=me;W<=ne;W++){const yt=_[W];if(ht>=pt){ce(yt,x,z,!0);continue}let Pt;if(yt.key!=null)Pt=Ge.get(yt.key);else for(Le=Me;Le<=ue;Le++)if(ks[Le-Me]===0&&Ns(yt,w[Le])){Pt=Le;break}Pt===void 0?ce(yt,x,z,!0):(ks[Pt-Me]=W+1,Pt>=Gt?Gt=Pt:Ht=!0,v(yt,w[Pt],E,null,x,z,se,Q,J),ht++)}const Ln=Ht?ju(ks):Ws;for(Le=Ln.length-1,W=pt-1;W>=0;W--){const yt=Me+W,Pt=w[yt],In=w[yt+1],On=yt+1<he?In.el||In.placeholder:U;ks[W]===0?v(null,Pt,E,On,x,z,se,Q,J):Ht&&(Le<0||W!==Ln[Le]?H(Pt,E,On,2):Le--)}}},H=(_,w,E,U,x=null)=>{const{el:z,type:se,transition:Q,children:J,shapeFlag:W}=_;if(W&6){H(_.component.subTree,w,E,U);return}if(W&128){_.suspense.move(w,E,U);return}if(W&64){se.move(_,w,E,Je);return}if(se===Be){n(z,w,E);for(let ne=0;ne<J.length;ne++)H(J[ne],w,E,U);n(_.anchor,w,E);return}if(se===vn){S(_,w,E);return}if(U!==2&&W&1&&Q)if(U===0)Q.beforeEnter(z),n(z,w,E),bt(()=>Q.enter(z),x);else{const{leave:ne,delayLeave:ue,afterLeave:me}=Q,Me=()=>{_.ctx.isUnmounted?o(z):n(z,w,E)},Ge=()=>{z._isLeaving&&z[us](!0),ne(z,()=>{Me(),me&&me()})};ue?ue(z,Me,Ge):Ge()}else n(z,w,E)},ce=(_,w,E,U=!1,x=!1)=>{const{type:z,props:se,ref:Q,children:J,dynamicChildren:W,shapeFlag:he,patchFlag:ne,dirs:ue,cacheIndex:me}=_;if(ne===-2&&(x=!1),Q!=null&&(ms(),gn(Q,null,E,_,!0),gs()),me!=null&&(w.renderCache[me]=void 0),he&256){w.ctx.deactivate(_);return}const Me=he&1&&ue,Ge=!_n(_);let Le;if(Ge&&(Le=se&&se.onVnodeBeforeUnmount)&&Qt(Le,w,_),he&6)ut(_.component,E,U);else{if(he&128){_.suspense.unmount(E,U);return}Me&&Rs(_,null,w,"beforeUnmount"),he&64?_.type.remove(_,w,E,Je,U):W&&!W.hasOnce&&(z!==Be||ne>0&&ne&64)?He(W,w,E,!1,!0):(z===Be&&ne&384||!x&&he&16)&&He(J,w,E),U&&Te(_)}(Ge&&(Le=se&&se.onVnodeUnmounted)||Me)&&bt(()=>{Le&&Qt(Le,w,_),Me&&Rs(_,null,w,"unmounted")},E)},Te=_=>{const{type:w,el:E,anchor:U,transition:x}=_;if(w===Be){et(E,U);return}if(w===vn){M(_);return}const z=()=>{o(E),x&&!x.persisted&&x.afterLeave&&x.afterLeave()};if(_.shapeFlag&1&&x&&!x.persisted){const{leave:se,delayLeave:Q}=x,J=()=>se(E,z);Q?Q(_.el,z,J):J()}else z()},et=(_,w)=>{let E;for(;_!==w;)E=p(_),o(_),_=E;o(w)},ut=(_,w,E)=>{const{bum:U,scope:x,job:z,subTree:se,um:Q,m:J,a:W}=_;ca(J),ca(W),U&&Io(U),x.stop(),z&&(z.flags|=8,ce(se,_,w,E)),Q&&bt(Q,w),bt(()=>{_.isUnmounted=!0},w)},He=(_,w,E,U=!1,x=!1,z=0)=>{for(let se=z;se<_.length;se++)ce(_[se],w,E,U,x)},ke=_=>{if(_.shapeFlag&6)return ke(_.component.subTree);if(_.shapeFlag&128)return _.suspense.next();const w=p(_.anchor||_.el),E=w&&w[Hr];return E?p(E):w};let _t=!1;const at=(_,w,E)=>{_==null?w._vnode&&ce(w._vnode,null,null,!0):v(w._vnode||null,_,w,null,null,null,E),w._vnode=_,_t||(_t=!0,Zi(),Lr(),_t=!1)},Je={p:v,um:ce,m:H,r:Te,mt:O,mc:P,pc:de,pbc:V,n:ke,o:e};return{render:at,hydrate:void 0,createApp:Pu(at)}}function Uo({type:e,props:t},s){return s==="svg"&&e==="foreignObject"||s==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:s}function $s({effect:e,job:t},s){s?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function Bu(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function Ni(e,t,s=!1){const n=e.children,o=t.children;if(ge(n)&&ge(o))for(let i=0;i<n.length;i++){const a=n[i];let r=o[i];r.shapeFlag&1&&!r.dynamicChildren&&((r.patchFlag<=0||r.patchFlag===32)&&(r=o[i]=Ts(o[i]),r.el=a.el),!s&&r.patchFlag!==-2&&Ni(a,r)),r.type===Ao&&r.patchFlag!==-1&&(r.el=a.el),r.type===Tt&&!r.el&&(r.el=a.el)}}function ju(e){const t=e.slice(),s=[0];let n,o,i,a,r;const l=e.length;for(n=0;n<l;n++){const u=e[n];if(u!==0){if(o=s[s.length-1],e[o]<u){t[n]=o,s.push(n);continue}for(i=0,a=s.length-1;i<a;)r=i+a>>1,e[s[r]]<u?i=r+1:a=r;u<e[s[i]]&&(i>0&&(t[n]=s[i-1]),s[i]=n)}}for(i=s.length,a=s[i-1];i-- >0;)s[i]=a,a=t[a];return s}function ll(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:ll(t)}function ca(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const zu=Symbol.for("v-scx"),Vu=()=>Wn(zu);function Nt(e,t,s){return cl(e,t,s)}function cl(e,t,s=Ve){const{immediate:n,deep:o,flush:i,once:a}=s,r=ft({},s),l=t&&n||!t&&i!=="post";let u;if(En){if(i==="sync"){const m=Vu();u=m.__watcherHandles||(m.__watcherHandles=[])}else if(!l){const m=()=>{};return m.stop=Yt,m.resume=Yt,m.pause=Yt,m}}const c=At;r.call=(m,g,v)=>Zt(m,c,g,v);let d=!1;i==="post"?r.scheduler=m=>{bt(m,c&&c.suspense)}:i!=="sync"&&(d=!0,r.scheduler=(m,g)=>{g?m():Li(m)}),r.augmentJob=m=>{t&&(m.flags|=4),d&&(m.flags|=2,c&&(m.id=c.uid,m.i=c))};const p=lu(e,t,r);return En&&(u?u.push(p):l&&p()),p}function Ku(e,t,s){const n=this.proxy,o=ot(e)?e.includes(".")?ul(n,e):()=>n[e]:e.bind(n,n);let i;ye(t)?i=t:(i=t.handler,s=t);const a=Pn(this),r=cl(o,i.bind(n),s);return a(),r}function ul(e,t){const s=t.split(".");return()=>{let n=e;for(let o=0;o<s.length&&n;o++)n=n[s[o]];return n}}const Wu=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Ms(t)}Modifiers`]||e[`${Fs(t)}Modifiers`];function qu(e,t,...s){if(e.isUnmounted)return;const n=e.vnode.props||Ve;let o=s;const i=t.startsWith("update:"),a=i&&Wu(n,t.slice(7));a&&(a.trim&&(o=s.map(c=>ot(c)?c.trim():c)),a.number&&(o=s.map(Mc)));let r,l=n[r=Lo(t)]||n[r=Lo(Ms(t))];!l&&i&&(l=n[r=Lo(Fs(t))]),l&&Zt(l,e,6,o);const u=n[r+"Once"];if(u){if(!e.emitted)e.emitted={};else if(e.emitted[r])return;e.emitted[r]=!0,Zt(u,e,6,o)}}const Xu=new WeakMap;function dl(e,t,s=!1){const n=s?Xu:t.emitsCache,o=n.get(e);if(o!==void 0)return o;const i=e.emits;let a={},r=!1;if(!ye(e)){const l=u=>{const c=dl(u,t,!0);c&&(r=!0,ft(a,c))};!s&&t.mixins.length&&t.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}return!i&&!r?(Xe(e)&&n.set(e,null),null):(ge(i)?i.forEach(l=>a[l]=null):ft(a,i),Xe(e)&&n.set(e,a),a)}function To(e,t){return!e||!mo(t)?!1:(t=t.slice(2).replace(/Once$/,""),Ne(e,t[0].toLowerCase()+t.slice(1))||Ne(e,Fs(t))||Ne(e,t))}function ua(e){const{type:t,vnode:s,proxy:n,withProxy:o,propsOptions:[i],slots:a,attrs:r,emit:l,render:u,renderCache:c,props:d,data:p,setupState:m,ctx:g,inheritAttrs:v}=e,y=no(e);let $,C;try{if(s.shapeFlag&4){const M=o||n,F=M;$=ss(u.call(F,M,c,d,m,p,g)),C=r}else{const M=t;$=ss(M.length>1?M(d,{attrs:r,slots:a,emit:l}):M(d,null)),C=t.props?r:Yu(r)}}catch(M){bn.length=0,bo(M,e,1),$=Qe(Tt)}let S=$;if(C&&v!==!1){const M=Object.keys(C),{shapeFlag:F}=S;M.length&&F&7&&(i&&M.some(Si)&&(C=Ju(C,i)),S=xs(S,C,!1,!0))}return s.dirs&&(S=xs(S,null,!1,!0),S.dirs=S.dirs?S.dirs.concat(s.dirs):s.dirs),s.transition&&Cn(S,s.transition),$=S,no(y),$}const Yu=e=>{let t;for(const s in e)(s==="class"||s==="style"||mo(s))&&((t||(t={}))[s]=e[s]);return t},Ju=(e,t)=>{const s={};for(const n in e)(!Si(n)||!(n.slice(9)in t))&&(s[n]=e[n]);return s};function Zu(e,t,s){const{props:n,children:o,component:i}=e,{props:a,children:r,patchFlag:l}=t,u=i.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&l>=0){if(l&1024)return!0;if(l&16)return n?da(n,a,u):!!a;if(l&8){const c=t.dynamicProps;for(let d=0;d<c.length;d++){const p=c[d];if(a[p]!==n[p]&&!To(u,p))return!0}}}else return(o||r)&&(!r||!r.$stable)?!0:n===a?!1:n?a?da(n,a,u):!0:!!a;return!1}function da(e,t,s){const n=Object.keys(t);if(n.length!==Object.keys(e).length)return!0;for(let o=0;o<n.length;o++){const i=n[o];if(t[i]!==e[i]&&!To(s,i))return!0}return!1}function Qu({vnode:e,parent:t},s){for(;t;){const n=t.subTree;if(n.suspense&&n.suspense.activeBranch===e&&(n.el=e.el),n===e)(e=t.vnode).el=s,t=t.parent;else break}}const fl=e=>e.__isSuspense;function ed(e,t){t&&t.pendingBranch?ge(e)?t.effects.push(...e):t.effects.push(e):Pr(e)}const Be=Symbol.for("v-fgt"),Ao=Symbol.for("v-txt"),Tt=Symbol.for("v-cmt"),vn=Symbol.for("v-stc"),bn=[];let It=null;function G(e=!1){bn.push(It=e?null:[])}function td(){bn.pop(),It=bn[bn.length-1]||null}let xn=1;function ao(e,t=!1){xn+=e,e<0&&It&&t&&(It.hasOnce=!0)}function hl(e){return e.dynamicChildren=xn>0?It||Ws:null,td(),xn>0&&It&&It.push(e),e}function j(e,t,s,n,o,i){return hl(h(e,t,s,n,o,i,!0))}function Ot(e,t,s,n,o){return hl(Qe(e,t,s,n,o,!0))}function ro(e){return e?e.__v_isVNode===!0:!1}function Ns(e,t){return e.type===t.type&&e.key===t.key}const pl=({key:e})=>e??null,qn=({ref:e,ref_key:t,ref_for:s})=>(typeof e=="number"&&(e=""+e),e!=null?ot(e)||gt(e)||ye(e)?{i:zt,r:e,k:t,f:!!s}:e:null);function h(e,t=null,s=null,n=0,o=null,i=e===Be?0:1,a=!1,r=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&pl(t),ref:t&&qn(t),scopeId:Or,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:n,dynamicProps:o,dynamicChildren:null,appContext:null,ctx:zt};return r?(Hi(l,s),i&128&&e.normalize(l)):s&&(l.shapeFlag|=ot(s)?8:16),xn>0&&!a&&It&&(l.patchFlag>0||i&6)&&l.patchFlag!==32&&It.push(l),l}const Qe=sd;function sd(e,t=null,s=null,n=0,o=null,i=!1){if((!e||e===Au)&&(e=Tt),ro(e)){const r=xs(e,t,!0);return s&&Hi(r,s),xn>0&&!i&&It&&(r.shapeFlag&6?It[It.indexOf(e)]=r:It.push(r)),r.patchFlag=-2,r}if(fd(e)&&(e=e.__vccOpts),t){t=nd(t);let{class:r,style:l}=t;r&&!ot(r)&&(t.class=nt(r)),Xe(l)&&(Pi(l)&&!ge(l)&&(l=ft({},l)),t.style=jt(l))}const a=ot(e)?1:fl(e)?128:Gr(e)?64:Xe(e)?4:ye(e)?2:0;return h(e,t,s,n,o,a,i,!0)}function nd(e){return e?Pi(e)||sl(e)?ft({},e):e:null}function xs(e,t,s=!1,n=!1){const{props:o,ref:i,patchFlag:a,children:r,transition:l}=e,u=t?od(o||{},t):o,c={__v_isVNode:!0,__v_skip:!0,type:e.type,props:u,key:u&&pl(u),ref:t&&t.ref?s&&i?ge(i)?i.concat(qn(t)):[i,qn(t)]:qn(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:r,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Be?a===-1?16:a|16:a,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:l,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&xs(e.ssContent),ssFallback:e.ssFallback&&xs(e.ssFallback),placeholder:e.placeholder,el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return l&&n&&Cn(c,l.clone(c)),c}function en(e=" ",t=0){return Qe(Ao,null,e,t)}function hi(e,t){const s=Qe(vn,null,e);return s.staticCount=t,s}function we(e="",t=!1){return t?(G(),Ot(Tt,null,e)):Qe(Tt,null,e)}function ss(e){return e==null||typeof e=="boolean"?Qe(Tt):ge(e)?Qe(Be,null,e.slice()):ro(e)?Ts(e):Qe(Ao,null,String(e))}function Ts(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:xs(e)}function Hi(e,t){let s=0;const{shapeFlag:n}=e;if(t==null)t=null;else if(ge(t))s=16;else if(typeof t=="object")if(n&65){const o=t.default;o&&(o._c&&(o._d=!1),Hi(e,o()),o._c&&(o._d=!0));return}else{s=32;const o=t._;!o&&!sl(t)?t._ctx=zt:o===3&&zt&&(zt.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else ye(t)?(t={default:t,_ctx:zt},s=32):(t=String(t),n&64?(s=16,t=[en(t)]):s=8);e.children=t,e.shapeFlag|=s}function od(...e){const t={};for(let s=0;s<e.length;s++){const n=e[s];for(const o in n)if(o==="class")t.class!==n.class&&(t.class=nt([t.class,n.class]));else if(o==="style")t.style=jt([t.style,n.style]);else if(mo(o)){const i=t[o],a=n[o];a&&i!==a&&!(ge(i)&&i.includes(a))&&(t[o]=i?[].concat(i,a):a)}else o!==""&&(t[o]=n[o])}return t}function Qt(e,t,s,n=null){Zt(e,t,7,[s,n])}const id=Qr();let ad=0;function rd(e,t,s){const n=e.type,o=(t?t.appContext:e.appContext)||id,i={uid:ad++,vnode:e,type:n,parent:t,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Ic(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(o.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ol(n,o),emitsOptions:dl(n,o),emit:null,emitted:null,propsDefaults:Ve,inheritAttrs:n.inheritAttrs,ctx:Ve,data:Ve,props:Ve,attrs:Ve,slots:Ve,refs:Ve,setupState:Ve,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=t?t.root:i,i.emit=qu.bind(null,i),e.ce&&e.ce(i),i}let At=null;const Gi=()=>At||zt;let lo,pi;{const e=yo(),t=(s,n)=>{let o;return(o=e[s])||(o=e[s]=[]),o.push(n),i=>{o.length>1?o.forEach(a=>a(i)):o[0](i)}};lo=t("__VUE_INSTANCE_SETTERS__",s=>At=s),pi=t("__VUE_SSR_SETTERS__",s=>En=s)}const Pn=e=>{const t=At;return lo(e),e.scope.on(),()=>{e.scope.off(),lo(t)}},fa=()=>{At&&At.scope.off(),lo(null)};function ml(e){return e.vnode.shapeFlag&4}let En=!1;function ld(e,t=!1,s=!1){t&&pi(t);const{props:n,children:o}=e.vnode,i=ml(e);Iu(e,n,i,t),Hu(e,o,s||t);const a=i?cd(e,t):void 0;return t&&pi(!1),a}function cd(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Mu);const{setup:n}=s;if(n){ms();const o=e.setupContext=n.length>1?dd(e):null,i=Pn(e),a=$n(n,e,0,[e.props,o]),r=rr(a);if(gs(),i(),(r||e.sp)&&!_n(e)&&qr(e),r){if(a.then(fa,fa),t)return a.then(l=>{ha(e,l)}).catch(l=>{bo(l,e,0)});e.asyncDep=a}else ha(e,a)}else gl(e)}function ha(e,t,s){ye(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:Xe(t)&&(e.setupState=kr(t)),gl(e)}function gl(e,t,s){const n=e.type;e.render||(e.render=n.render||Yt);{const o=Pn(e);ms();try{Cu(e)}finally{gs(),o()}}}const ud={get(e,t){return mt(e,"get",""),e[t]}};function dd(e){const t=s=>{e.exposed=s||{}};return{attrs:new Proxy(e.attrs,ud),slots:e.slots,emit:e.emit,expose:t}}function Mo(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(kr(tu(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in yn)return yn[s](e)},has(t,s){return s in t||s in yn}})):e.proxy}function fd(e){return ye(e)&&"__vccOpts"in e}const ze=(e,t)=>au(e,t,En);function hd(e,t,s){try{ao(-1);const n=arguments.length;return n===2?Xe(t)&&!ge(t)?ro(t)?Qe(e,null,[t]):Qe(e,t):Qe(e,null,t):(n>3?s=Array.prototype.slice.call(arguments,2):n===3&&ro(s)&&(s=[s]),Qe(e,t,s))}finally{ao(1)}}const pd="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let mi;const pa=typeof window<"u"&&window.trustedTypes;if(pa)try{mi=pa.createPolicy("vue",{createHTML:e=>e})}catch{}const _l=mi?e=>mi.createHTML(e):e=>e,md="http://www.w3.org/2000/svg",gd="http://www.w3.org/1998/Math/MathML",cs=typeof document<"u"?document:null,ma=cs&&cs.createElement("template"),_d={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,n)=>{const o=t==="svg"?cs.createElementNS(md,e):t==="mathml"?cs.createElementNS(gd,e):s?cs.createElement(e,{is:s}):cs.createElement(e);return e==="select"&&n&&n.multiple!=null&&o.setAttribute("multiple",n.multiple),o},createText:e=>cs.createTextNode(e),createComment:e=>cs.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>cs.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,n,o,i){const a=s?s.previousSibling:t.lastChild;if(o&&(o===i||o.nextSibling))for(;t.insertBefore(o.cloneNode(!0),s),!(o===i||!(o=o.nextSibling)););else{ma.innerHTML=_l(n==="svg"?`<svg>${e}</svg>`:n==="mathml"?`<math>${e}</math>`:e);const r=ma.content;if(n==="svg"||n==="mathml"){const l=r.firstChild;for(;l.firstChild;)r.appendChild(l.firstChild);r.removeChild(l)}t.insertBefore(r,s)}return[a?a.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},bs="transition",an="animation",kn=Symbol("_vtc"),yl={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},yd=ft({},jr,yl),vd=e=>(e.displayName="Transition",e.props=yd,e),bd=vd((e,{slots:t})=>hd(pu,wd(e),t)),Ps=(e,t=[])=>{ge(e)?e.forEach(s=>s(...t)):e&&e(...t)},ga=e=>e?ge(e)?e.some(t=>t.length>1):e.length>1:!1;function wd(e){const t={};for(const b in e)b in yl||(t[b]=e[b]);if(e.css===!1)return t;const{name:s="v",type:n,duration:o,enterFromClass:i=`${s}-enter-from`,enterActiveClass:a=`${s}-enter-active`,enterToClass:r=`${s}-enter-to`,appearFromClass:l=i,appearActiveClass:u=a,appearToClass:c=r,leaveFromClass:d=`${s}-leave-from`,leaveActiveClass:p=`${s}-leave-active`,leaveToClass:m=`${s}-leave-to`}=e,g=Sd(o),v=g&&g[0],y=g&&g[1],{onBeforeEnter:$,onEnter:C,onEnterCancelled:S,onLeave:M,onLeaveCancelled:F,onBeforeAppear:X=$,onAppear:Y=C,onAppearCancelled:P=S}=t,R=(b,L,O,B)=>{b._enterCancelled=B,Ls(b,L?c:r),Ls(b,L?u:a),O&&O()},V=(b,L)=>{b._isLeaving=!1,Ls(b,d),Ls(b,m),Ls(b,p),L&&L()},N=b=>(L,O)=>{const B=b?Y:C,ie=()=>R(L,b,O);Ps(B,[L,ie]),_a(()=>{Ls(L,b?l:i),ls(L,b?c:r),ga(B)||ya(L,n,v,ie)})};return ft(t,{onBeforeEnter(b){Ps($,[b]),ls(b,i),ls(b,a)},onBeforeAppear(b){Ps(X,[b]),ls(b,l),ls(b,u)},onEnter:N(!1),onAppear:N(!0),onLeave(b,L){b._isLeaving=!0;const O=()=>V(b,L);ls(b,d),b._enterCancelled?(ls(b,p),wa(b)):(wa(b),ls(b,p)),_a(()=>{b._isLeaving&&(Ls(b,d),ls(b,m),ga(M)||ya(b,n,y,O))}),Ps(M,[b,O])},onEnterCancelled(b){R(b,!1,void 0,!0),Ps(S,[b])},onAppearCancelled(b){R(b,!0,void 0,!0),Ps(P,[b])},onLeaveCancelled(b){V(b),Ps(F,[b])}})}function Sd(e){if(e==null)return null;if(Xe(e))return[Bo(e.enter),Bo(e.leave)];{const t=Bo(e);return[t,t]}}function Bo(e){return Cc(e)}function ls(e,t){t.split(/\s+/).forEach(s=>s&&e.classList.add(s)),(e[kn]||(e[kn]=new Set)).add(t)}function Ls(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.remove(n));const s=e[kn];s&&(s.delete(t),s.size||(e[kn]=void 0))}function _a(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Td=0;function ya(e,t,s,n){const o=e._endId=++Td,i=()=>{o===e._endId&&n()};if(s!=null)return setTimeout(i,s);const{type:a,timeout:r,propCount:l}=Ad(e,t);if(!a)return n();const u=a+"end";let c=0;const d=()=>{e.removeEventListener(u,p),i()},p=m=>{m.target===e&&++c>=l&&d()};setTimeout(()=>{c<l&&d()},r+1),e.addEventListener(u,p)}function Ad(e,t){const s=window.getComputedStyle(e),n=g=>(s[g]||"").split(", "),o=n(`${bs}Delay`),i=n(`${bs}Duration`),a=va(o,i),r=n(`${an}Delay`),l=n(`${an}Duration`),u=va(r,l);let c=null,d=0,p=0;t===bs?a>0&&(c=bs,d=a,p=i.length):t===an?u>0&&(c=an,d=u,p=l.length):(d=Math.max(a,u),c=d>0?a>u?bs:an:null,p=c?c===bs?i.length:l.length:0);const m=c===bs&&/\b(?:transform|all)(?:,|$)/.test(n(`${bs}Property`).toString());return{type:c,timeout:d,propCount:p,hasTransform:m}}function va(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((s,n)=>ba(s)+ba(e[n])))}function ba(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function wa(e){return(e?e.ownerDocument:document).body.offsetHeight}function Md(e,t,s){const n=e[kn];n&&(t=(t?[t,...n]:[...n]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}const co=Symbol("_vod"),vl=Symbol("_vsh"),bl={name:"show",beforeMount(e,{value:t},{transition:s}){e[co]=e.style.display==="none"?"":e.style.display,s&&t?s.beforeEnter(e):rn(e,t)},mounted(e,{value:t},{transition:s}){s&&t&&s.enter(e)},updated(e,{value:t,oldValue:s},{transition:n}){!t!=!s&&(n?t?(n.beforeEnter(e),rn(e,!0),n.enter(e)):n.leave(e,()=>{rn(e,!1)}):rn(e,t))},beforeUnmount(e,{value:t}){rn(e,t)}};function rn(e,t){e.style.display=t?e[co]:"none",e[vl]=!t}const wl=Symbol("");function tn(e){const t=Gi();if(!t)return;const s=t.ut=(o=e(t.proxy))=>{Array.from(document.querySelectorAll(`[data-v-owner="${t.uid}"]`)).forEach(i=>uo(i,o))},n=()=>{const o=e(t.proxy);t.ce?uo(t.ce,o):gi(t.subTree,o),s(o)};Yr(()=>{Pr(n)}),Rt(()=>{Nt(n,Yt,{flush:"post"});const o=new MutationObserver(n);o.observe(t.subTree.el.parentNode,{childList:!0}),Ii(()=>o.disconnect())})}function gi(e,t){if(e.shapeFlag&128){const s=e.suspense;e=s.activeBranch,s.pendingBranch&&!s.isHydrating&&s.effects.push(()=>{gi(s.activeBranch,t)})}for(;e.component;)e=e.component.subTree;if(e.shapeFlag&1&&e.el)uo(e.el,t);else if(e.type===Be)e.children.forEach(s=>gi(s,t));else if(e.type===vn){let{el:s,anchor:n}=e;for(;s&&(uo(s,t),s!==n);)s=s.nextSibling}}function uo(e,t){if(e.nodeType===1){const s=e.style;let n="";for(const o in t){const i=Lc(t[o]);s.setProperty(`--${o}`,i),n+=`--${o}: ${i};`}s[wl]=n}}const Cd=/(?:^|;)\s*display\s*:/;function xd(e,t,s){const n=e.style,o=ot(s);let i=!1;if(s&&!o){if(t)if(ot(t))for(const a of t.split(";")){const r=a.slice(0,a.indexOf(":")).trim();s[r]==null&&Xn(n,r,"")}else for(const a in t)s[a]==null&&Xn(n,a,"");for(const a in s)a==="display"&&(i=!0),Xn(n,a,s[a])}else if(o){if(t!==s){const a=n[wl];a&&(s+=";"+a),n.cssText=s,i=Cd.test(s)}}else t&&e.removeAttribute("style");co in e&&(e[co]=i?n.display:"",e[vl]&&(n.display="none"))}const Sa=/\s*!important$/;function Xn(e,t,s){if(ge(s))s.forEach(n=>Xn(e,t,n));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const n=Ed(e,t);Sa.test(s)?e.setProperty(Fs(n),s.replace(Sa,""),"important"):e[n]=s}}const Ta=["Webkit","Moz","ms"],jo={};function Ed(e,t){const s=jo[t];if(s)return s;let n=Ms(t);if(n!=="filter"&&n in e)return jo[t]=n;n=ur(n);for(let o=0;o<Ta.length;o++){const i=Ta[o]+n;if(i in e)return jo[t]=i}return t}const Aa="http://www.w3.org/1999/xlink";function Ma(e,t,s,n,o,i=Pc(t)){n&&t.startsWith("xlink:")?s==null?e.removeAttributeNS(Aa,t.slice(6,t.length)):e.setAttributeNS(Aa,t,s):s==null||i&&!fr(s)?e.removeAttribute(t):e.setAttribute(t,i?"":Es(s)?String(s):s)}function Ca(e,t,s,n,o){if(t==="innerHTML"||t==="textContent"){s!=null&&(e[t]=t==="innerHTML"?_l(s):s);return}const i=e.tagName;if(t==="value"&&i!=="PROGRESS"&&!i.includes("-")){const r=i==="OPTION"?e.getAttribute("value")||"":e.value,l=s==null?e.type==="checkbox"?"on":"":String(s);(r!==l||!("_value"in e))&&(e.value=l),s==null&&e.removeAttribute(t),e._value=s;return}let a=!1;if(s===""||s==null){const r=typeof e[t];r==="boolean"?s=fr(s):s==null&&r==="string"?(s="",a=!0):r==="number"&&(s=0,a=!0)}try{e[t]=s}catch{}a&&e.removeAttribute(o||t)}function kd(e,t,s,n){e.addEventListener(t,s,n)}function Rd(e,t,s,n){e.removeEventListener(t,s,n)}const xa=Symbol("_vei");function $d(e,t,s,n,o=null){const i=e[xa]||(e[xa]={}),a=i[t];if(n&&a)a.value=n;else{const[r,l]=Pd(t);if(n){const u=i[t]=Od(n,o);kd(e,r,u,l)}else a&&(Rd(e,r,a,l),i[t]=void 0)}}const Ea=/(?:Once|Passive|Capture)$/;function Pd(e){let t;if(Ea.test(e)){t={};let n;for(;n=e.match(Ea);)e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Fs(e.slice(2)),t]}let zo=0;const Ld=Promise.resolve(),Id=()=>zo||(Ld.then(()=>zo=0),zo=Date.now());function Od(e,t){const s=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=s.attached)return;Zt(Dd(n,s.value),t,5,[n])};return s.value=e,s.attached=Id(),s}function Dd(e,t){if(ge(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(n=>o=>!o._stopped&&n&&n(o))}else return t}const ka=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,Nd=(e,t,s,n,o,i)=>{const a=o==="svg";t==="class"?Md(e,n,a):t==="style"?xd(e,s,n):mo(t)?Si(t)||$d(e,t,s,n,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Hd(e,t,n,a))?(Ca(e,t,n),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Ma(e,t,n,a,i,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!ot(n))?Ca(e,Ms(t),n,i,t):(t==="true-value"?e._trueValue=n:t==="false-value"&&(e._falseValue=n),Ma(e,t,n,a))};function Hd(e,t,s,n){if(n)return!!(t==="innerHTML"||t==="textContent"||t in e&&ka(t)&&ye(s));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="autocorrect"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const o=e.tagName;if(o==="IMG"||o==="VIDEO"||o==="CANVAS"||o==="SOURCE")return!1}return ka(t)&&ot(s)?!1:t in e}const Gd=["ctrl","shift","alt","meta"],Fd={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Gd.some(s=>e[`${s}Key`]&&!t.includes(s))},Vt=(e,t)=>{const s=e._withMods||(e._withMods={}),n=t.join(".");return s[n]||(s[n]=(o,...i)=>{for(let a=0;a<t.length;a++){const r=Fd[t[a]];if(r&&r(o,t))return}return e(o,...i)})},Ud=ft({patchProp:Nd},_d);let Ra;function Bd(){return Ra||(Ra=Fu(Ud))}const $a=(...e)=>{const t=Bd().createApp(...e),{mount:s}=t;return t.mount=n=>{const o=zd(n);if(!o)return;const i=t._component;!ye(i)&&!i.render&&!i.template&&(i.template=o.innerHTML),o.nodeType===1&&(o.textContent="");const a=s(o,!1,jd(o));return o instanceof Element&&(o.removeAttribute("v-cloak"),o.setAttribute("data-v-app","")),a},t};function jd(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function zd(e){return ot(e)?document.querySelector(e):e}const Yn={maxRetries:3,retryDelay:1e3,timeout:1e4};let Vo=null;const Zs={enabled:!0,maxCacheSize:50*1024*1024,cachePrefix:"mgpic_",version:"1.0.0",loadInterval:50,batchSize:3};class Vd{constructor(){this.cache=new Map,this.totalSize=0}isSupported(){return"caches"in window}getCacheName(){return`${Zs.cachePrefix}${Zs.version}`}async isCached(t){if(!this.isSupported())return!1;try{return await(await caches.open(this.getCacheName())).match(t)!==void 0}catch(s){return f(":",s.message),!1}}async cacheResource(t,s){if(!this.isSupported())return!1;try{const n=await caches.open(this.getCacheName());if(await n.match(t))return f(`: ${t}`),!0;await n.put(t,s.clone());const i=s.headers.get("content-length");return i&&(this.totalSize+=parseInt(i)),f(`: ${t}`),!0}catch(n){return f(":",n.message),!1}}async getCachedResource(t){if(!this.isSupported())return null;try{return await(await caches.open(this.getCacheName())).match(t)}catch(s){return f(":",s.message),null}}async cleanupCache(){if(this.isSupported())try{const t=await caches.keys(),s=this.getCacheName();for(const n of t)n.startsWith(Zs.cachePrefix)&&n!==s&&(await caches.delete(n),f(`: ${n}`))}catch(t){f(":",t.message)}}}const Kt=new Vd;let Bn=null;function Kd(){return Bn||(f("R2 URL"),Bn="https://pub-6f9181bda40946ea92b5e87fe84e27d4.r2.dev",Bn)}function oe(e){let t=e;e.startsWith("/assets/")&&(t=e.slice(7));const s=Kd(),n=t.startsWith("/")?t.slice(1):t;return`${s}/${n}`}async function Sl(e,t={}){if(Kt.isSupported()){const o=await Kt.getCachedResource(e);if(o)return f(` Cache Storage : ${e}`),o}const{maxRetries:s=Yn.maxRetries,retryDelay:n=Yn.retryDelay}=t;for(let o=1;o<=s;o++)try{f(` (${o}/${s}): ${e}`);const i=new AbortController,a=setTimeout(()=>i.abort(),Yn.timeout),r=await fetch(e,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:i.signal,...t});if(clearTimeout(a),r.ok)return Kt.isSupported()&&await Kt.cacheResource(e,r),f(`: ${e}`),r;throw new Error(`HTTP ${r.status}: ${r.statusText}`)}catch(i){if(f(` (${o}/${s}): ${e}`,i.message),o===s)throw f(`: ${e}`,i.message),i;const a=n*o;f(` ${a}ms ...`),await new Promise(r=>setTimeout(r,a))}}async function Wd(e=["high","medium"]){try{if(Vo){f("");const i=Pa(Vo,e);return f(` ${i.length}  (: ${e.join(", ")})`),i}const t=oe("asset-list.json");f(` R2 CDN : ${t}`);const s=await Sl(t);if(!s.ok)throw new Error(`: HTTP ${s.status}`);const n=await s.json();Vo=n,f("");const o=Pa(n,e);return f(` ${o.length}  (: ${e.join(", ")})`),o}catch(t){return f(":",t.message),["logo.glb","frontend_resource/start_game.webp","frontend_resource/copper_warehouse.webp","frontend_resource/game_wiki.webp","frontend_resource/Tutorial.webp","frontend_resource/gacha.webp"]}}function Pa(e,t){const s=[];for(const n of t)if(e.categories&&e.categories[n]){const o=e.categories[n].resources||[];s.push(...o.map(i=>i.path))}return s}async function _i(e=null,t=["high","medium"]){f("..."),await Kt.cleanupCache();const s=await Wd(t),n=Zs.batchSize,o=Zs.loadInterval,i=s.length;let a=0;e&&e(0,i,0);for(let r=0;r<s.length;r+=n){const l=s.slice(r,r+n);f(` ${Math.floor(r/n)+1}/${Math.ceil(s.length/n)}: ${l.length} `);const u=l.map(async(y,$)=>{const C=oe(y);try{if(await Kt.isCached(C))return f(`Cache Storage: ${y}`),{success:!0,path:y,cached:!0,source:"cache"};const M=new AbortController,F=setTimeout(()=>M.abort(),Yn.timeout),X=await fetch(C,{method:"GET",mode:"cors",credentials:"omit",cache:"no-cache",signal:M.signal});if(clearTimeout(F),X.ok){const Y=X.headers.get("x-cache")||X.headers.get("cf-cache-status")||X.type==="basic"&&!X.redirected;return Kt.isSupported()&&await Kt.cacheResource(C,X),f(`: ${y}${Y?" ()":""}`),{success:!0,path:y,cached:!1,fromBrowserCache:!!Y}}else throw new Error(`HTTP ${X.status}: ${X.statusText}`)}catch(S){return f(`: ${y}`,S.message),{success:!1,path:y,error:S.message}}}),c=await Promise.all(u);a+=l.length;const d=Math.round(a/i*100);e&&e(a,i,d);const p=c.filter(y=>y.success).length,m=c.filter(y=>y.cached).length,g=c.filter(y=>y.fromBrowserCache).length,v=c.filter(y=>!y.success).length;f(`:  ${p}, Cache Storage ${m},  ${g},  ${v}`),r+n<s.length&&(f(` ${o}ms ...`),await new Promise(y=>setTimeout(y,o)))}f(""),e&&e(i,i,100)}async function qd(){if(!Kt.isSupported())return{supported:!1,message:"API"};try{const t=await(await caches.open(Kt.getCacheName())).keys();return{supported:!0,cacheName:Kt.getCacheName(),resourceCount:t.length,totalSize:Kt.totalSize,maxSize:Zs.maxCacheSize}}catch(e){return{supported:!0,error:e.message}}}function Co(e,t){return oe(`copper/${e.toLowerCase()}/${t}/${t}.glb`)}function xo(e){return oe(`enemy/${e}/${e}.glb`)}function Tl(e){return oe(`structure/${e}/${e}.glb`)}function Xd(e){return oe(e)}const ct=(e,t)=>{const s=e.__vccOpts||e;for(const[n,o]of t)s[n]=o;return s},Yd={class:"hall-container"},Jd=["src"],Zd={__name:"Hall",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["startGame","openWarehouse","openTutorial","openEncyclopedia","toggle-music"],setup(e,{emit:t}){const s=t,n=e;function o(){s("startGame")}function i(){s("openWarehouse")}function a(){s("openTutorial")}function r(){s("openEncyclopedia")}const l=Z(oe("frontend_resource/start_game.webp")),u=Z(oe("frontend_resource/copper_warehouse.webp")),c=Z(oe("frontend_resource/game_wiki.webp")),d=Z(oe("frontend_resource/Tutorial.webp")),p=Z(oe("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),m=Z(!1),g=Z(null),v=oe("assets/hall.mp3");return Rt(()=>{setTimeout(()=>{m.value=!0,f("HallUI")},100),n.musicOn&&!n.paused&&g.value&&setTimeout(()=>{if(g.value.readyState>=2)g.value.play().then(()=>{f("[Hall] ")}).catch($=>{f("[Hall] :",$)});else{const $=()=>{g.value.play().then(()=>{f("[Hall] ")}).catch(C=>{f("[Hall] :",C)}),g.value.removeEventListener("canplay",$)};g.value.addEventListener("canplay",$,{once:!0})}},200)}),Nt(()=>n.musicOn,y=>{if(g.value)if(y&&!n.paused)if(g.value.readyState>=2)g.value.play().catch($=>{f("[Hall] :",$)});else{const $=()=>{g.value.play().catch(C=>{f("[Hall] :",C)}),g.value.removeEventListener("canplay",$)};g.value.addEventListener("canplay",$)}else g.value.pause()}),Nt(()=>n.paused,y=>{if(g.value){if(y)g.value.pause(),f("[Hall] ");else if(n.musicOn){if(g.value.readyState>=2)g.value.play().catch($=>{f("[Hall] :",$)});else{const $=()=>{g.value.play().catch(C=>{f("[Hall] :",C)}),g.value.removeEventListener("canplay",$)};g.value.addEventListener("canplay",$)}f("[Hall] ")}}}),ys(()=>{g.value&&g.value.pause()}),(y,$)=>(G(),j("div",Yd,[h("div",{class:"hall-bg",style:jt({backgroundImage:`url('${p.value}')`})},null,4),h("div",{class:nt(["menu",{"menu--loaded":m.value}])},[h("button",{class:"tile tile--start",style:jt({backgroundImage:`url('${l.value}')`}),onClick:o},[...$[0]||($[0]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--bottom"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Begin Adventure")],-1)])],4),h("button",{class:"tile tile--warehouse",style:jt({backgroundImage:`url('${u.value}')`}),onClick:i},[...$[1]||($[1]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--top"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Character Collection")],-1)])],4),h("button",{class:"tile tile--wiki",style:jt({backgroundImage:`url('${c.value}')`}),onClick:r},[...$[2]||($[2]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--bottom"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Encyclopedia")],-1)])],4),h("button",{class:"tile tile--tutorial",style:jt({backgroundImage:`url('${d.value}')`}),onClick:a},[...$[3]||($[3]=[h("div",{class:"tile__mask"},null,-1),h("div",{class:"tile__caption tile__caption--top"},[h("div",{class:"tile__title"},""),h("div",{class:"tile__subtitle"},"Tutorial")],-1)])],4)],2),h("audio",{ref_key:"audioRef",ref:g,src:Ae(v),loop:"",preload:"auto"},null,8,Jd)]))}},Qd=ct(Zd,[["__scopeId","data-v-ee710af8"]]),ef="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAABGdBTUEAALGPC/xhBQAAAAxQTFRFAAAAwMDA////AAAAyzCG0wAAAAF0Uk5TAEDm2GYAAAA+SURBVAjXY2D4/5+Bgfn//wMM/K9Wf2DgX7UKSKz/BSf+f2Cwj///h8Fu1ao9UGL1KxgBF7P/D1TC////BwApLyjJj3La0wAAAABJRU5ErkJggg==",tf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAABGdBTUEAALGPC/xhBQAAAAlQTFRFAAAA////AAAAc8aDcQAAAAF0Uk5TAEDm2GYAAAAxSURBVAjXY2DgWsDAwKC1AkhoZiATWiuzVjCsWpm1imFpaGgUhABzwRJoiiEGAI0CANnCEknEUmuhAAAAAElFTkSuQmCC",sf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAABGdBTUEAALGPC/xhBQAAAAlQTFRFAAAA////AAAAc8aDcQAAAAF0Uk5TAEDm2GYAAAA/SURBVAjXY2DgWsDAwKC1AkiszGJgYFoa1cDANTVsAYNWaOgKBs3Q0AwIobU0agUD19IooOqlUQwYxKpVEFMA/w4TNGoOeNQAAAAASUVORK5CYII=",ns={HeartCrystalDust:{name:"",icon:oe("resource/heart_crystal_dust.webp")},RecallGear:{name:"",icon:oe("resource/recall_gear.webp")},ResonantCrystal:{name:"",icon:oe("resource/resonant_star_crystal/resonant_star_crystal.webp")},RefinedCopper:{name:"",icon:oe("resource/refined_copper_ingot/refined_copper_ingot.webp")},SpiritalSpark:{name:"",icon:oe("resource/spiritual_spark.webp")}};function Eo(e){var t;if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Resource"){const s=e.item_type[1];return((t=ns[s])==null?void 0:t.name)||s}else if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Equipment")return"";return""}function La(e){var t;if(Array.isArray(e==null?void 0:e.item_type)&&e.item_type[0]==="Resource"){const s=e.item_type[1];return((t=ns[s])==null?void 0:t.icon)||""}return""}const nf="modulepreload",of=function(e){return"/MGPIC-2025/"+e},Ia={},Al=function(t,s,n){let o=Promise.resolve();if(s&&s.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));o=Promise.allSettled(s.map(l=>{if(l=of(l),l in Ia)return;Ia[l]=!0;const u=l.endsWith(".css"),c=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${c}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":nf,u||(d.as="script"),d.crossOrigin="",d.href=l,r&&d.setAttribute("nonce",r),document.head.appendChild(d),u)return new Promise((p,m)=>{d.addEventListener("load",p),d.addEventListener("error",()=>m(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&i(r.reason);return t().catch(i)})};class af{constructor(){this.queue=[],this.isProcessing=!1,this.handlers=new Map,this.sceneContext=null}setSceneContext(t){this.sceneContext=t}registerHandler(t,s){this.handlers.set(t,s)}enqueue(t){["handle_on_click_copper","on_game_start"].includes(t.type_msg)&&f("[MessageQueue] :",t.type_msg),this.queue.push(t),this.isProcessing||this.processNext()}async processNext(){if(this.queue.length===0){this.isProcessing=!1;return}this.isProcessing=!0;const t=50;let s=0;for(;this.queue.length>0&&s<t;){const n=this.queue.shift();s++;try{const{type_msg:o,content:i}=n,a=this.handlers.get(o);if(a){const r=JSON.parse(i),l=a(r,this.sceneContext||{});l&&typeof l.then=="function"&&await l}else f("[MessageQueue] :",o),f("[MessageQueue] :",Array.from(this.handlers.keys()))}catch(o){f("[MessageQueue] :",o),f("[MessageQueue] :",o.message),f("[MessageQueue] :",o.stack)}}this.queue.length>0?requestAnimationFrame(()=>this.processNext()):this.isProcessing=!1}}const be=new af;function jn(e,t){return e.find(s=>s.id===t)}function Oa(e){return new Promise(t=>setTimeout(t,e))}function Ml(){f("[MessageQueue] ..."),be.registerHandler("handle_on_click_copper",async(i,a)=>{var c;const{copper:r,resources:l,has_attack_targets:u}=i;f(`[Handler] : ${((c=r.copper.copper_info)==null?void 0:c.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.copper.attribute.health}, =${r.can_move}, =${r.can_attack}, =${r.can_summon}, =${u}`),a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowCopperInfo&&a.onShowCopperInfo(r,l,u)}),be.registerHandler("handle_on_click_enemy",async(i,a)=>{var m,g;const{enemy:r,resources:l,has_attack_targets:u}=i,c=r.owned||!1;f(`[Handler] ${c?"":""}: ${((m=r.enemy_base)==null?void 0:m.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.enemy_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${u}`);const p={id:r.id,now_health:r.now_health,can_move:c?r.can_move:!1,can_attack:c?r.can_attack:!1,can_summon:!1,position:r.position,isEnemy:!c,isOwnedEnemy:c,copper:{copper_info:{name:((g=r.enemy_base)==null?void 0:g.name)||(c?"":"")},attribute:{health:r.enemy_base.health,attack:r.enemy_base.attack,defense:r.enemy_base.defense}},inventory:{items:[],capacity:0}};a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowCopperInfo&&a.onShowCopperInfo(p,l,u)}),be.registerHandler("handle_on_click_structure",async(i,a)=>{var d;const{structure:r,resources:l}=i,c=r.owned||!1?"":"";f(`[Handler] ${c}: ${((d=r.structure_base)==null?void 0:d.name)||"Unknown"} (ID=${r.id})`),f(`[Handler] : HP=${r.now_health}/${r.structure_base.health}, =${r.can_move}, =${r.can_attack}, owned=${r.owned}, =${r.structure_base.has_storage}`),a.highlightSelectedCopper&&a.highlightSelectedCopper(r.id),a.onShowStructureInfo&&a.onShowStructureInfo(r,l)}),be.registerHandler("set_copper",async(i,a)=>{const{id:r,position:l,copper:u}=i;window.__ACTUAL_COPPER_IDS__&&window.__ACTUAL_COPPER_IDS__.push(u.id),a.onSetCopper&&await a.onSetCopper(r,l,u)}),be.registerHandler("set_enemy",async(i,a)=>{const{id:r,position:l,enemy:u}=i;a.onSetEnemy&&a.onSetEnemy(r,l,u)}),be.registerHandler("set_material",async(i,a)=>{const{id:r,position:l,material:u}=i;a.onSetMaterial&&await a.onSetMaterial(r,l,u)}),be.registerHandler("set_structure",async(i,a)=>{const{id:r,position:l,structure:u}=i;a.onSetStructure&&await a.onSetStructure(r,l,u)}),be.registerHandler("remove_unit",async(i,a)=>{const{id:r}=i,l=jn(a.models||[],r);if(l&&l.object){l.object.traverse(d=>{d.material&&(Array.isArray(d.material)?d.material=d.material.map(p=>p.clone()):d.material=d.material.clone())});const u=500,c=performance.now();if(await new Promise(d=>{function p(){const m=performance.now()-c,g=Math.min(m/u,1);l.object&&l.object.traverse(v=>{v.material&&(Array.isArray(v.material)?v.material.forEach(y=>{y.transparent=!0,y.opacity=1-g}):(v.material.transparent=!0,v.material.opacity=1-g))}),g<1?requestAnimationFrame(p):d()}p()}),a.scene&&a.scene.remove(l.object),l.object.traverse(d=>{d.geometry&&d.geometry.dispose(),d.material&&(Array.isArray(d.material)?d.material.forEach(p=>{p.map&&p.map.dispose(),p.lightMap&&p.lightMap.dispose(),p.bumpMap&&p.bumpMap.dispose(),p.normalMap&&p.normalMap.dispose(),p.specularMap&&p.specularMap.dispose(),p.envMap&&p.envMap.dispose(),p.alphaMap&&p.alphaMap.dispose(),p.aoMap&&p.aoMap.dispose(),p.displacementMap&&p.displacementMap.dispose(),p.emissiveMap&&p.emissiveMap.dispose(),p.metalnessMap&&p.metalnessMap.dispose(),p.roughnessMap&&p.roughnessMap.dispose(),p.dispose()}):(d.material.map&&d.material.map.dispose(),d.material.lightMap&&d.material.lightMap.dispose(),d.material.bumpMap&&d.material.bumpMap.dispose(),d.material.normalMap&&d.material.normalMap.dispose(),d.material.specularMap&&d.material.specularMap.dispose(),d.material.envMap&&d.material.envMap.dispose(),d.material.alphaMap&&d.material.alphaMap.dispose(),d.material.aoMap&&d.material.aoMap.dispose(),d.material.displacementMap&&d.material.displacementMap.dispose(),d.material.emissiveMap&&d.material.emissiveMap.dispose(),d.material.metalnessMap&&d.material.metalnessMap.dispose(),d.material.roughnessMap&&d.material.roughnessMap.dispose(),d.material.dispose()))}),a.models){const d=a.models.indexOf(l);d>-1&&a.models.splice(d,1)}a.onClearState&&a.onClearState(r),a.onRemoveHealthBar&&a.onRemoveHealthBar(r),l.type==="copper"&&a.onRemoveCopper&&a.onRemoveCopper(r)}}),be.registerHandler("change_direction",async(i,a)=>{const{id:r,direction:l}=i,u=jn(a.models||[],r);if(u&&u.object){let c=0;switch(l){case"PositiveY":c=0;break;case"PositiveX":c=Math.PI/2;break;case"NegativeY":c=Math.PI;break;case"NegativeX":c=-Math.PI/2;break}let d=u.object.rotation.y;d=Math.atan2(Math.sin(d),Math.cos(d));let p=c-d;p>Math.PI?p-=2*Math.PI:p<-Math.PI&&(p+=2*Math.PI);const m=300,g=performance.now();await new Promise(v=>{function y(){const $=performance.now()-g,C=Math.min($/m,1),S=1-Math.pow(1-C,2);u.object&&(u.object.rotation.y=d+p*S),C<1?requestAnimationFrame(y):(u.object&&(u.object.rotation.y=c),v())}y()})}}),be.registerHandler("move_to",async(i,a)=>{const{id:r,to:l}=i,u=jn(a.models||[],r);if(u&&u.object&&a.gridCellSize){const[c,d]=l,p=c,m=d,g=u.object.position.y;a.animateModelMove&&await new Promise(v=>{a.animateModelMove(u,{x:p,y:g,z:m},v)}),a.onMoveComplete&&a.onMoveComplete(r)}}),be.registerHandler("display_can_move",(i,a)=>{const{id:r,can_move:l}=i,u=l==="true"||l===!0;a.onDisplayCanMove&&a.onDisplayCanMove(r,u)}),be.registerHandler("display_can_attack",(i,a)=>{const{id:r,can_attack:l}=i,u=l==="true"||l===!0;a.onDisplayCanAttack&&a.onDisplayCanAttack(r,u)}),be.registerHandler("display_can_summon",(i,a)=>{const{id:r,can_summon:l}=i,u=l==="true"||l===!0;f(`[Handler] display_can_summon id=${r}, can_summon=${u}`),a.onDisplayCanSummon&&a.onDisplayCanSummon(r,u)}),be.registerHandler("update_health",(i,a)=>{const{id:r,now_health:l,max_health:u}=i;a.onUpdateHealth&&a.onUpdateHealth(r,l,u)}),be.registerHandler("clear_state",(i,a)=>{const{id:r}=i;a.onClearState&&a.onClearState(r)}),be.registerHandler("animate_move",async(i,a)=>{const{id:r}=i,l=jn(a.models||[],r);if(!l){f(`[Handler] animate_move:  ID=${r}`);return}if(window.disableAutoFocus){f(`[Handler] animate_move:  ID=${r}`);return}const u=a.followEnemies!==void 0?a.followEnemies:!1;if(l.type==="enemy"&&!u){f(`[Handler] animate_move:  ID=${r}  context.followEnemies = true `);return}if(a.camera&&a.focusOnModel){const c=a.focusOnModel(l.object,a.camera,a.controls);a.focusState&&(a.focusState.focusPosition=c.focusPosition,a.focusState.focusTarget=c.focusTarget,a.focusState.lerpFactor=c.lerpFactor,f(`[Handler] animate_move:  ID=${r} (${l.name})`)),await Oa(1e3)}}),be.registerHandler("animate_reset",async(i,a)=>{if(f("[Handler] animate_reset"),a.camera&&a.controls){const r={x:0,y:2,z:5},l={x:0,y:0,z:0};a.focusState&&(a.focusState.focusPosition=r,a.focusState.focusTarget=l,a.focusState.lerpFactor=.08),await Oa(1e3)}}),be.registerHandler("put_map_block",(i,a)=>{const{position:r}=i;a.onPutMapBlock&&a.onPutMapBlock(r)}),be.registerHandler("put_room_blocks",async(i,a)=>{const{room_position:r,size:l}=i,[u,c]=r;if(f(`[Handler]  : [${u}, ${c}], ${l}x${l}`),!a.onPutMapBlock){f("[Handler]  context.onPutMapBlock ");return}f("[Handler]  context.onPutMapBlock ...");const d=32,p=l*l;let m=0;for(let g=0;g<l;g++)for(let v=0;v<l;v++){const y=[u+g,c+v];a.onPutMapBlock(y),m++,m%d===0&&await new Promise($=>requestAnimationFrame($))}f(`[Handler]  : ${p}`)}),be.registerHandler("put_resource_marker",(i,a)=>{const{position:r}=i;a.onPutResourceMarker&&a.onPutResourceMarker(r)}),be.registerHandler("clear_resource_marker",(i,a)=>{const{position:r}=i;a.onClearResourceMarker&&a.onClearResourceMarker(r)});let e=0,t=0,s=0;be.registerHandler("set_move_block",(i,a)=>{const{position:r}=i;e++,a.onSetMoveBlock&&a.onSetMoveBlock(r)}),be.registerHandler("set_attack_block",(i,a)=>{const{position:r}=i;t++,a.onSetAttackBlock&&a.onSetAttackBlock(r),(t===1||t%10===0)&&f(`[Handler]  ${t} `)}),be.registerHandler("set_can_summon_blocks",(i,a)=>{const{position:r}=i;s++,a.onSetCanSummonBlock&&a.onSetCanSummonBlock(r),(s===1||s%10===0)&&f(`[Handler]  ${s} `)});let n=0,o=Date.now();be.registerHandler("clear_block",(i,a)=>{const{position:r}=i;a.onClearBlock&&a.onClearBlock(r),n++;const l=Date.now();l-o>500&&(n>1&&f(`[Handler]   ${n} `),n=0,e>0&&(f(`[Handler]  ${e} `),e=0),t>0&&(f(`[Handler]  ${t} `),t=0),s>0&&(f(`[Handler]  ${s} `),s=0)),o=l}),be.registerHandler("attack_complete",(i,a)=>{const{id:r}=i;a.onAttackComplete&&a.onAttackComplete(r)}),be.registerHandler("on_game_round_pass",(i,a)=>{}),be.registerHandler("craft_success",(i,a)=>{a.onCraftResult&&a.onCraftResult(!0,i.message||"")}),be.registerHandler("craft_failed",(i,a)=>{a.onCraftResult&&a.onCraftResult(!1,i.message||"")}),be.registerHandler("cannot_pick_up_item",(i,a)=>{f("[Handler] :",i.message||i)}),be.registerHandler("equipment_slot_full",(i,a)=>{f("[Handler] :",i.message||i)}),be.registerHandler("inventory_full",(i,a)=>{f("[Handler] :",i.message||i)}),be.registerHandler("resource_not_enough",(i,a)=>{let r="";if(i.missing&&Array.isArray(i.missing)&&i.missing.length>0){const l={HeartCrystalDust:"",RecallGear:"",SpiritalSpark:"",RefinedCopper:"",ResonantCrystal:""};r=`: ${i.missing.map(c=>{const d=l[c.type]||c.type,p=c.needed-c.current;return`${d} ( ${p})`}).join("")}`}f("[Handler] :",r),a.onResourceNotEnough&&a.onResourceNotEnough(r)}),be.registerHandler("summon_failed",(i,a)=>{f("[Handler] :",i.message||i),a.onSummonFailed&&a.onSummonFailed(i.message||"")}),be.registerHandler("summon_expired",(i,a)=>{const{id:r,message:l}=i;f(`[Handler] : ID=${r}, ${l}`)}),be.registerHandler("get_summon_menu",(i,a)=>{const{contents:r}=i;f("[Handler] :",r),a.onShowSummonMenu&&a.onShowSummonMenu(r)}),be.registerHandler("get_structure_menu",(i,a)=>{const{contents:r}=i;if(!r||r.length===0){f("[Handler]  ");return}const l=r.filter(u=>u.name!=="");f("[Handler] ",l.length,""),a.onShowStructureMenu&&a.onShowStructureMenu(l)})}const rf=Object.freeze(Object.defineProperty({__proto__:null,messageQueue:be,registerAllHandlers:Ml},Symbol.toStringTag,{value:"Module"}));Ml();let qe=null,Us=null;Us=(async()=>{try{return qe=await Al(()=>import("./main-DZaXuJRE.js"),[]),f("[Glue] main.js "),qe}catch(e){return f("[Glue] main.js :",e.message),null}})();async function lf(){return await Us,qe!=null&&qe.global_gacha?JSON.parse(qe.global_gacha()):{type:"error",content:""}}async function Jn(){return await Us,qe!=null&&qe.global_get_resource?JSON.parse(qe.global_get_resource()):{}}async function Zn(){return await Us,qe!=null&&qe.global_get_copper_list?JSON.parse(qe.global_get_copper_list()):[]}async function cf(e){return await Us,qe!=null&&qe.global_upgrade_copper?JSON.parse(qe.global_upgrade_copper(e)):{type:"error",content:""}}async function Cl(e){await Us,qe!=null&&qe.global_info_subscribe?(qe.global_info_subscribe(t=>{const s=JSON.parse(t);e(s),be.enqueue(s)}),f("[Glue] global_info_subscribe ")):f("[Glue] global_info_subscribe ")}async function _e(e){await Us,qe!=null&&qe.eventloop?qe.eventloop(e):f("[Glue] eventloop ")}const uf={class:"draw-screen"},df={class:"draw-screen__body"},ff={class:"draw-card"},hf={class:"card-face card-back"},pf=["src"],mf={class:"card-face card-front"},gf=["src"],_f={key:1,class:"card-icon"},yf=["src"],vf={class:"draw-cost"},bf=["src"],wf=["disabled","title"],Sf={key:0,class:"toast"},Tf={__name:"DrawScreen",emits:["draw"],setup(e,{emit:t}){const s=t,n=Z(!1),o=Z(!0),i=Z(!1),a=Z(""),r=Z(""),l=Z(""),u=Z({left:0,top:0,width:0,height:0}),c=Z(!1),d=Z(!1),p=Z(!1),m=Z("");function g(C){m.value=C||"",p.value=!0,setTimeout(()=>{p.value=!1},1800)}async function v(){try{const S=await Jn(),M=Number((S==null?void 0:S.SpiritalSpark)??0);o.value=M>=10}catch{o.value=!1}}function y(){i.value=!1,c.value=!1,d.value=!1}function $(){if(n.value)return;if(v(),!o.value){g("");return}n.value=!0,f("[DrawScreen] runDrawSequence start");const C=document.querySelector(".draw-card");if(C){C.classList.add("is-shaking"),setTimeout(()=>C.classList.remove("is-shaking"),500);const S=C.getBoundingClientRect();u.value={left:Math.round(S.left),top:Math.round(S.top),width:Math.round(S.width),height:Math.round(S.height)}}setTimeout(async()=>{i.value=!0,c.value=!1,d.value=!0;try{const S=await lf();if(S&&S.type==="success"&&S.copper&&S.copper.copper_info){const M=S.copper.copper_info;a.value=M.name||"",r.value="",l.value=oe(M.icon_url||""),f("[DrawScreen] tempImage resolved:",l.value),await An(),setTimeout(()=>{d.value=!1,setTimeout(()=>{c.value=!0},350)},450),s("draw",{name:M.name,image:M.icon_url||""}),v()}else S&&S.type==="error"&&(i.value=!1,c.value=!1,d.value=!1,g(S.content||""),s("draw",{error:!0}),v())}catch{i.value=!1,c.value=!1,d.value=!1,g(""),s("draw",{error:!0}),v()}finally{setTimeout(()=>{n.value=!1},800)}},600)}return(C,S)=>(G(),j("div",uf,[h("div",df,[h("div",ff,[i.value?(G(),j("div",{key:0,class:"draw-temp",onClick:y},[S[3]||(S[3]=h("div",{class:"dim-backdrop"},null,-1)),h("div",{class:"temp-stack",style:jt({left:u.value.left+"px",top:u.value.top+"px",width:u.value.width+"px",height:u.value.height+"px"}),onClick:S[2]||(S[2]=Vt(()=>{},["stop"]))},[h("div",{class:nt(["card",{flipped:d.value}]),onClick:S[0]||(S[0]=Vt(M=>d.value=!d.value,["stop"]))},[h("div",hf,[h("img",{src:Ae(oe)("frontend_resource/gacha.webp"),alt:"back"},null,8,pf)]),h("div",mf,[l.value?(G(),j("img",{key:0,src:l.value,alt:"copper",class:"card-front-img"},null,8,gf)):(G(),j("div",_f,ee(r.value||""),1))])],2),h("div",{class:nt(["card-name-below",{show:c.value}]),onClick:S[1]||(S[1]=Vt(()=>{},["stop"]))},ee(a.value),3)],4)])):we("",!0),h("img",{class:"draw-card__img",src:Ae(oe)("frontend_resource/gacha.webp"),alt:"card"},null,8,yf)]),h("div",vf,[h("img",{class:"draw-cost__icon",src:Ae(oe)("resource/spiritual_spark.webp"),alt:"cost"},null,8,bf),S[4]||(S[4]=h("span",{class:"draw-cost__times"},"X 10",-1))]),h("button",{class:"draw-action",disabled:n.value||!o.value,title:o.value?"":"",onClick:$},"  ",8,wf),p.value?(G(),j("div",Sf,ee(m.value),1)):we("",!0)])]))}},Af=ct(Tf,[["__scopeId","data-v-cb43f783"]]);function Da(e,t){if(t===Bl)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t===Zo||t===qa){let s=e.getIndex();if(s===null){const a=[],r=e.getAttribute("position");if(r!==void 0){for(let l=0;l<r.count;l++)a.push(l);e.setIndex(a),s=e.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e}const n=s.count-2,o=[];if(t===Zo)for(let a=1;a<=n;a++)o.push(s.getX(0)),o.push(s.getX(a)),o.push(s.getX(a+1));else for(let a=0;a<n;a++)a%2===0?(o.push(s.getX(a)),o.push(s.getX(a+1)),o.push(s.getX(a+2))):(o.push(s.getX(a+2)),o.push(s.getX(a+1)),o.push(s.getX(a)));o.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=e.clone();return i.setIndex(o),i.clearGroups(),i}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e}class ko extends Xa{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(s){return new kf(s)}),this.register(function(s){return new Rf(s)}),this.register(function(s){return new Gf(s)}),this.register(function(s){return new Ff(s)}),this.register(function(s){return new Uf(s)}),this.register(function(s){return new Pf(s)}),this.register(function(s){return new Lf(s)}),this.register(function(s){return new If(s)}),this.register(function(s){return new Of(s)}),this.register(function(s){return new Ef(s)}),this.register(function(s){return new Df(s)}),this.register(function(s){return new $f(s)}),this.register(function(s){return new Hf(s)}),this.register(function(s){return new Nf(s)}),this.register(function(s){return new Cf(s)}),this.register(function(s){return new Bf(s)}),this.register(function(s){return new jf(s)})}load(t,s,n,o){const i=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const u=un.extractUrlBase(t);a=un.resolveURL(u,this.path)}else a=un.extractUrlBase(t);this.manager.itemStart(t);const r=function(u){o?o(u):console.error(u),i.manager.itemError(t),i.manager.itemEnd(t)},l=new Qn(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(t,function(u){try{i.parse(u,a,function(c){s(c),i.manager.itemEnd(t)},r)}catch(c){r(c)}},n,r)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,s,n,o){let i;const a={},r={},l=new TextDecoder;if(typeof t=="string")i=JSON.parse(t);else if(t instanceof ArrayBuffer)if(l.decode(new Uint8Array(t,0,4))===xl){try{a[Ce.KHR_BINARY_GLTF]=new zf(t)}catch(d){o&&o(d);return}i=JSON.parse(a[Ce.KHR_BINARY_GLTF].content)}else i=JSON.parse(l.decode(t));else i=t;if(i.asset===void 0||i.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const u=new nh(i,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});u.fileLoader.setRequestHeader(this.requestHeader);for(let c=0;c<this.pluginCallbacks.length;c++){const d=this.pluginCallbacks[c](u);d.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[d.name]=d,a[d.name]=!0}if(i.extensionsUsed)for(let c=0;c<i.extensionsUsed.length;++c){const d=i.extensionsUsed[c],p=i.extensionsRequired||[];switch(d){case Ce.KHR_MATERIALS_UNLIT:a[d]=new xf;break;case Ce.KHR_DRACO_MESH_COMPRESSION:a[d]=new Vf(i,this.dracoLoader);break;case Ce.KHR_TEXTURE_TRANSFORM:a[d]=new Kf;break;case Ce.KHR_MESH_QUANTIZATION:a[d]=new Wf;break;default:p.indexOf(d)>=0&&r[d]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+d+'".')}}u.setExtensions(a),u.setPlugins(r),u.parse(n,o)}parseAsync(t,s){const n=this;return new Promise(function(o,i){n.parse(t,s,o,i)})}}function Mf(){let e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}const Ce={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Cf{constructor(t){this.parser=t,this.name=Ce.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,s=this.parser.json.nodes||[];for(let n=0,o=s.length;n<o;n++){const i=s[n];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const s=this.parser,n="light:"+t;let o=s.cache.get(n);if(o)return o;const i=s.json,l=((i.extensions&&i.extensions[this.name]||{}).lights||[])[t];let u;const c=new os(16777215);l.color!==void 0&&c.setRGB(l.color[0],l.color[1],l.color[2],is);const d=l.range!==void 0?l.range:0;switch(l.type){case"directional":u=new hs(c),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new zs(c),u.distance=d;break;case"spot":u=new jl(c),u.distance=d,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,u.angle=l.spot.outerConeAngle,u.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return u.position.set(0,0,0),ts(u,l),l.intensity!==void 0&&(u.intensity=l.intensity),u.name=s.createUniqueName(l.name||"light_"+t),o=Promise.resolve(u),s.cache.add(n,o),o}getDependency(t,s){if(t==="light")return this._loadLight(s)}createNodeAttachment(t){const s=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(l){return n._getNodeRef(s.cache,r,l)})}}class xf{constructor(){this.name=Ce.KHR_MATERIALS_UNLIT}getMaterialType(){return Bt}extendParams(t,s,n){const o=[];t.color=new os(1,1,1),t.opacity=1;const i=s.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const a=i.baseColorFactor;t.color.setRGB(a[0],a[1],a[2],is),t.opacity=a[3]}i.baseColorTexture!==void 0&&o.push(n.assignTexture(t,"map",i.baseColorTexture,ps))}return Promise.all(o)}}class Ef{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,s){const o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name].emissiveStrength;return i!==void 0&&(s.emissiveIntensity=i),Promise.resolve()}}class kf{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];if(a.clearcoatFactor!==void 0&&(s.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&i.push(n.assignTexture(s,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(s.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&i.push(n.assignTexture(s,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(i.push(n.assignTexture(s,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const r=a.clearcoatNormalTexture.scale;s.clearcoatNormalScale=new xt(r,r)}return Promise.all(i)}}class Rf{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_DISPERSION}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name];return s.dispersion=i.dispersion!==void 0?i.dispersion:0,Promise.resolve()}}class $f{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.iridescenceFactor!==void 0&&(s.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&i.push(n.assignTexture(s,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(s.iridescenceIOR=a.iridescenceIor),s.iridescenceThicknessRange===void 0&&(s.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(s.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(s.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&i.push(n.assignTexture(s,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(i)}}class Pf{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_SHEEN}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[];s.sheenColor=new os(0,0,0),s.sheenRoughness=0,s.sheen=1;const a=o.extensions[this.name];if(a.sheenColorFactor!==void 0){const r=a.sheenColorFactor;s.sheenColor.setRGB(r[0],r[1],r[2],is)}return a.sheenRoughnessFactor!==void 0&&(s.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&i.push(n.assignTexture(s,"sheenColorMap",a.sheenColorTexture,ps)),a.sheenRoughnessTexture!==void 0&&i.push(n.assignTexture(s,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(i)}}class Lf{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.transmissionFactor!==void 0&&(s.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&i.push(n.assignTexture(s,"transmissionMap",a.transmissionTexture)),Promise.all(i)}}class If{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_VOLUME}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];s.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&i.push(n.assignTexture(s,"thicknessMap",a.thicknessTexture)),s.attenuationDistance=a.attenuationDistance||1/0;const r=a.attenuationColor||[1,1,1];return s.attenuationColor=new os().setRGB(r[0],r[1],r[2],is),Promise.all(i)}}class Of{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_IOR}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const o=this.parser.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=o.extensions[this.name];return s.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Df{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_SPECULAR}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];s.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&i.push(n.assignTexture(s,"specularIntensityMap",a.specularTexture));const r=a.specularColorFactor||[1,1,1];return s.specularColor=new os().setRGB(r[0],r[1],r[2],is),a.specularColorTexture!==void 0&&i.push(n.assignTexture(s,"specularColorMap",a.specularColorTexture,ps)),Promise.all(i)}}class Nf{constructor(t){this.parser=t,this.name=Ce.EXT_MATERIALS_BUMP}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return s.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&i.push(n.assignTexture(s,"bumpMap",a.bumpTexture)),Promise.all(i)}}class Hf{constructor(t){this.parser=t,this.name=Ce.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const n=this.parser.json.materials[t];return!n.extensions||!n.extensions[this.name]?null:as}extendMaterialParams(t,s){const n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const i=[],a=o.extensions[this.name];return a.anisotropyStrength!==void 0&&(s.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(s.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&i.push(n.assignTexture(s,"anisotropyMap",a.anisotropyTexture)),Promise.all(i)}}class Gf{constructor(t){this.parser=t,this.name=Ce.KHR_TEXTURE_BASISU}loadTexture(t){const s=this.parser,n=s.json,o=n.textures[t];if(!o.extensions||!o.extensions[this.name])return null;const i=o.extensions[this.name],a=s.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return s.loadTextureImage(t,i.source,a)}}class Ff{constructor(t){this.parser=t,this.name=Ce.EXT_TEXTURE_WEBP}loadTexture(t){const s=this.name,n=this.parser,o=n.json,i=o.textures[t];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],r=o.images[a.source];let l=n.textureLoader;if(r.uri){const u=n.options.manager.getHandler(r.uri);u!==null&&(l=u)}return n.loadTextureImage(t,a.source,l)}}class Uf{constructor(t){this.parser=t,this.name=Ce.EXT_TEXTURE_AVIF}loadTexture(t){const s=this.name,n=this.parser,o=n.json,i=o.textures[t];if(!i.extensions||!i.extensions[s])return null;const a=i.extensions[s],r=o.images[a.source];let l=n.textureLoader;if(r.uri){const u=n.options.manager.getHandler(r.uri);u!==null&&(l=u)}return n.loadTextureImage(t,a.source,l)}}class Bf{constructor(t){this.name=Ce.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const s=this.parser.json,n=s.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const o=n.extensions[this.name],i=this.parser.getDependency("buffer",o.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return i.then(function(r){const l=o.byteOffset||0,u=o.byteLength||0,c=o.count,d=o.byteStride,p=new Uint8Array(r,l,u);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(c,d,p,o.mode,o.filter).then(function(m){return m.buffer}):a.ready.then(function(){const m=new ArrayBuffer(c*d);return a.decodeGltfBuffer(new Uint8Array(m),c,d,p,o.mode,o.filter),m})})}else return null}}class jf{constructor(t){this.name=Ce.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const s=this.parser.json,n=s.nodes[t];if(!n.extensions||!n.extensions[this.name]||n.mesh===void 0)return null;const o=s.meshes[n.mesh];for(const u of o.primitives)if(u.mode!==Ut.TRIANGLES&&u.mode!==Ut.TRIANGLE_STRIP&&u.mode!==Ut.TRIANGLE_FAN&&u.mode!==void 0)return null;const a=n.extensions[this.name].attributes,r=[],l={};for(const u in a)r.push(this.parser.getDependency("accessor",a[u]).then(c=>(l[u]=c,l[u])));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then(u=>{const c=u.pop(),d=c.isGroup?c.children:[c],p=u[0].count,m=[];for(const g of d){const v=new Hs,y=new Pe,$=new wn,C=new Pe(1,1,1),S=new Ya(g.geometry,g.material,p);for(let M=0;M<p;M++)l.TRANSLATION&&y.fromBufferAttribute(l.TRANSLATION,M),l.ROTATION&&$.fromBufferAttribute(l.ROTATION,M),l.SCALE&&C.fromBufferAttribute(l.SCALE,M),S.setMatrixAt(M,v.compose(y,$,C));for(const M in l)if(M==="_COLOR_0"){const F=l[M];S.instanceColor=new zl(F.array,F.itemSize,F.normalized)}else M!=="TRANSLATION"&&M!=="ROTATION"&&M!=="SCALE"&&g.geometry.setAttribute(M,l[M]);Ja.prototype.copy.call(S,g),this.parser.assignFinalMaterial(S),m.push(S)}return c.isGroup?(c.clear(),c.add(...m),c):m[0]}))}}const xl="glTF",ln=12,Na={JSON:1313821514,BIN:5130562};class zf{constructor(t){this.name=Ce.KHR_BINARY_GLTF,this.content=null,this.body=null;const s=new DataView(t,0,ln),n=new TextDecoder;if(this.header={magic:n.decode(new Uint8Array(t.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==xl)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-ln,i=new DataView(t,ln);let a=0;for(;a<o;){const r=i.getUint32(a,!0);a+=4;const l=i.getUint32(a,!0);if(a+=4,l===Na.JSON){const u=new Uint8Array(t,ln+a,r);this.content=n.decode(u)}else if(l===Na.BIN){const u=ln+a;this.body=t.slice(u,u+r)}a+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Vf{constructor(t,s){if(!s)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ce.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=s,this.dracoLoader.preload()}decodePrimitive(t,s){const n=this.json,o=this.dracoLoader,i=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,r={},l={},u={};for(const c in a){const d=yi[c]||c.toLowerCase();r[d]=a[c]}for(const c in t.attributes){const d=yi[c]||c.toLowerCase();if(a[c]!==void 0){const p=n.accessors[t.attributes[c]],m=Qs[p.componentType];u[d]=m.name,l[d]=p.normalized===!0}}return s.getDependency("bufferView",i).then(function(c){return new Promise(function(d,p){o.decodeDracoFile(c,function(m){for(const g in m.attributes){const v=m.attributes[g],y=l[g];y!==void 0&&(v.normalized=y)}d(m)},r,u,is,p)})})}}class Kf{constructor(){this.name=Ce.KHR_TEXTURE_TRANSFORM}extendTexture(t,s){return(s.texCoord===void 0||s.texCoord===t.channel)&&s.offset===void 0&&s.rotation===void 0&&s.scale===void 0||(t=t.clone(),s.texCoord!==void 0&&(t.channel=s.texCoord),s.offset!==void 0&&t.offset.fromArray(s.offset),s.rotation!==void 0&&(t.rotation=s.rotation),s.scale!==void 0&&t.repeat.fromArray(s.scale),t.needsUpdate=!0),t}}class Wf{constructor(){this.name=Ce.KHR_MESH_QUANTIZATION}}class El extends fc{constructor(t,s,n,o){super(t,s,n,o)}copySampleValue_(t){const s=this.resultBuffer,n=this.sampleValues,o=this.valueSize,i=t*o*3+o;for(let a=0;a!==o;a++)s[a]=n[i+a];return s}interpolate_(t,s,n,o){const i=this.resultBuffer,a=this.sampleValues,r=this.valueSize,l=r*2,u=r*3,c=o-s,d=(n-s)/c,p=d*d,m=p*d,g=t*u,v=g-u,y=-2*m+3*p,$=m-p,C=1-y,S=$-p+d;for(let M=0;M!==r;M++){const F=a[v+M+r],X=a[v+M+l]*c,Y=a[g+M+r],P=a[g+M]*c;i[M]=C*F+S*X+y*Y+$*P}return i}}const qf=new wn;class Xf extends El{interpolate_(t,s,n,o){const i=super.interpolate_(t,s,n,o);return qf.fromArray(i).normalize().toArray(i),i}}const Ut={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Qs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Ha={9728:Qa,9729:Qo,9984:Yl,9985:Xl,9986:ql,9987:Za},Ga={33071:Zl,33648:Jl,10497:ei},Ko={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},yi={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ws={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Yf={CUBICSPLINE:void 0,LINEAR:nr,STEP:cc},Wo={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Jf(e){return e.DefaultMaterial===void 0&&(e.DefaultMaterial=new kt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:dc})),e.DefaultMaterial}function Is(e,t,s){for(const n in s.extensions)e[n]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[n]=s.extensions[n])}function ts(e,t){t.extras!==void 0&&(typeof t.extras=="object"?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function Zf(e,t,s){let n=!1,o=!1,i=!1;for(let u=0,c=t.length;u<c;u++){const d=t[u];if(d.POSITION!==void 0&&(n=!0),d.NORMAL!==void 0&&(o=!0),d.COLOR_0!==void 0&&(i=!0),n&&o&&i)break}if(!n&&!o&&!i)return Promise.resolve(e);const a=[],r=[],l=[];for(let u=0,c=t.length;u<c;u++){const d=t[u];if(n){const p=d.POSITION!==void 0?s.getDependency("accessor",d.POSITION):e.attributes.position;a.push(p)}if(o){const p=d.NORMAL!==void 0?s.getDependency("accessor",d.NORMAL):e.attributes.normal;r.push(p)}if(i){const p=d.COLOR_0!==void 0?s.getDependency("accessor",d.COLOR_0):e.attributes.color;l.push(p)}}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l)]).then(function(u){const c=u[0],d=u[1],p=u[2];return n&&(e.morphAttributes.position=c),o&&(e.morphAttributes.normal=d),i&&(e.morphAttributes.color=p),e.morphTargetsRelative=!0,e})}function Qf(e,t){if(e.updateMorphTargets(),t.weights!==void 0)for(let s=0,n=t.weights.length;s<n;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){const s=t.extras.targetNames;if(e.morphTargetInfluences.length===s.length){e.morphTargetDictionary={};for(let n=0,o=s.length;n<o;n++)e.morphTargetDictionary[s[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function eh(e){let t;const s=e.extensions&&e.extensions[Ce.KHR_DRACO_MESH_COMPRESSION];if(s?t="draco:"+s.bufferView+":"+s.indices+":"+qo(s.attributes):t=e.indices+":"+qo(e.attributes)+":"+e.mode,e.targets!==void 0)for(let n=0,o=e.targets.length;n<o;n++)t+=":"+qo(e.targets[n]);return t}function qo(e){let t="";const s=Object.keys(e).sort();for(let n=0,o=s.length;n<o;n++)t+=s[n]+":"+e[s[n]]+";";return t}function vi(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function th(e){return e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0?"image/jpeg":e.search(/\.webp($|\?)/i)>0||e.search(/^data\:image\/webp/)===0?"image/webp":e.search(/\.ktx2($|\?)/i)>0||e.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const sh=new Hs;class nh{constructor(t={},s={}){this.json=t,this.extensions={},this.plugins={},this.options=s,this.cache=new Mf,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let n=!1,o=-1,i=!1,a=-1;if(typeof navigator<"u"){const r=navigator.userAgent;n=/^((?!chrome|android).)*safari/i.test(r)===!0;const l=r.match(/Version\/(\d+)/);o=n&&l?parseInt(l[1],10):-1,i=r.indexOf("Firefox")>-1,a=i?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||n&&o<17||i&&a<98?this.textureLoader=new Vl(this.options.manager):this.textureLoader=new Kl(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Qn(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,s){const n=this,o=this.json,i=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const r={scene:a[0][o.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:o.asset,parser:n,userData:{}};return Is(i,r,o),ts(r,o),Promise.all(n._invokeAll(function(l){return l.afterRoot&&l.afterRoot(r)})).then(function(){for(const l of r.scenes)l.updateMatrixWorld();t(r)})}).catch(s)}_markDefs(){const t=this.json.nodes||[],s=this.json.skins||[],n=this.json.meshes||[];for(let o=0,i=s.length;o<i;o++){const a=s[o].joints;for(let r=0,l=a.length;r<l;r++)t[a[r]].isBone=!0}for(let o=0,i=t.length;o<i;o++){const a=t[o];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(t,s){s!==void 0&&(t.refs[s]===void 0&&(t.refs[s]=t.uses[s]=0),t.refs[s]++)}_getNodeRef(t,s,n){if(t.refs[s]<=1)return n;const o=n.clone(),i=(a,r)=>{const l=this.associations.get(a);l!=null&&this.associations.set(r,l);for(const[u,c]of a.children.entries())i(c,r.children[u])};return i(n,o),o.name+="_instance_"+t.uses[s]++,o}_invokeOne(t){const s=Object.values(this.plugins);s.push(this);for(let n=0;n<s.length;n++){const o=t(s[n]);if(o)return o}return null}_invokeAll(t){const s=Object.values(this.plugins);s.unshift(this);const n=[];for(let o=0;o<s.length;o++){const i=t(s[o]);i&&n.push(i)}return n}getDependency(t,s){const n=t+":"+s;let o=this.cache.get(n);if(!o){switch(t){case"scene":o=this.loadScene(s);break;case"node":o=this._invokeOne(function(i){return i.loadNode&&i.loadNode(s)});break;case"mesh":o=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(s)});break;case"accessor":o=this.loadAccessor(s);break;case"bufferView":o=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(s)});break;case"buffer":o=this.loadBuffer(s);break;case"material":o=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(s)});break;case"texture":o=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(s)});break;case"skin":o=this.loadSkin(s);break;case"animation":o=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(s)});break;case"camera":o=this.loadCamera(s);break;default:if(o=this._invokeOne(function(i){return i!=this&&i.getDependency&&i.getDependency(t,s)}),!o)throw new Error("Unknown type: "+t);break}this.cache.add(n,o)}return o}getDependencies(t){let s=this.cache.get(t);if(!s){const n=this,o=this.json[t+(t==="mesh"?"es":"s")]||[];s=Promise.all(o.map(function(i,a){return n.getDependency(t,a)})),this.cache.add(t,s)}return s}loadBuffer(t){const s=this.json.buffers[t],n=this.fileLoader;if(s.type&&s.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+s.type+" buffer type is not supported.");if(s.uri===void 0&&t===0)return Promise.resolve(this.extensions[Ce.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(i,a){n.load(un.resolveURL(s.uri,o.path),i,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+s.uri+'".'))})})}loadBufferView(t){const s=this.json.bufferViews[t];return this.getDependency("buffer",s.buffer).then(function(n){const o=s.byteLength||0,i=s.byteOffset||0;return n.slice(i,i+o)})}loadAccessor(t){const s=this,n=this.json,o=this.json.accessors[t];if(o.bufferView===void 0&&o.sparse===void 0){const a=Ko[o.type],r=Qs[o.componentType],l=o.normalized===!0,u=new r(o.count*a);return Promise.resolve(new dn(u,a,l))}const i=[];return o.bufferView!==void 0?i.push(this.getDependency("bufferView",o.bufferView)):i.push(null),o.sparse!==void 0&&(i.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(i).then(function(a){const r=a[0],l=Ko[o.type],u=Qs[o.componentType],c=u.BYTES_PER_ELEMENT,d=c*l,p=o.byteOffset||0,m=o.bufferView!==void 0?n.bufferViews[o.bufferView].byteStride:void 0,g=o.normalized===!0;let v,y;if(m&&m!==d){const $=Math.floor(p/m),C="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+$+":"+o.count;let S=s.cache.get(C);S||(v=new u(r,$*m,o.count*m/c),S=new Wl(v,m/c),s.cache.add(C,S)),y=new uc(S,l,p%m/c,g)}else r===null?v=new u(o.count*l):v=new u(r,p,o.count*l),y=new dn(v,l,g);if(o.sparse!==void 0){const $=Ko.SCALAR,C=Qs[o.sparse.indices.componentType],S=o.sparse.indices.byteOffset||0,M=o.sparse.values.byteOffset||0,F=new C(a[1],S,o.sparse.count*$),X=new u(a[2],M,o.sparse.count*l);r!==null&&(y=new dn(y.array.slice(),y.itemSize,y.normalized)),y.normalized=!1;for(let Y=0,P=F.length;Y<P;Y++){const R=F[Y];if(y.setX(R,X[Y*l]),l>=2&&y.setY(R,X[Y*l+1]),l>=3&&y.setZ(R,X[Y*l+2]),l>=4&&y.setW(R,X[Y*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}y.normalized=g}return y})}loadTexture(t){const s=this.json,n=this.options,i=s.textures[t].source,a=s.images[i];let r=this.textureLoader;if(a.uri){const l=n.manager.getHandler(a.uri);l!==null&&(r=l)}return this.loadTextureImage(t,i,r)}loadTextureImage(t,s,n){const o=this,i=this.json,a=i.textures[t],r=i.images[s],l=(r.uri||r.bufferView)+":"+a.sampler;if(this.textureCache[l])return this.textureCache[l];const u=this.loadImageSource(s,n).then(function(c){c.flipY=!1,c.name=a.name||r.name||"",c.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(c.name=r.uri);const p=(i.samplers||{})[a.sampler]||{};return c.magFilter=Ha[p.magFilter]||Qo,c.minFilter=Ha[p.minFilter]||Za,c.wrapS=Ga[p.wrapS]||ei,c.wrapT=Ga[p.wrapT]||ei,c.generateMipmaps=!c.isCompressedTexture&&c.minFilter!==Qa&&c.minFilter!==Qo,o.associations.set(c,{textures:t}),c}).catch(function(){return null});return this.textureCache[l]=u,u}loadImageSource(t,s){const n=this,o=this.json,i=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(d=>d.clone());const a=o.images[t],r=self.URL||self.webkitURL;let l=a.uri||"",u=!1;if(a.bufferView!==void 0)l=n.getDependency("bufferView",a.bufferView).then(function(d){u=!0;const p=new Blob([d],{type:a.mimeType});return l=r.createObjectURL(p),l});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(l).then(function(d){return new Promise(function(p,m){let g=p;s.isImageBitmapLoader===!0&&(g=function(v){const y=new Bi(v);y.needsUpdate=!0,p(y)}),s.load(un.resolveURL(d,i.path),g,void 0,m)})}).then(function(d){return u===!0&&r.revokeObjectURL(l),ts(d,a),d.userData.mimeType=a.mimeType||th(a.uri),d}).catch(function(d){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),d});return this.sourceCache[t]=c,c}assignTexture(t,s,n,o){const i=this;return this.getDependency("texture",n.index).then(function(a){if(!a)return null;if(n.texCoord!==void 0&&n.texCoord>0&&(a=a.clone(),a.channel=n.texCoord),i.extensions[Ce.KHR_TEXTURE_TRANSFORM]){const r=n.extensions!==void 0?n.extensions[Ce.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const l=i.associations.get(a);a=i.extensions[Ce.KHR_TEXTURE_TRANSFORM].extendTexture(a,r),i.associations.set(a,l)}}return o!==void 0&&(a.colorSpace=o),t[s]=a,a})}assignFinalMaterial(t){const s=t.geometry;let n=t.material;const o=s.attributes.tangent===void 0,i=s.attributes.color!==void 0,a=s.attributes.normal===void 0;if(t.isPoints){const r="PointsMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new Ql,Po.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,l.sizeAttenuation=!1,this.cache.add(r,l)),n=l}else if(t.isLine){const r="LineBasicMaterial:"+n.uuid;let l=this.cache.get(r);l||(l=new er,Po.prototype.copy.call(l,n),l.color.copy(n.color),l.map=n.map,this.cache.add(r,l)),n=l}if(o||i||a){let r="ClonedMaterial:"+n.uuid+":";o&&(r+="derivative-tangents:"),i&&(r+="vertex-colors:"),a&&(r+="flat-shading:");let l=this.cache.get(r);l||(l=n.clone(),i&&(l.vertexColors=!0),a&&(l.flatShading=!0),o&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(r,l),this.associations.set(l,this.associations.get(n))),n=l}t.material=n}getMaterialType(){return kt}loadMaterial(t){const s=this,n=this.json,o=this.extensions,i=n.materials[t];let a;const r={},l=i.extensions||{},u=[];if(l[Ce.KHR_MATERIALS_UNLIT]){const d=o[Ce.KHR_MATERIALS_UNLIT];a=d.getMaterialType(),u.push(d.extendParams(r,i,s))}else{const d=i.pbrMetallicRoughness||{};if(r.color=new os(1,1,1),r.opacity=1,Array.isArray(d.baseColorFactor)){const p=d.baseColorFactor;r.color.setRGB(p[0],p[1],p[2],is),r.opacity=p[3]}d.baseColorTexture!==void 0&&u.push(s.assignTexture(r,"map",d.baseColorTexture,ps)),r.metalness=d.metallicFactor!==void 0?d.metallicFactor:1,r.roughness=d.roughnessFactor!==void 0?d.roughnessFactor:1,d.metallicRoughnessTexture!==void 0&&(u.push(s.assignTexture(r,"metalnessMap",d.metallicRoughnessTexture)),u.push(s.assignTexture(r,"roughnessMap",d.metallicRoughnessTexture))),a=this._invokeOne(function(p){return p.getMaterialType&&p.getMaterialType(t)}),u.push(Promise.all(this._invokeAll(function(p){return p.extendMaterialParams&&p.extendMaterialParams(t,r)})))}i.doubleSided===!0&&(r.side=Ds);const c=i.alphaMode||Wo.OPAQUE;if(c===Wo.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,c===Wo.MASK&&(r.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&a!==Bt&&(u.push(s.assignTexture(r,"normalMap",i.normalTexture)),r.normalScale=new xt(1,1),i.normalTexture.scale!==void 0)){const d=i.normalTexture.scale;r.normalScale.set(d,d)}if(i.occlusionTexture!==void 0&&a!==Bt&&(u.push(s.assignTexture(r,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&a!==Bt){const d=i.emissiveFactor;r.emissive=new os().setRGB(d[0],d[1],d[2],is)}return i.emissiveTexture!==void 0&&a!==Bt&&u.push(s.assignTexture(r,"emissiveMap",i.emissiveTexture,ps)),Promise.all(u).then(function(){const d=new a(r);return i.name&&(d.name=i.name),ts(d,i),s.associations.set(d,{materials:t}),i.extensions&&Is(o,d,i),d})}createUniqueName(t){const s=ec.sanitizeNodeName(t||"");return s in this.nodeNamesUsed?s+"_"+ ++this.nodeNamesUsed[s]:(this.nodeNamesUsed[s]=0,s)}loadGeometries(t){const s=this,n=this.extensions,o=this.primitiveCache;function i(r){return n[Ce.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,s).then(function(l){return Fa(l,r,s)})}const a=[];for(let r=0,l=t.length;r<l;r++){const u=t[r],c=eh(u),d=o[c];if(d)a.push(d.promise);else{let p;u.extensions&&u.extensions[Ce.KHR_DRACO_MESH_COMPRESSION]?p=i(u):p=Fa(new bi,u,s),o[c]={primitive:u,promise:p},a.push(p)}}return Promise.all(a)}loadMesh(t){const s=this,n=this.json,o=this.extensions,i=n.meshes[t],a=i.primitives,r=[];for(let l=0,u=a.length;l<u;l++){const c=a[l].material===void 0?Jf(this.cache):this.getDependency("material",a[l].material);r.push(c)}return r.push(s.loadGeometries(a)),Promise.all(r).then(function(l){const u=l.slice(0,l.length-1),c=l[l.length-1],d=[];for(let m=0,g=c.length;m<g;m++){const v=c[m],y=a[m];let $;const C=u[m];if(y.mode===Ut.TRIANGLES||y.mode===Ut.TRIANGLE_STRIP||y.mode===Ut.TRIANGLE_FAN||y.mode===void 0)$=i.isSkinnedMesh===!0?new tc(v,C):new it(v,C),$.isSkinnedMesh===!0&&$.normalizeSkinWeights(),y.mode===Ut.TRIANGLE_STRIP?$.geometry=Da($.geometry,qa):y.mode===Ut.TRIANGLE_FAN&&($.geometry=Da($.geometry,Zo));else if(y.mode===Ut.LINES)$=new sc(v,C);else if(y.mode===Ut.LINE_STRIP)$=new tr(v,C);else if(y.mode===Ut.LINE_LOOP)$=new nc(v,C);else if(y.mode===Ut.POINTS)$=new oc(v,C);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);Object.keys($.geometry.morphAttributes).length>0&&Qf($,i),$.name=s.createUniqueName(i.name||"mesh_"+t),ts($,i),y.extensions&&Is(o,$,y),s.assignFinalMaterial($),d.push($)}for(let m=0,g=d.length;m<g;m++)s.associations.set(d[m],{meshes:t,primitives:m});if(d.length===1)return i.extensions&&Is(o,d[0],i),d[0];const p=new Xt;i.extensions&&Is(o,p,i),s.associations.set(p,{meshes:t});for(let m=0,g=d.length;m<g;m++)p.add(d[m]);return p})}loadCamera(t){let s;const n=this.json.cameras[t],o=n[n.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return n.type==="perspective"?s=new Rn(sr.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):n.type==="orthographic"&&(s=new ic(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(s.name=this.createUniqueName(n.name)),ts(s,n),Promise.resolve(s)}loadSkin(t){const s=this.json.skins[t],n=[];for(let o=0,i=s.joints.length;o<i;o++)n.push(this._loadNodeShallow(s.joints[o]));return s.inverseBindMatrices!==void 0?n.push(this.getDependency("accessor",s.inverseBindMatrices)):n.push(null),Promise.all(n).then(function(o){const i=o.pop(),a=o,r=[],l=[];for(let u=0,c=a.length;u<c;u++){const d=a[u];if(d){r.push(d);const p=new Hs;i!==null&&p.fromArray(i.array,u*16),l.push(p)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[u])}return new ac(r,l)})}loadAnimation(t){const s=this.json,n=this,o=s.animations[t],i=o.name?o.name:"animation_"+t,a=[],r=[],l=[],u=[],c=[];for(let d=0,p=o.channels.length;d<p;d++){const m=o.channels[d],g=o.samplers[m.sampler],v=m.target,y=v.node,$=o.parameters!==void 0?o.parameters[g.input]:g.input,C=o.parameters!==void 0?o.parameters[g.output]:g.output;v.node!==void 0&&(a.push(this.getDependency("node",y)),r.push(this.getDependency("accessor",$)),l.push(this.getDependency("accessor",C)),u.push(g),c.push(v))}return Promise.all([Promise.all(a),Promise.all(r),Promise.all(l),Promise.all(u),Promise.all(c)]).then(function(d){const p=d[0],m=d[1],g=d[2],v=d[3],y=d[4],$=[];for(let S=0,M=p.length;S<M;S++){const F=p[S],X=m[S],Y=g[S],P=v[S],R=y[S];if(F===void 0)continue;F.updateMatrix&&F.updateMatrix();const V=n._createAnimationTracks(F,X,Y,P,R);if(V)for(let N=0;N<V.length;N++)$.push(V[N])}const C=new rc(i,void 0,$);return ts(C,o),C})}createNodeMesh(t){const s=this.json,n=this,o=s.nodes[t];return o.mesh===void 0?null:n.getDependency("mesh",o.mesh).then(function(i){const a=n._getNodeRef(n.meshCache,o.mesh,i);return o.weights!==void 0&&a.traverse(function(r){if(r.isMesh)for(let l=0,u=o.weights.length;l<u;l++)r.morphTargetInfluences[l]=o.weights[l]}),a})}loadNode(t){const s=this.json,n=this,o=s.nodes[t],i=n._loadNodeShallow(t),a=[],r=o.children||[];for(let u=0,c=r.length;u<c;u++)a.push(n.getDependency("node",r[u]));const l=o.skin===void 0?Promise.resolve(null):n.getDependency("skin",o.skin);return Promise.all([i,Promise.all(a),l]).then(function(u){const c=u[0],d=u[1],p=u[2];p!==null&&c.traverse(function(m){m.isSkinnedMesh&&m.bind(p,sh)});for(let m=0,g=d.length;m<g;m++)c.add(d[m]);return c})}_loadNodeShallow(t){const s=this.json,n=this.extensions,o=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const i=s.nodes[t],a=i.name?o.createUniqueName(i.name):"",r=[],l=o._invokeOne(function(u){return u.createNodeMesh&&u.createNodeMesh(t)});return l&&r.push(l),i.camera!==void 0&&r.push(o.getDependency("camera",i.camera).then(function(u){return o._getNodeRef(o.cameraCache,i.camera,u)})),o._invokeAll(function(u){return u.createNodeAttachment&&u.createNodeAttachment(t)}).forEach(function(u){r.push(u)}),this.nodeCache[t]=Promise.all(r).then(function(u){let c;if(i.isBone===!0?c=new lc:u.length>1?c=new Xt:u.length===1?c=u[0]:c=new Ja,c!==u[0])for(let d=0,p=u.length;d<p;d++)c.add(u[d]);if(i.name&&(c.userData.name=i.name,c.name=a),ts(c,i),i.extensions&&Is(n,c,i),i.matrix!==void 0){const d=new Hs;d.fromArray(i.matrix),c.applyMatrix4(d)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);if(!o.associations.has(c))o.associations.set(c,{});else if(i.mesh!==void 0&&o.meshCache.refs[i.mesh]>1){const d=o.associations.get(c);o.associations.set(c,{...d})}return o.associations.get(c).nodes=t,c}),this.nodeCache[t]}loadScene(t){const s=this.extensions,n=this.json.scenes[t],o=this,i=new Xt;n.name&&(i.name=o.createUniqueName(n.name)),ts(i,n),n.extensions&&Is(s,i,n);const a=n.nodes||[],r=[];for(let l=0,u=a.length;l<u;l++)r.push(o.getDependency("node",a[l]));return Promise.all(r).then(function(l){for(let c=0,d=l.length;c<d;c++)i.add(l[c]);const u=c=>{const d=new Map;for(const[p,m]of o.associations)(p instanceof Po||p instanceof Bi)&&d.set(p,m);return c.traverse(p=>{const m=o.associations.get(p);m!=null&&d.set(p,m)}),d};return o.associations=u(i),i})}_createAnimationTracks(t,s,n,o,i){const a=[],r=t.name?t.name:t.uuid,l=[];ws[i.path]===ws.weights?t.traverse(function(p){p.morphTargetInfluences&&l.push(p.name?p.name:p.uuid)}):l.push(r);let u;switch(ws[i.path]){case ws.weights:u=zi;break;case ws.rotation:u=Vi;break;case ws.translation:case ws.scale:u=ji;break;default:switch(n.itemSize){case 1:u=zi;break;case 2:case 3:default:u=ji;break}break}const c=o.interpolation!==void 0?Yf[o.interpolation]:nr,d=this._getArrayFromAccessor(n);for(let p=0,m=l.length;p<m;p++){const g=new u(l[p]+"."+ws[i.path],s.array,d,c);o.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(g),a.push(g)}return a}_getArrayFromAccessor(t){let s=t.array;if(t.normalized){const n=vi(s.constructor),o=new Float32Array(s.length);for(let i=0,a=s.length;i<a;i++)o[i]=s[i]*n;s=o}return s}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(n){const o=this instanceof Vi?Xf:El;return new o(this.times,this.values,this.getValueSize()/3,n)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function oh(e,t,s){const n=t.attributes,o=new wt;if(n.POSITION!==void 0){const r=s.json.accessors[n.POSITION],l=r.min,u=r.max;if(l!==void 0&&u!==void 0){if(o.set(new Pe(l[0],l[1],l[2]),new Pe(u[0],u[1],u[2])),r.normalized){const c=vi(Qs[r.componentType]);o.min.multiplyScalar(c),o.max.multiplyScalar(c)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=t.targets;if(i!==void 0){const r=new Pe,l=new Pe;for(let u=0,c=i.length;u<c;u++){const d=i[u];if(d.POSITION!==void 0){const p=s.json.accessors[d.POSITION],m=p.min,g=p.max;if(m!==void 0&&g!==void 0){if(l.setX(Math.max(Math.abs(m[0]),Math.abs(g[0]))),l.setY(Math.max(Math.abs(m[1]),Math.abs(g[1]))),l.setZ(Math.max(Math.abs(m[2]),Math.abs(g[2]))),p.normalized){const v=vi(Qs[p.componentType]);l.multiplyScalar(v)}r.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(r)}e.boundingBox=o;const a=new hc;o.getCenter(a.center),a.radius=o.min.distanceTo(o.max)/2,e.boundingSphere=a}function Fa(e,t,s){const n=t.attributes,o=[];function i(a,r){return s.getDependency("accessor",a).then(function(l){e.setAttribute(r,l)})}for(const a in n){const r=yi[a]||a.toLowerCase();r in e.attributes||o.push(i(n[a],r))}if(t.indices!==void 0&&!e.index){const a=s.getDependency("accessor",t.indices).then(function(r){e.setIndex(r)});o.push(a)}return ti.workingColorSpace!==is&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ti.workingColorSpace}" not supported.`),ts(e,t),oh(e,t,s),Promise.all(o).then(function(){return t.targets!==void 0?Zf(e,t.targets,s):e})}const Xo=new WeakMap;class Ro extends Xa{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,s,n,o){const i=new Qn(this.manager);i.setPath(this.path),i.setResponseType("arraybuffer"),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(t,a=>{this.parse(a,s,o)},n,o)}parse(t,s,n=()=>{}){this.decodeDracoFile(t,s,null,null,ps,n).catch(n)}decodeDracoFile(t,s,n,o,i=is,a=()=>{}){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!n,vertexColorSpace:i};return this.decodeGeometry(t,r).then(s).catch(a)}decodeGeometry(t,s){const n=JSON.stringify(s);if(Xo.has(t)){const l=Xo.get(t);if(l.key===n)return l.promise;if(t.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const i=this.workerNextTaskID++,a=t.byteLength,r=this._getWorker(i,a).then(l=>(o=l,new Promise((u,c)=>{o._callbacks[i]={resolve:u,reject:c},o.postMessage({type:"decode",id:i,taskConfig:s,buffer:t},[t])}))).then(l=>this._createGeometry(l.geometry));return r.catch(()=>!0).then(()=>{o&&i&&this._releaseTask(o,i)}),Xo.set(t,{key:n,promise:r}),r}_createGeometry(t){const s=new bi;t.index&&s.setIndex(new dn(t.index.array,1));for(let n=0;n<t.attributes.length;n++){const o=t.attributes[n],i=o.name,a=o.array,r=o.itemSize,l=new dn(a,r);i==="color"&&(this._assignVertexColorSpace(l,o.vertexColorSpace),l.normalized=!(a instanceof Float32Array)),s.setAttribute(i,l)}return s}_assignVertexColorSpace(t,s){if(s!==ps)return;const n=new os;for(let o=0,i=t.count;o<i;o++)n.fromBufferAttribute(t,o),ti.colorSpaceToWorking(n,ps),t.setXYZ(o,n.r,n.g,n.b)}_loadLibrary(t,s){const n=new Qn(this.manager);return n.setPath(this.decoderPath),n.setResponseType(s),n.setWithCredentials(this.withCredentials),new Promise((o,i)=>{n.load(t,o,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t=typeof WebAssembly!="object"||this.decoderConfig.type==="js",s=[];return t?s.push(this._loadLibrary("draco_decoder.js","text")):(s.push(this._loadLibrary("draco_wasm_wrapper.js","text")),s.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(s).then(n=>{const o=n[0];t||(this.decoderConfig.wasmBinary=n[1]);const i=ih.toString(),a=["/* draco decoder */",o,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([a]))}),this.decoderPending}_getWorker(t,s){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(i){const a=i.data;switch(a.type){case"decode":o._callbacks[a.id].resolve(a);break;case"error":o._callbacks[a.id].reject(a);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+a.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,i){return o._taskLoad>i._taskLoad?-1:1});const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=s,n._taskLoad+=s,n})}_releaseTask(t,s){t._taskLoad-=t._taskCosts[s],delete t._callbacks[s],delete t._taskCosts[s]}debug(){console.log("Task load: ",this.workerPool.map(t=>t._taskLoad))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function ih(){let e,t;onmessage=function(a){const r=a.data;switch(r.type){case"init":e=r.decoderConfig,t=new Promise(function(c){e.onModuleLoaded=function(d){c({draco:d})},DracoDecoderModule(e)});break;case"decode":const l=r.buffer,u=r.taskConfig;t.then(c=>{const d=c.draco,p=new d.Decoder;try{const m=s(d,p,new Int8Array(l),u),g=m.attributes.map(v=>v.array.buffer);m.index&&g.push(m.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:m},g)}catch(m){console.error(m),self.postMessage({type:"error",id:r.id,error:m.message})}finally{d.destroy(p)}});break}};function s(a,r,l,u){const c=u.attributeIDs,d=u.attributeTypes;let p,m;const g=r.GetEncodedGeometryType(l);if(g===a.TRIANGULAR_MESH)p=new a.Mesh,m=r.DecodeArrayToMesh(l,l.byteLength,p);else if(g===a.POINT_CLOUD)p=new a.PointCloud,m=r.DecodeArrayToPointCloud(l,l.byteLength,p);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||p.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());const v={index:null,attributes:[]};for(const y in c){const $=self[d[y]];let C,S;if(u.useUniqueIDs)S=c[y],C=r.GetAttributeByUniqueId(p,S);else{if(S=r.GetAttributeId(p,a[c[y]]),S===-1)continue;C=r.GetAttribute(p,S)}const M=o(a,r,p,y,$,C);y==="color"&&(M.vertexColorSpace=u.vertexColorSpace),v.attributes.push(M)}return g===a.TRIANGULAR_MESH&&(v.index=n(a,r,p)),a.destroy(p),v}function n(a,r,l){const c=l.num_faces()*3,d=c*4,p=a._malloc(d);r.GetTrianglesUInt32Array(l,d,p);const m=new Uint32Array(a.HEAPF32.buffer,p,c).slice();return a._free(p),{array:m,itemSize:1}}function o(a,r,l,u,c,d){const p=d.num_components(),g=l.num_points()*p,v=g*c.BYTES_PER_ELEMENT,y=i(a,c),$=a._malloc(v);r.GetAttributeDataArrayForAllPoints(l,d,y,v,$);const C=new c(a.HEAPF32.buffer,$,g).slice();return a._free($),{name:u,array:C,itemSize:p}}function i(a,r){switch(r){case Float32Array:return a.DT_FLOAT32;case Int8Array:return a.DT_INT8;case Int16Array:return a.DT_INT16;case Int32Array:return a.DT_INT32;case Uint8Array:return a.DT_UINT8;case Uint16Array:return a.DT_UINT16;case Uint32Array:return a.DT_UINT32}}}class ah{constructor(){this.gltfCache=new Map,this.modelPool=new Map,this.instancedMeshes=new Map,this.gltfLoader=null,this.dracoLoader=null,this.maxCacheSize=50,this.maxInstancesPerModel=1e3,this.preloadStatus=new Map,this.preloadQueue=[],this.initLoaders()}initLoaders(){this.gltfLoader||(this.gltfLoader=new ko,this.gltfLoader.setCrossOrigin("anonymous"),this.dracoLoader=new Ro,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.dracoLoader.setCrossOrigin("anonymous"),this.gltfLoader.setDRACOLoader(this.dracoLoader),f("[ModelCache] GLTFDraco"))}async loadModel(t,s=!0){if(s&&this.modelPool.has(t)){const i=this.modelPool.get(t);return f(`[ModelCache] : ${t}`),i.clone(!0)}let n;if(this.gltfCache.has(t))f(`[ModelCache] GLTF: ${t}`),n=this.gltfCache.get(t);else try{const a=await(await Sl(t)).arrayBuffer();f(`[ModelCache] GLTF: ${t}`),n=await new Promise((r,l)=>{this.gltfLoader.parse(a,"",u=>r(u),u=>l(u))}),this.cacheGLTF(t,n)}catch(i){throw f(`[ModelCache] : ${t}`,i),i}const o=n.scene.clone(!0);return s&&this.addToModelPool(t,o),o}async createInstancedMesh(t,s=100){if(this.instancedMeshes.has(t))return f(`[ModelCache] : ${t}`),this.instancedMeshes.get(t);const n=await this.loadModel(t,!0),o=[];if(n.traverse(l=>{l.isMesh&&o.push(l)}),o.length===0)throw new Error(`[ModelCache] : ${t}`);const i=o[0],a=new Ya(i.geometry,i.material,s),r=new Hs;for(let l=0;l<s;l++)r.setPosition(0,-1e3,0),a.setMatrixAt(l,r);return a.instanceMatrix.needsUpdate=!0,this.instancedMeshes.set(t,a),f(`[ModelCache] : ${t}, : ${s}`),a}updateInstancedMeshInstance(t,s,n,o,i){const a=this.instancedMeshes.get(t);if(!a){f(`[ModelCache] : ${t}`);return}if(s>=a.count){f(`[ModelCache] : ${s}/${a.count}`);return}const r=new Hs;r.compose(n,new wn().setFromEuler(o),i),a.setMatrixAt(s,r),a.instanceMatrix.needsUpdate=!0}hideInstancedMeshInstance(t,s){const n=this.instancedMeshes.get(t);if(!n)return;const o=new Hs;o.setPosition(0,-1e3,0),n.setMatrixAt(s,o),n.instanceMatrix.needsUpdate=!0}cacheGLTF(t,s){if(this.gltfCache.size>=this.maxCacheSize){const n=this.gltfCache.keys().next().value;this.gltfCache.delete(n),f(`[ModelCache] GLTF: ${n}`)}this.gltfCache.set(t,s),f(`[ModelCache] GLTF: ${t}`)}addToModelPool(t,s){if(this.modelPool.size>=this.maxCacheSize){const n=this.modelPool.keys().next().value,o=this.modelPool.get(n);this.disposeModel(o),this.modelPool.delete(n),f(`[ModelCache] : ${n}`)}this.modelPool.set(t,s),f(`[ModelCache] : ${t}`)}async preloadModels(t,s=null){f(`[ModelCache]  ${t.length} `);const n=t.length;let o=0;const i=t.filter(r=>{const l=this.preloadStatus.get(r);return!l||l==="failed"});f(`[ModelCache]  ${i.length} `);const a=3;for(let r=0;r<i.length;r+=a){const u=i.slice(r,r+a).map(async c=>{try{this.preloadStatus.set(c,"loading"),await this.loadModel(c,!0),this.preloadStatus.set(c,"loaded"),o++,s&&s(o,n,Math.round(o/n*100)),f(`[ModelCache] : ${c} (${o}/${n})`)}catch(d){f(`[ModelCache] : ${c}`,d),this.preloadStatus.set(c,"failed"),o++,s&&s(o,n,Math.round(o/n*100))}});await Promise.all(u),r+a<i.length&&await new Promise(c=>setTimeout(c,100))}f(`[ModelCache] : ${o}/${n} `)}isPreloaded(t){return this.preloadStatus.get(t)==="loaded"}getPreloadStatus(){const t={total:this.preloadStatus.size,loaded:0,loading:0,failed:0};for(const s of this.preloadStatus.values())t[s]++;return t}disposeModel(t){t&&t.traverse(s=>{s.isMesh&&(s.geometry&&s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(n=>{n.map&&n.map.dispose(),n.dispose&&n.dispose()}):(s.material.map&&s.material.map.dispose(),s.material.dispose&&s.material.dispose())))})}clearCache(){f("[ModelCache] ..."),this.modelPool.forEach(t=>{this.disposeModel(t)}),this.modelPool.clear(),this.instancedMeshes.forEach(t=>{this.disposeModel(t)}),this.instancedMeshes.clear(),this.gltfCache.clear(),this.preloadStatus.clear(),f("[ModelCache] ")}getCacheStatus(){return{gltfCacheSize:this.gltfCache.size,modelPoolSize:this.modelPool.size,instancedMeshesSize:this.instancedMeshes.size,preloadStatus:this.getPreloadStatus(),maxCacheSize:this.maxCacheSize,maxInstancesPerModel:this.maxInstancesPerModel,gltfLoaderInitialized:!!this.gltfLoader,dracoLoaderInitialized:!!this.dracoLoader}}updateConfig(t){t.maxCacheSize!==void 0&&(this.maxCacheSize=Math.max(10,t.maxCacheSize)),t.maxInstancesPerModel!==void 0&&(this.maxInstancesPerModel=Math.max(10,t.maxInstancesPerModel)),f("[ModelCache] :",this.getCacheStatus())}}const Lt=new ah,rh={class:"model-wrapper"},lh={key:0,class:"model-loading"},ch={__name:"PuppetModelView",props:{puppet:{type:Object,default:null}},setup(e){const t=e,s=Z(null),n=Z(!1);let o=null,i=null,a=null,r=0,l=null,u=null,c=new mc,d=null,p=null,m=0,g=!1;window.__GLTF_MEMORY_CACHE__||(window.__GLTF_MEMORY_CACHE__=new Map,f("[PuppetModelView] Initialized global GLTF memory cache"));function v(){if(g)return;const S=s.value;if(!S){f("[PuppetModelView] Container not ready for Three.js initialization");return}f("[PuppetModelView] Initializing Three.js..."),i=new fo,a=new Rn(45,1,.1,1e3),a.position.set(0,1,3),o=new ho({antialias:!0,alpha:!0}),o.setPixelRatio(window.devicePixelRatio||1),o.outputColorSpace=ps,p=new Ro,p.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),p.setCrossOrigin("anonymous"),f("[PuppetModelView] Draco loader initialized:",!!p),S.innerHTML="",S.appendChild(o.domElement);const M=new po(16777215,1.2),F=new hs(16777215,1.5);F.position.set(3,5,2);const X=new hs(16777215,.8);X.position.set(-2,3,4);const Y=new zs(16777215,1,10);Y.position.set(0,2,3),i.add(M,F,X,Y);const P=()=>{if(!S||!o)return;let V=S.clientWidth,N=S.clientHeight;if(!V||!N){const b=S.getBoundingClientRect();if(V=b.width||200,N=b.height||200,!b.width||!b.height){requestAnimationFrame(P);return}}o.setSize(V,N,!1),a.aspect=V/Math.max(1,N),a.updateProjectionMatrix()};P(),d=new ResizeObserver(P),d.observe(S),requestAnimationFrame(()=>{P(),requestAnimationFrame(()=>{P(),requestAnimationFrame(P)})});const R=()=>{if(!o||!i||!a)return;r=requestAnimationFrame(R);const V=c.getDelta();u&&u.update(V),l&&(l.rotation.y+=V*.6),o.render(i,a)};R(),g=!0,f("[PuppetModelView] Three.js initialized successfully, container size:",S.clientWidth,"x",S.clientHeight)}function y(){u&&(u.stopAllAction(),u=null),l&&(i.remove(l),l.traverse(S=>{S.isMesh&&(S.geometry&&S.geometry.dispose(),Array.isArray(S.material)?S.material.forEach(M=>{M.map&&M.map.dispose(),M&&M.dispose&&M.dispose()}):S.material&&(S.material.map&&S.material.map.dispose(),S.material.dispose&&S.material.dispose()))}),l=null)}function $(S){const M=new wt().setFromObject(S),F=new Pe,X=new Pe;M.getSize(F),M.getCenter(X),S.position.sub(X);const Y=-.3,P=.3,R=0;S.position.add(new Pe(Y,P,R)),S.scale.multiplyScalar(.55);const N=o==null?void 0:o.domElement,b=N?N.clientWidth||N.width:200,L=N?N.clientHeight||N.height:200,O=Math.max(1e-6,b/Math.max(1,L)),B=a.fov*(Math.PI/180),ie=2*Math.atan(Math.tan(B/2)*O),ae=1.2,de=F.y/2/Math.tan(B/2),xe=F.x/2/Math.tan(ie/2),Ye=ae*Math.max(de,xe,.1);a.position.set(0,0,Ye),a.lookAt(0,0,0)}async function C(S){var X;if(!S)return;f("[PuppetModelView] Loading puppet:",S.name),n.value=!0,v(),y();const M=++m;f("[PuppetModelView] ");let F=S.modelUrl||"";if(f("[PuppetModelView] Original modelUrl:",F),f("[PuppetModelView] Puppet image:",S.image),f("[PuppetModelView] Puppet name:",S.name),f("[PuppetModelView] Puppet data:",S),!F||F.trim()===""){f("[PuppetModelView] No model URL found");return}f("[PuppetModelView] Final Model URL:",F);try{f("[PuppetModelView] Starting to load:",F),f("[PuppetModelView] Cache status:",Lt.getCacheStatus());const Y=await Lt.loadModel(F);if(f("[PuppetModelView] Model loaded from cache manager:",Y),M!==m){f("[PuppetModelView] Ignoring outdated load result for:",S.name),gltf&&gltf.scene&&gltf.scene.traverse(P=>{P.isMesh&&(P.geometry&&P.geometry.dispose(),Array.isArray(P.material)?P.material.forEach(R=>{R.map&&R.map.dispose(),R.dispose&&R.dispose()}):P.material&&(P.material.map&&P.material.map.dispose(),P.material.dispose&&P.material.dispose()))});return}if(f("[PuppetModelView] Applying model for:",S.name),!i){f("[PuppetModelView] Scene not ready, initializing..."),v();let P=0;for(;!i&&P<40;)await new Promise(R=>setTimeout(R,50)),P++;if(!i){f("[PuppetModelView] Scene initialization timeout");return}}if(l=Y,!l){f("[PuppetModelView] No model instance received");return}i.add(l),$(l),f("[PuppetModelView] Model loaded successfully:",S.name,"Scene children:",i.children.length),n.value=!1}catch(Y){if(f("[PuppetModelView] Load failed:",Y),f("[PuppetModelView] Failed URL:",F),f("[PuppetModelView] Puppet data:",S),typeof(Y==null?void 0:Y.message)=="string"&&Y.message.includes("DRACOLoader")){f("[PuppetModelView] Retrying without Draco decoder...");try{const P=new ko;P.setCrossOrigin("anonymous");const R=await P.loadAsync(F);if(M===m&&(l=R.scene||((X=R.scenes)==null?void 0:X[0]),l)){i.add(l),R.animations&&R.animations.length&&(u=new pc(l),u.clipAction(R.animations[0]).play()),$(l),f("[PuppetModelView] Model loaded successfully without Draco:",S.name);return}}catch(P){f("[PuppetModelView] Fallback load also failed:",P)}}if(M===m){const P=new qt(1,1,1),R=new kt({color:8947967});l=new it(P,R),i.add(l),$(l)}n.value=!1}}return Nt(()=>t.puppet,async S=>{await An(),C(S)},{immediate:!1}),Rt(()=>{f("[PuppetModelView] Component mounted"),An(()=>{s.value&&(v(),t.puppet&&setTimeout(()=>{C(t.puppet)},0))})}),ys(()=>{if(f("[PuppetModelView] Cleaning up..."),cancelAnimationFrame(r),y(),d&&s.value)try{d.unobserve(s.value)}catch{}const S=i,M=o;o=null,i=null,a=null,g=!1,m=0;const F=()=>{if(f("[PuppetModelView] Starting deferred cleanup..."),S&&S.traverse(X=>{if(X.isMesh)try{if(X.geometry&&X.geometry.dispose(),Array.isArray(X.material))X.material.forEach(Y=>{try{Y.map&&Y.map.dispose(),Y.dispose&&Y.dispose()}catch{}});else if(X.material)try{X.material.map&&X.material.map.dispose(),X.material.dispose&&X.material.dispose()}catch{}}catch{}}),M)try{M.dispose(),M.forceContextLoss&&M.forceContextLoss()}catch{}f("[PuppetModelView] Deferred cleanup completed")};typeof window<"u"&&window.requestIdleCallback?window.requestIdleCallback(F,{timeout:1e3}):setTimeout(F,100),f("[PuppetModelView] Quick cleanup completed, heavy cleanup deferred")}),(S,M)=>(G(),j("div",rh,[h("div",{ref_key:"mountEl",ref:s,class:"model-canvas"},null,512),n.value?(G(),j("div",lh,[...M[0]||(M[0]=[h("div",{class:"loading-spinner"},null,-1)])])):we("",!0)]))}},uh=ct(ch,[["__scopeId","data-v-aafe6231"]]),dh={class:"warehouse"},fh={class:"warehouse__resources"},hh={class:"resource-icon"},ph=["src","alt"],mh={class:"resource-value"},gh={key:0,class:"warehouse__main"},_h={class:"warehouse__sidebar"},yh={class:"puppet-list"},vh=["onClick","onMouseenter"],bh={class:"puppet-card__quantity"},wh={class:"puppet-card__image"},Sh=["src","alt"],Th={class:"puppet-card__info"},Ah={class:"puppet-card__name"},Mh={class:"puppet-card__level"},Ch={class:"puppet-detail__header"},xh={class:"puppet-detail__name"},Eh={class:"puppet-detail__content"},kh={class:"puppet-detail__row"},Rh={class:"puppet-detail__model"},$h={class:"puppet-detail__description"},Ph={class:"puppet-detail__row"},Lh={class:"puppet-detail__stats"},Ih={class:"stats-section"},Oh={class:"stat-item"},Dh={class:"stat-value"},Nh={class:"stat-item"},Hh={class:"stat-value"},Gh={class:"stat-item"},Fh={class:"stat-value"},Uh={class:"stat-item"},Bh={class:"stat-value"},jh={class:"stat-item"},zh={class:"stat-value"},Vh={class:"stat-item"},Kh={class:"stat-value"},Wh={class:"stat-item"},qh={class:"stat-value"},Xh={class:"equipment-section"},Yh={class:"equipment-slots"},Jh=["src","alt"],Zh={key:1,src:ef,alt:"",class:"equipment-icon"},Qh={key:2,src:tf,alt:"",class:"equipment-icon"},ep={key:3,class:"equipment-icon"},tp={key:0,class:"skill-section"},sp={class:"skill-info"},np={class:"skill-text"},op={class:"skill-name"},ip={class:"skill-cooldown"},ap={class:"skill-effect"},rp={class:"skill-icon"},lp=["src","alt"],cp={key:1},up={class:"puppet-detail__upgrade"},dp={class:"upgrade-cost"},fp=["src"],hp={class:"cost-amount"},pp=["disabled"],mp={class:"warehouse__placeholder",key:"placeholder"},gp=["src"],_p="url('/assets/panel3.png')",yp="url('/assets/panel4.png')",vp="url('/assets/panel5.png')",bp={__name:"Warehouse",props:{musicOn:{type:Boolean,default:!0}},setup(e,{expose:t}){tn(N=>({v32e77809:_p,v32e860c7:vp,v32e7ec68:yp}));const s=e,n=["SpiritalSpark","RecallGear","ResonantCrystal","RefinedCopper","HeartCrystalDust"];function o(N){return n.map(b=>({icon:ns[b].icon,name:ns[b].name,value:Number((N==null?void 0:N[b])??0)}))}const i={IronWall:"",Arcanist:"",CraftsMan:"",Mechanic:"",Resonator:""};function a(N){const b=Number(N??1);return b===1?5:b===2?10:b===3?20:b===4?30:0}function r(N){return(N||[]).map((b,L)=>{var at,Je,$t,_,w,E;const O=(b==null?void 0:b.copper_info)||{},B=(O==null?void 0:O.skill)||{},ie=(b==null?void 0:b.equipment_slot)||{},ae=(ie==null?void 0:ie.slot1)||null,de=(ie==null?void 0:ie.slot2)||null,xe=(b==null?void 0:b.attribute)||{},Ye=((at=ae==null?void 0:ae.equipment_base)==null?void 0:at.attribute)||{},H=((Je=de==null?void 0:de.equipment_base)==null?void 0:Je.attribute)||{},ce=Number(Ye.attack||0)+Number(H.attack||0),Te=Number(Ye.defense||0)+Number(H.defense||0),et=Number(Ye.dodge||0)+Number(H.dodge||0),ut=b==null?void 0:b.copper_type,He=(b==null?void 0:b.level)??1,ke=(O==null?void 0:O.model_url)||"",_t=ke?oe(ke):"";return{id:Number((b==null?void 0:b.id)??L+1),name:(O==null?void 0:O.name)??"",level:He,suffix:(b==null?void 0:b.suffix)??0,image:oe((O==null?void 0:O.icon_url)||""),modelUrl:_t,quantity:1,description:(O==null?void 0:O.description)||"",stats:{level:`${He}/5`,health:Number(xe.health||0),live_left:Number((b==null?void 0:b.live_left)??0),attack:{base:Number(xe.attack||0),bonus:ce},defense:{base:Number(xe.defense||0),bonus:Te},dodge:{base:Number(xe.dodge||0),bonus:et},class:i[ut]||""},equipment:[ae?{name:(($t=ae.equipment_base)==null?void 0:$t.name)||"",icon:oe(((_=ae.equipment_base)==null?void 0:_.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1},ie!=null&&ie.is_slot2_locked?{name:"",icon:"",equipped:!1,locked:!0}:de?{name:((w=de.equipment_base)==null?void 0:w.name)||"",icon:oe(((E=de.equipment_base)==null?void 0:E.resource_url)||""),equipped:!0,locked:!1}:{name:"",icon:"",equipped:!1,locked:!1}],skill:{name:(B==null?void 0:B.name)||"",cooldown:(B==null?void 0:B.cool_down)!=null?`${B.cool_down}`:"",effect:(B==null?void 0:B.description)||"",icon:oe((B==null?void 0:B.resource_url)||"")},upgradeCost:a(He)}})}function l(N,b,L=[]){if(!N||typeof N!="object")return null;if(Object.prototype.hasOwnProperty.call(N,b))return[...L,b];if(Array.isArray(N)){for(let O=0;O<N.length;O++){const B=l(N[O],b,[...L,O]);if(B)return B}return null}for(const O of Object.keys(N)){const B=l(N[O],b,[...L,O]);if(B)return B}return null}function u(N,b){return b.reduce((L,O)=>L!=null?L[O]:void 0,N)}const c=Z([]);Rt(async()=>{try{const N=await Jn();c.value=o(N)}catch{c.value=o({})}});function d(N){let b=N;if(typeof N=="string")try{b=JSON.parse(N)}catch{}b&&b.type_msg&&(b.type_msg==="upgrade_cost_error"?alert(b.content||""):f("[GlobalInfo]",b))}Rt(()=>{try{Cl(d)}catch{}s.musicOn&&R.value&&setTimeout(()=>{if(R.value.readyState>=2)R.value.play().then(()=>{f("[Warehouse] ")}).catch(b=>{f("[Warehouse] :",b)});else{const b=()=>{R.value.play().then(()=>{f("[Warehouse] ")}).catch(L=>{f("[Warehouse] :",L)}),R.value.removeEventListener("canplay",b)};R.value.addEventListener("canplay",b,{once:!0})}},200)}),Nt(()=>s.musicOn,N=>{if(R.value)if(N)if(R.value.readyState>=2)R.value.play().catch(b=>{f("[Warehouse] :",b)});else{const b=()=>{R.value.play().catch(L=>{f("[Warehouse] :",L)}),R.value.removeEventListener("canplay",b)};R.value.addEventListener("canplay",b)}else R.value.pause()}),ys(()=>{R.value&&R.value.pause()});const p=Z([]);Rt(async()=>{try{const N=await Zn();let b=N&&Array.isArray(N.coppers)?N.coppers:[];if(!Array.isArray(b)){const L=l(N,"coppers");if(f("[Warehouse] copper key path:",L),L){const O=u(N,L);f("[Warehouse] copper found by path:",O),Array.isArray(O)&&(b=O)}!Array.isArray(b)&&N&&N.entries&&f("[Warehouse] copper entries sample:",N.entries)}Array.isArray(b)||f("[Warehouse] copper list not array"),p.value=r(b),Array.isArray(p.value)&&p.value.length>0&&(m.value=p.value[0]),!m.value&&Array.isArray(p.value)&&p.value.length>0&&(m.value=p.value[0])}catch{p.value=[]}});const m=Z(null),g=Z([]),v=Z(null),y=Z(null),$=Z(null);function C(N,b){N&&(g.value[b]=N)}async function S(N,b){m.value=N,await An();const L=g.value[b];if(L&&typeof L.scrollIntoView=="function"&&L.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),v.value=b,y.value)try{y.value.scrollTo({top:0,behavior:"smooth"})}catch{y.value.scrollTop=0}setTimeout(()=>{v.value===b&&(v.value=null)},320)}const M=Z(!1);function F(){M.value=!0}function X(){return M.value?(M.value=!1,!0):!1}t({handleBack:X});async function Y(N){try{const b=await Jn();c.value=o(b);const L=await Zn(),O=Array.isArray(L==null?void 0:L.coppers)?L.coppers:[];p.value=r(O)}catch{}}async function P(){if(!m.value)return;if(Number(m.value.level||0)>=5){alert("");return}const N=m.value.id,b=await cf(N);if(!b||b.type!=="success"){alert(b&&b.content?b.content:"");return}try{const L=await Jn();c.value=o(L);const O=await Zn(),B=Array.isArray(O==null?void 0:O.coppers)?O.coppers:[];p.value=r(B);const ie=p.value.find(ae=>ae.id===N);ie&&(m.value=ie)}catch{}}const R=Z(null),V=oe("assets/warehouse.mp3");return(N,b)=>(G(),j("div",dh,[h("div",fh,[(G(!0),j(Be,null,Dt(c.value,L=>(G(),j("div",{class:"resource-item",key:L.name},[h("div",hh,[h("img",{src:L.icon,alt:L.name},null,8,ph)]),h("div",mh,ee(L.value),1)]))),128))]),M.value?we("",!0):(G(),j("div",gh,[h("div",_h,[b[2]||(b[2]=h("div",{class:"warehouse__title"},"",-1)),h("div",yh,[(G(!0),j(Be,null,Dt(p.value,(L,O)=>{var B;return G(),j("div",{class:nt(["puppet-card",{"puppet-card--selected":((B=m.value)==null?void 0:B.id)===L.id,"puppet-card--pulse":v.value===O,"puppet-card--hover":$.value===O}]),key:L.id,ref_for:!0,ref:ie=>C(ie,O),onClick:ie=>S(L,O),onMouseenter:ie=>$.value=O,onMouseleave:b[0]||(b[0]=ie=>$.value=null)},[h("div",bh,ee(L.level),1),h("div",wh,[h("img",{src:L.image,alt:L.name},null,8,Sh)]),h("div",Th,[h("div",Ah,ee(L.name)+ee(L.suffix),1),h("div",Mh,ee(L.level)+"",1)])],42,vh)}),128)),h("div",{class:"puppet-card puppet-card--add",onClick:F},[...b[1]||(b[1]=[h("div",{class:"puppet-card__add-icon"},"+",-1),h("div",{class:"puppet-card__add-text"},"",-1)])])])]),h("div",{class:"warehouse__detail",ref_key:"detailWrap",ref:y},[Qe(bd,{name:"fade-slide",mode:"out-in"},{default:Dr(()=>{var L,O,B,ie;return[m.value?(G(),j("div",{class:"puppet-detail",key:((L=m.value)==null?void 0:L.id)||"none"},[h("div",Ch,[h("h2",xh,ee(m.value.name),1)]),h("div",Eh,[h("div",kh,[h("div",Rh,[Qe(uh,{puppet:m.value},null,8,["puppet"])]),h("div",$h,ee(m.value.description),1)]),h("div",Ph,[h("div",Lh,[h("div",Ih,[h("div",Oh,[b[3]||(b[3]=h("span",{class:"stat-label"},":",-1)),h("span",Dh,ee(m.value.stats.health),1)]),h("div",Nh,[b[4]||(b[4]=h("span",{class:"stat-label"},":",-1)),h("span",Hh,ee(m.value.stats.level),1)]),h("div",Gh,[b[5]||(b[5]=h("span",{class:"stat-label"},":",-1)),h("span",Fh,ee(m.value.stats.live_left),1)]),h("div",Uh,[b[6]||(b[6]=h("span",{class:"stat-label"},":",-1)),h("span",Bh,ee(m.value.stats.attack.base),1)]),h("div",jh,[b[7]||(b[7]=h("span",{class:"stat-label"},":",-1)),h("span",zh,ee(m.value.stats.defense.base),1)]),h("div",Vh,[b[8]||(b[8]=h("span",{class:"stat-label"},":",-1)),h("span",Kh,ee(m.value.stats.dodge.base)+"% ",1)]),h("div",Wh,[b[9]||(b[9]=h("span",{class:"stat-label"},":",-1)),h("span",qh,ee(m.value.stats.class),1)])])]),h("div",Xh,[b[10]||(b[10]=h("h4",{class:"section-title"},"",-1)),h("div",Yh,[(G(!0),j(Be,null,Dt(m.value.equipment,(ae,de)=>(G(),j("div",{key:de,class:nt(["equipment-slot",{"equipment-slot--empty":!ae.equipped&&!ae.locked,"equipment-slot--locked":ae.locked}])},[ae.equipped&&ae.icon&&(ae.icon.startsWith("/")||ae.icon.startsWith("http"))?(G(),j("img",{key:0,src:ae.icon,alt:ae.name,class:"equipment-icon"},null,8,Jh)):ae.locked?(G(),j("img",Zh)):ae.icon===""?(G(),j("img",Qh)):(G(),j("span",ep,ee(ae.icon),1))],2))),128))])])]),((B=(O=m.value)==null?void 0:O.stats)==null?void 0:B.class)!==""?(G(),j("div",tp,[b[11]||(b[11]=h("h4",{class:"section-title"},"",-1)),h("div",sp,[h("div",np,[h("div",op,ee(m.value.skill.name),1),h("div",ip," : "+ee(m.value.skill.cooldown),1),h("div",ap,ee(m.value.skill.effect),1)]),h("div",rp,[m.value.skill.icon&&(m.value.skill.icon.startsWith("/")||m.value.skill.icon.startsWith("http"))?(G(),j("img",{key:0,src:m.value.skill.icon,alt:m.value.skill.name,class:"skill-icon-img"},null,8,lp)):(G(),j("span",cp,ee(m.value.skill.icon),1))])])])):we("",!0)]),h("div",up,[h("div",dp,[m.value.level<5?(G(),j("img",{key:0,src:Ae(ns).SpiritalSpark.icon,alt:"",class:"cost-icon-img"},null,8,fp)):we("",!0),h("span",hp,ee(m.value.level>=5?"":"X "+m.value.upgradeCost),1)]),h("button",{class:"upgrade-btn",onClick:P,disabled:((ie=m.value)==null?void 0:ie.level)>=5},[...b[12]||(b[12]=[h("img",{src:sf,class:"upgrade-icon",alt:""},null,-1)])],8,pp)])])):(G(),j("div",mp,[...b[13]||(b[13]=[h("p",null,"",-1)])]))]}),_:1})],512)])),M.value?(G(),Ot(Af,{key:1,onDraw:Y})):we("",!0),h("audio",{ref_key:"audioRef",ref:R,src:Ae(V),loop:"",preload:"auto"},null,8,gp)]))}},wp=ct(bp,[["__scopeId","data-v-88bc5d39"]]),Sp={class:"panel",style:{left:"24px",right:"auto"}},Tp=["title"],Ap={key:0,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Mp={key:1,width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},Cp={class:"sr-only"},xp={__name:"TopLeftPanel",props:{musicOn:{type:Boolean,default:!0}},emits:["back","open-settings","toggle-music"],setup(e,{emit:t}){return(s,n)=>(G(),j("div",Sp,[h("button",{class:"btn",onClick:n[0]||(n[0]=o=>s.$emit("back")),title:""},[...n[3]||(n[3]=[h("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M15 18L9 12L15 6",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h("span",{class:"sr-only"},"",-1)])]),h("button",{class:"btn",onClick:n[1]||(n[1]=o=>s.$emit("toggle-music")),title:e.musicOn?"":""},[e.musicOn?(G(),j("svg",Ap,[...n[4]||(n[4]=[h("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),h("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1)])])):(G(),j("svg",Mp,[...n[5]||(n[5]=[h("path",{d:"M9 18V5L21 3V16",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),h("circle",{cx:"6",cy:"18",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("circle",{cx:"18",cy:"16",r:"3",stroke:"#ffffff","stroke-width":"2"},null,-1),h("line",{x1:"2",y1:"2",x2:"22",y2:"22",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),h("span",Cp,ee(e.musicOn?"":""),1)],8,Tp),h("button",{class:"btn",onClick:n[2]||(n[2]=o=>s.$emit("open-settings")),title:""},[...n[6]||(n[6]=[h("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M12 15.5C13.933 15.5 15.5 13.933 15.5 12C15.5 10.067 13.933 8.5 12 8.5C10.067 8.5 8.5 10.067 8.5 12C8.5 13.933 10.067 15.5 12 15.5Z",stroke:"#ffffff","stroke-width":"2"}),h("path",{d:"M19.4 15A7.964 7.964 0 0 0 20 12C20 11.49 19.95 10.99 19.86 10.5L22 8.5L20 5.5L17.34 6.07C16.78 5.58 16.14 5.18 15.44 4.9L15 2H9L8.56 4.9C7.86 5.18 7.22 5.58 6.66 6.07L4 5.5L2 8.5L4.14 10.5C4.05 10.99 4 11.49 4 12C4 12.51 4.05 13.01 4.14 13.5L2 15.5L4 18.5L6.66 17.93C7.22 18.42 7.86 18.82 8.56 19.1L9 22H15L15.44 19.1C16.14 18.82 16.78 18.42 17.34 17.93L20 18.5L22 15.5L19.86 13.5C19.95 13.01 20 12.51 20 12",stroke:"#ffffff","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1),h("span",{class:"sr-only"},"",-1)])])]))}},Ua=ct(xp,[["__scopeId","data-v-97df197b"]]),Ep=["automatic_loading_gun","charging_coil","heart_source_mineral_drill","mirro_light_refraction_tower","repair_workshop","resonance_alarm_bell","rivet_barrier","steam_mining_car","storm_anvil"];function kp(){const e=[],t=[{type:"arcanist",name:"bubble"},{type:"craftsman",name:"coil"},{type:"iron_wall",name:"bell"},{type:"mechanic",name:"gyro"},{type:"resonator",name:"clawster"}];for(const n of t){const o=Co(n.type,n.name);e.push(o)}const s=["goblin","guard","demon"];for(const n of s){const o=xo(n);e.push(o)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function Rp(){const e=[],t=[{type:"arcanist",name:"glimmer"},{type:"arcanist",name:"spark"},{type:"craftsman",name:"artifex"},{type:"craftsman",name:"wrench"},{type:"iron_wall",name:"chief"},{type:"iron_wall",name:"rocky"},{type:"mechanic",name:"karin"},{type:"mechanic",name:"tricky"},{type:"resonator",name:"diggs"},{type:"resonator",name:"hive"}];for(const n of t){const o=Co(n.type,n.name);e.push(o)}const s=["assassin","boxer","cruiser","devourer","glutton"];for(const n of s){const o=xo(n);e.push(o)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function $p(){const e=[],t=[{type:"arcanist",name:"syrup"},{type:"arcanist",name:"turner"},{type:"craftsman",name:"drillbit"},{type:"craftsman",name:"quickhand"},{type:"iron_wall",name:"tumble"},{type:"iron_wall",name:"wesley"},{type:"mechanic",name:"pendulum"},{type:"mechanic",name:"yoyo"},{type:"resonator",name:"melody"},{type:"resonator",name:"murmur"}];for(const n of t){const o=Co(n.type,n.name);e.push(o)}const s=["horn","mirror","scout","shatra","variant"];for(const n of s){const o=xo(n);e.push(o)}for(const n of Ep){const o=Tl(n);e.push(o)}return f(`[ModelPreloadConfig]  ${e.length} URL`),e}function Pp(e=["high","medium"]){const t=[];for(const n of e)switch(n){case"high":t.push(...kp());break;case"medium":t.push(...Rp());break;case"low":t.push(...$p());break}const s=[...new Set(t)];return f(`[ModelPreloadConfig]  ${e.join(", ")}  ${s.length} URL`),s}class Lp{constructor(){this.isPreloading=!1,this.preloadProgress=0,this.preloadCallbacks=[]}async startPreload(t=["high","medium"],s=null){if(this.isPreloading){f("[ModelPreloadManager] ");return}this.isPreloading=!0,this.preloadProgress=0;try{const n=Pp(t);f(`[ModelPreloadManager]  ${n.length}  (: ${t.join(", ")})`),s&&this.preloadCallbacks.push(s),await Lt.preloadModels(n,(o,i,a)=>{this.preloadProgress=a,this.notifyProgress(o,i,a)}),f("[ModelPreloadManager] ")}catch(n){f("[ModelPreloadManager] :",n)}finally{this.isPreloading=!1,this.preloadCallbacks=[]}}notifyProgress(t,s,n){this.preloadCallbacks.forEach(o=>{try{o(t,s,n)}catch(i){f("[ModelPreloadManager] :",i)}})}getStatus(){return{isPreloading:this.isPreloading,progress:this.preloadProgress,cacheStatus:Lt.getCacheStatus()}}isModelPreloaded(t){return Lt.isPreloaded(t)}async preloadModel(t){try{await Lt.loadModel(t,!0),f(`[ModelPreloadManager] : ${t}`)}catch(s){f(`[ModelPreloadManager] : ${t}`,s)}}async preloadModels(t){const s=t.map(n=>this.preloadModel(n));await Promise.all(s),f(`[ModelPreloadManager] : ${t.length} `)}}const Ba=new Lp,Ip={class:"startmenu"},Op={key:0,class:"settings-local"},Dp={__name:"StartMenu",props:{visible:{type:Boolean,default:!0}},emits:["started"],setup(e,{emit:t}){const s=e,n=Z(null);let o=null,i=null,a=null,r=null,l=null,u=1.2;const c=Z(!1),d=Z(!1),p=Z(!1),m=Z(oe("ui/Gemini_Generated_Image_gtrehogtrehogtre (1).png")),g=t;Nt(()=>s.visible,P=>{P&&o&&l?C():P||$()});function v(){if(r=requestAnimationFrame(v),l){const P=Date.now()*.001;l.position.y=Math.sin(P*.8)*.1,l.rotation.y=Math.sin(P*.6)*.1;const R=u+Math.sin(P*1.2)*.04;l.scale.setScalar(R)}a&&a.render(o,i)}function y(){!a||!i||(i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight))}function $(){r&&(cancelAnimationFrame(r),r=null),a&&a.setAnimationLoop(null)}function C(){r||v()}function S(){try{$()}catch{}try{window.removeEventListener("resize",y)}catch{}try{o&&(o.traverse(P=>{if(P.isMesh){P.geometry&&P.geometry.dispose&&P.geometry.dispose();const R=P.material;Array.isArray(R)?R.forEach(V=>V&&V.dispose&&V.dispose()):R&&R.dispose&&R.dispose()}}),o.clear())}catch{}try{if(a){a.clear(!0,!0,!0),a.dispose();const P=a.getContext&&a.getContext(),R=P&&P.getExtension&&P.getExtension("WEBGL_lose_context");R&&R.loseContext&&R.loseContext()}}catch{}o=null,i=null,a=null,l=null}async function M(P=null){try{window.getAssetUrl=oe,window.precacheAllResources=_i,window.getCacheStatus=qd}catch{}if(!o||!a){f("[StartMenu] Scene or renderer not initialized in onMounted");return}if(P&&P(0,100,20),!o.children.some(N=>N.isLight)){const N=new po(4210752,.4);o.add(N);const b=new hs(16777215,12.5);b.position.set(-5,-2,1),o.add(b)}P&&P(0,100,50);const V=oe("logo.glb");try{P&&P(0,100,60),f("[StartMenu] Logo...");const N=await Lt.loadModel(V,!0);P&&P(0,100,80),N.position.set(0,0,0),o.add(N);const L=new wt().setFromObject(N).getCenter(new Pe);N.position.set(-L.x,-L.y,-L.z);try{N.scale.setScalar(u)}catch{}l=N,P&&P(0,100,80),f("[StartMenu] Logo ...");try{await Ba.startPreload(["high","medium"],(O,B,ie)=>{const ae=80+ie*.15;P&&P(0,100,Math.round(ae)),f(`[StartMenu] : ${O}/${B} (${ie}%)`)}),f("[StartMenu] ")}catch(O){f("[StartMenu] :",O)}P&&P(0,100,100),c.value=!0,f("[StartMenu] "),d.value=!0}catch(N){f("[StartMenu] 3D",N);const b=new qt(1,1,1),L=new Bt({color:16096779}),O=new it(b,L);o.add(O),l=O,f("[StartMenu] ...");try{await Ba.startPreload(["high","medium"],(B,ie,ae)=>{const de=80+ae*.15;P&&P(0,100,Math.round(de)),f(`[StartMenu] : ${B}/${ie} (${ae}%)`)}),f("[StartMenu] ")}catch(B){f("[StartMenu] :",B)}P&&P(0,100,100),c.value=!0,f("[StartMenu] "),d.value=!0}window.__START_MENU_PAUSE__=()=>$(),window.__START_MENU_RESUME__=()=>C()}function F(){g("started"),$()}function X(){p.value=!0}function Y(){p.value=!1}return Rt(()=>{d.value=!1,c.value=!1,f("[StartMenu] ..."),!o&&n.value?(o=new fo,o.background=null,i=new Rn(50,1.333,.1,1e3),i.position.set(-3.655,.2,-.006),i.rotation.set(-1.618275,-1.538307,-1.6183,"XYZ"),a=new ho({antialias:!0,alpha:!0,canvas:n.value}),a.setSize(window.innerWidth,window.innerHeight),a.setPixelRatio(window.devicePixelRatio),a.setClearColor(0,0),window.addEventListener("resize",y),v(),f("[StartMenu] ")):o&&!l?f("[StartMenu] "):l&&(f("[StartMenu] Logo"),d.value=!0,c.value=!0),window.__INIT_THREE_SCENE__=async P=>{if(o&&l){f("[StartMenu] Logo"),d.value=!0,c.value=!0;return}f("[StartMenu] 3D..."),await M(P)}}),ys(()=>{S()}),(P,R)=>(G(),j("div",Ip,[h("div",{class:"startmenu__bg",style:jt({backgroundImage:`url('${m.value}')`})},null,4),h("canvas",{ref_key:"canvasRef",ref:n,class:"startmenu__canvas"},null,512),Nr(h("div",{class:nt(["startmenu-ui",{"fade-in":d.value}])},[h("button",{id:"start-btn",class:"startmenu-btn","aria-label":"",onClick:F},"  "),h("button",{id:"settings-btn",class:"startmenu-btn","aria-label":"",onClick:X},"  ")],2),[[bl,d.value]]),p.value?(G(),j("div",Op,[h("div",{class:"settings-local__card"},[h("div",{class:"settings-local__header"},[R[0]||(R[0]=h("div",{class:"settings-local__title"},"",-1)),h("button",{class:"settings-local__close",onClick:Y,"aria-label":""},"  ")]),R[1]||(R[1]=h("div",{class:"settings-local__content"},[h("div",{class:"settings-local__row"},"  ")],-1))])])):we("",!0)]))}},Np=ct(Dp,[["__scopeId","data-v-8bcf9354"]]),ja={type:"change"},Fi={type:"start"},kl={type:"end"},zn=new _c,za=new or,Hp=Math.cos(70*sr.DEG2RAD),lt=new Pe,Ct=2*Math.PI,Ue={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},Yo=1e-6;class Gp extends gc{constructor(t,s=null){super(t,s),this.state=Ue.NONE,this.target=new Pe,this.cursor=new Pe,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Ks.ROTATE,MIDDLE:Ks.DOLLY,RIGHT:Ks.PAN},this.touches={ONE:Vs.ROTATE,TWO:Vs.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Pe,this._lastQuaternion=new wn,this._lastTargetPosition=new Pe,this._quat=new wn().setFromUnitVectors(t.up,new Pe(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Ki,this._sphericalDelta=new Ki,this._scale=1,this._panOffset=new Pe,this._rotateStart=new xt,this._rotateEnd=new xt,this._rotateDelta=new xt,this._panStart=new xt,this._panEnd=new xt,this._panDelta=new xt,this._dollyStart=new xt,this._dollyEnd=new xt,this._dollyDelta=new xt,this._dollyDirection=new Pe,this._mouse=new xt,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Up.bind(this),this._onPointerDown=Fp.bind(this),this._onPointerUp=Bp.bind(this),this._onContextMenu=Xp.bind(this),this._onMouseWheel=Vp.bind(this),this._onKeyDown=Kp.bind(this),this._onTouchStart=Wp.bind(this),this._onTouchMove=qp.bind(this),this._onMouseDown=jp.bind(this),this._onMouseMove=zp.bind(this),this._interceptControlDown=Yp.bind(this),this._interceptControlUp=Jp.bind(this),this.domElement!==null&&this.connect(this.domElement),this.update()}connect(t){super.connect(t),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(t){t.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=t}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(ja),this.update(),this.state=Ue.NONE}update(t=null){const s=this.object.position;lt.copy(s).sub(this.target),lt.applyQuaternion(this._quat),this._spherical.setFromVector3(lt),this.autoRotate&&this.state===Ue.NONE&&this._rotateLeft(this._getAutoRotationAngle(t)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let n=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(n)&&isFinite(o)&&(n<-Math.PI?n+=Ct:n>Math.PI&&(n-=Ct),o<-Math.PI?o+=Ct:o>Math.PI&&(o-=Ct),n<=o?this._spherical.theta=Math.max(n,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(n+o)/2?Math.max(n,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let i=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const a=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),i=a!=this._spherical.radius}if(lt.setFromSpherical(this._spherical),lt.applyQuaternion(this._quatInverse),s.copy(this.target).add(lt),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let a=null;if(this.object.isPerspectiveCamera){const r=lt.length();a=this._clampDistance(r*this._scale);const l=r-a;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),i=!!l}else if(this.object.isOrthographicCamera){const r=new Pe(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),i=l!==this.object.zoom;const u=new Pe(this._mouse.x,this._mouse.y,0);u.unproject(this.object),this.object.position.sub(u).add(r),this.object.updateMatrixWorld(),a=lt.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;a!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(a).add(this.object.position):(zn.origin.copy(this.object.position),zn.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(zn.direction))<Hp?this.object.lookAt(this.target):(za.setFromNormalAndCoplanarPoint(this.object.up,this.target),zn.intersectPlane(za,this.target))))}else if(this.object.isOrthographicCamera){const a=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),a!==this.object.zoom&&(this.object.updateProjectionMatrix(),i=!0)}return this._scale=1,this._performCursorZoom=!1,i||this._lastPosition.distanceToSquared(this.object.position)>Yo||8*(1-this._lastQuaternion.dot(this.object.quaternion))>Yo||this._lastTargetPosition.distanceToSquared(this.target)>Yo?(this.dispatchEvent(ja),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(t){return t!==null?Ct/60*this.autoRotateSpeed*t:Ct/60/60*this.autoRotateSpeed}_getZoomScale(t){const s=Math.abs(t*.01);return Math.pow(.95,this.zoomSpeed*s)}_rotateLeft(t){this._sphericalDelta.theta-=t}_rotateUp(t){this._sphericalDelta.phi-=t}_panLeft(t,s){lt.setFromMatrixColumn(s,0),lt.multiplyScalar(-t),this._panOffset.add(lt)}_panUp(t,s){this.screenSpacePanning===!0?lt.setFromMatrixColumn(s,1):(lt.setFromMatrixColumn(s,0),lt.crossVectors(this.object.up,lt)),lt.multiplyScalar(t),this._panOffset.add(lt)}_pan(t,s){const n=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;lt.copy(o).sub(this.target);let i=lt.length();i*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*t*i/n.clientHeight,this.object.matrix),this._panUp(2*s*i/n.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(t*(this.object.right-this.object.left)/this.object.zoom/n.clientWidth,this.object.matrix),this._panUp(s*(this.object.top-this.object.bottom)/this.object.zoom/n.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(t){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=t:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(t,s){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const n=this.domElement.getBoundingClientRect(),o=t-n.left,i=s-n.top,a=n.width,r=n.height;this._mouse.x=o/a*2-1,this._mouse.y=-(i/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(t){return Math.max(this.minDistance,Math.min(this.maxDistance,t))}_handleMouseDownRotate(t){this._rotateStart.set(t.clientX,t.clientY)}_handleMouseDownDolly(t){this._updateZoomParameters(t.clientX,t.clientX),this._dollyStart.set(t.clientX,t.clientY)}_handleMouseDownPan(t){this._panStart.set(t.clientX,t.clientY)}_handleMouseMoveRotate(t){this._rotateEnd.set(t.clientX,t.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Ct*this._rotateDelta.x/s.clientHeight),this._rotateUp(Ct*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(t){this._dollyEnd.set(t.clientX,t.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(t){this._panEnd.set(t.clientX,t.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(t){this._updateZoomParameters(t.clientX,t.clientY),t.deltaY<0?this._dollyIn(this._getZoomScale(t.deltaY)):t.deltaY>0&&this._dollyOut(this._getZoomScale(t.deltaY)),this.update()}_handleKeyDown(t){let s=!1;switch(t.code){case this.keys.UP:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(Ct*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),s=!0;break;case this.keys.BOTTOM:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateUp(-Ct*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),s=!0;break;case this.keys.LEFT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(Ct*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),s=!0;break;case this.keys.RIGHT:t.ctrlKey||t.metaKey||t.shiftKey?this.enableRotate&&this._rotateLeft(-Ct*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),s=!0;break}s&&(t.preventDefault(),this.update())}_handleTouchStartRotate(t){if(this._pointers.length===1)this._rotateStart.set(t.pageX,t.pageY);else{const s=this._getSecondPointerPosition(t),n=.5*(t.pageX+s.x),o=.5*(t.pageY+s.y);this._rotateStart.set(n,o)}}_handleTouchStartPan(t){if(this._pointers.length===1)this._panStart.set(t.pageX,t.pageY);else{const s=this._getSecondPointerPosition(t),n=.5*(t.pageX+s.x),o=.5*(t.pageY+s.y);this._panStart.set(n,o)}}_handleTouchStartDolly(t){const s=this._getSecondPointerPosition(t),n=t.pageX-s.x,o=t.pageY-s.y,i=Math.sqrt(n*n+o*o);this._dollyStart.set(0,i)}_handleTouchStartDollyPan(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enablePan&&this._handleTouchStartPan(t)}_handleTouchStartDollyRotate(t){this.enableZoom&&this._handleTouchStartDolly(t),this.enableRotate&&this._handleTouchStartRotate(t)}_handleTouchMoveRotate(t){if(this._pointers.length==1)this._rotateEnd.set(t.pageX,t.pageY);else{const n=this._getSecondPointerPosition(t),o=.5*(t.pageX+n.x),i=.5*(t.pageY+n.y);this._rotateEnd.set(o,i)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const s=this.domElement;this._rotateLeft(Ct*this._rotateDelta.x/s.clientHeight),this._rotateUp(Ct*this._rotateDelta.y/s.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(t){if(this._pointers.length===1)this._panEnd.set(t.pageX,t.pageY);else{const s=this._getSecondPointerPosition(t),n=.5*(t.pageX+s.x),o=.5*(t.pageY+s.y);this._panEnd.set(n,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(t){const s=this._getSecondPointerPosition(t),n=t.pageX-s.x,o=t.pageY-s.y,i=Math.sqrt(n*n+o*o);this._dollyEnd.set(0,i),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const a=(t.pageX+s.x)*.5,r=(t.pageY+s.y)*.5;this._updateZoomParameters(a,r)}_handleTouchMoveDollyPan(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enablePan&&this._handleTouchMovePan(t)}_handleTouchMoveDollyRotate(t){this.enableZoom&&this._handleTouchMoveDolly(t),this.enableRotate&&this._handleTouchMoveRotate(t)}_addPointer(t){this._pointers.push(t.pointerId)}_removePointer(t){delete this._pointerPositions[t.pointerId];for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==t.pointerId){this._pointers.splice(s,1);return}}_isTrackingPointer(t){for(let s=0;s<this._pointers.length;s++)if(this._pointers[s]==t.pointerId)return!0;return!1}_trackPointer(t){let s=this._pointerPositions[t.pointerId];s===void 0&&(s=new xt,this._pointerPositions[t.pointerId]=s),s.set(t.pageX,t.pageY)}_getSecondPointerPosition(t){const s=t.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[s]}_customWheelEvent(t){const s=t.deltaMode,n={clientX:t.clientX,clientY:t.clientY,deltaY:t.deltaY};switch(s){case 1:n.deltaY*=16;break;case 2:n.deltaY*=100;break}return t.ctrlKey&&!this._controlActive&&(n.deltaY*=10),n}}function Fp(e){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(e)&&(this._addPointer(e),e.pointerType==="touch"?this._onTouchStart(e):this._onMouseDown(e)))}function Up(e){this.enabled!==!1&&(e.pointerType==="touch"?this._onTouchMove(e):this._onMouseMove(e))}function Bp(e){switch(this._removePointer(e),this._pointers.length){case 0:this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(kl),this.state=Ue.NONE;break;case 1:const t=this._pointers[0],s=this._pointerPositions[t];this._onTouchStart({pointerId:t,pageX:s.x,pageY:s.y});break}}function jp(e){let t;switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Ks.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(e),this.state=Ue.DOLLY;break;case Ks.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=Ue.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=Ue.ROTATE}break;case Ks.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(e),this.state=Ue.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(e),this.state=Ue.PAN}break;default:this.state=Ue.NONE}this.state!==Ue.NONE&&this.dispatchEvent(Fi)}function zp(e){switch(this.state){case Ue.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(e);break;case Ue.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(e);break;case Ue.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(e);break}}function Vp(e){this.enabled===!1||this.enableZoom===!1||this.state!==Ue.NONE||(e.preventDefault(),this.dispatchEvent(Fi),this._handleMouseWheel(this._customWheelEvent(e)),this.dispatchEvent(kl))}function Kp(e){this.enabled!==!1&&this._handleKeyDown(e)}function Wp(e){switch(this._trackPointer(e),this._pointers.length){case 1:switch(this.touches.ONE){case Vs.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(e),this.state=Ue.TOUCH_ROTATE;break;case Vs.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(e),this.state=Ue.TOUCH_PAN;break;default:this.state=Ue.NONE}break;case 2:switch(this.touches.TWO){case Vs.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(e),this.state=Ue.TOUCH_DOLLY_PAN;break;case Vs.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(e),this.state=Ue.TOUCH_DOLLY_ROTATE;break;default:this.state=Ue.NONE}break;default:this.state=Ue.NONE}this.state!==Ue.NONE&&this.dispatchEvent(Fi)}function qp(e){switch(this._trackPointer(e),this.state){case Ue.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(e),this.update();break;case Ue.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(e),this.update();break;case Ue.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(e),this.update();break;case Ue.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(e),this.update();break;default:this.state=Ue.NONE}}function Xp(e){this.enabled!==!1&&e.preventDefault()}function Yp(e){e.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Jp(e){e.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const Zp={class:"startgame-modal"},Qp={class:"card"},em={class:"card__body"},tm={class:"card__content"},sm={key:0,class:"loading"},nm={key:1,class:"error"},om={key:2,class:"list"},im=["onClick"],am={class:"item__img"},rm=["src","alt"],lm={class:"item__meta"},cm={class:"item__name"},um={class:"item__level"},dm={class:"preview"},fm={class:"preview__info"},hm={key:0,class:"preview__empty"},pm={key:1,class:"preview__names"},mm={class:"preview__name-number"},gm={class:"preview__name-text"},_m={class:"card__footer"},ym=["disabled"],vm=["src"],bm="url('/assets/panel1.png')",wm="url('/assets/panel3.png')",Sm="url('/assets/panel6.png')",Tm="url('/assets/panel8.png')",Am="url('/assets/panel9.png')",Mm="url('/assets/panel10.png')",Cm={__name:"StartGame",props:{musicOn:{type:Boolean,default:!0},paused:{type:Boolean,default:!1}},emits:["confirm","close"],setup(e,{emit:t}){tn(L=>({v3ea2b346:bm,v3ea0e1ca:wm,v3e9b6d56:Am,v3515ca1b:Mm,v3e9e2790:Sm,v3e9c5614:Tm}));const s=t,n=e,o=Z(!0),i=Z(""),a=Z([]),r=Z(new Set),l=Z(null),u=Z(null),c=oe("assets/startgame.mp3");let d,p,m,g,v;const y=new Map,$=ze(()=>r.value.size===3),C=ze(()=>a.value.filter(L=>r.value.has(L.id)));function S(){if(!l.value)return;d=new fo,d.background=new os(1710618),p=new Rn(45,l.value.clientWidth/l.value.clientHeight,.1,100),p.position.set(0,3,8),m=new ho({antialias:!0}),m.setSize(l.value.clientWidth,l.value.clientHeight),m.setPixelRatio(window.devicePixelRatio),l.value.appendChild(m.domElement),g=new Gp(p,m.domElement),g.enableDamping=!0,g.dampingFactor=.05,g.target.set(0,1,0);const L=new po(16777215,.5);d.add(L);const O=new hs(16777215,1);O.position.set(0,5,10),d.add(O);const B=new hs(11193599,.4);B.position.set(-5,3,5),d.add(B);const ie=new hs(16764074,.4);ie.position.set(5,3,5),d.add(ie);const ae=new hs(16777215,.3);ae.position.set(0,5,-5),d.add(ae);const de=new Vn(20,20),xe=new kt({color:2763306,side:Ds}),Ye=new it(de,xe);Ye.rotation.x=-Math.PI/2,Ye.position.y=0,d.add(Ye),v=new ko;const H=new Ro;H.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),v.setDRACOLoader(H),M(),window.addEventListener("resize",F)}function M(){requestAnimationFrame(M),g&&g.update(),m&&d&&p&&m.render(d,p)}function F(){!l.value||!p||!m||(p.aspect=l.value.clientWidth/l.value.clientHeight,p.updateProjectionMatrix(),m.setSize(l.value.clientWidth,l.value.clientHeight))}function X(L){const O=r.value;if(O.has(L))O.delete(L);else{if(O.size>=3)return;O.add(L)}r.value=new Set(O)}async function Y(L,O){if(!d||!v)return;let B=L.modelUrl;f(`[StartGame] model_url: ${L.name}, URL: ${B}`);try{const ie=await Lt.loadModel(B,!0);f(`[StartGame] : ${L.name}`);const de=new wt().setFromObject(ie).getSize(new Pe),xe=new Xt;xe.add(ie);const Ye=2.5,H=-(C.value.length-1)*Ye/2;xe.position.set(H+O*Ye,0,0),xe.scale.set(1,1,1),xe.rotation.y=-Math.PI/2;const ce=new wt().setFromObject(xe);xe.position.y=-ce.min.y,d.add(xe),y.set(L.id,xe),f(`[StartGame] : ${L.name}`)}catch(ie){f(`[StartGame] : ${L.name}`,ie),P(L,O)}}function P(L,O){if(!d)return;const B=new qt(.8,.8,.8),ie=new kt({color:4491519}),ae=new it(B,ie),de=2.5,xe=-(C.value.length-1)*de/2;ae.position.set(xe+O*de,.8,0),ae.rotation.y=-Math.PI/2,d.add(ae),y.set(L.id,ae)}function R(){d&&(y.forEach(L=>{d.remove(L),L.geometry&&L.geometry.dispose(),L.material&&(Array.isArray(L.material)?L.material.forEach(O=>O.dispose()):L.material.dispose())}),y.clear(),C.value.forEach((L,O)=>{Y(L,O)}))}async function V(){o.value=!0,i.value="";try{const L=await Zn(),O=Array.isArray(L==null?void 0:L.coppers)?L.coppers:[];a.value=(O||[]).map((B,ie)=>{var de,xe,Ye,H,ce,Te;const ae=(de=B==null?void 0:B.copper_info)==null?void 0:de.model_url;return f(`[StartGame] Copper ${((xe=B==null?void 0:B.copper_info)==null?void 0:xe.name)||ie+1}: model_url=${ae}`),{id:Number((B==null?void 0:B.id)??ie+1),name:((Ye=B==null?void 0:B.copper_info)==null?void 0:Ye.name)||`#${ie+1}`,icon:oe(((H=B==null?void 0:B.copper_info)==null?void 0:H.icon_url)||""),level:Number((B==null?void 0:B.level)??1),copperType:(B==null?void 0:B.copper_type)||"Arcanist",modelName:((Te=(ce=B==null?void 0:B.copper_info)==null?void 0:ce.name)==null?void 0:Te.toLowerCase())||"",modelUrl:ae?oe(ae):""}})}catch(L){f("[StartGame] ",L),i.value=""}finally{o.value=!1}}async function N(){if(r.value.size!==3)return;const L=Array.from(r.value).map(O=>String(O));window.__ACTUAL_COPPER_IDS__=L,f("[StartGame] ID:",L),s("confirm",{ids:L})}function b(){s("close")}return Nt(C,()=>{R()},{deep:!0}),Rt(()=>{V(),setTimeout(()=>{S()},100),n.musicOn&&!n.paused&&u.value&&setTimeout(()=>{if(u.value.readyState>=2)u.value.play().then(()=>{f("[StartGame] ")}).catch(O=>{f("[StartGame] :",O)});else{const O=()=>{u.value.play().then(()=>{f("[StartGame] ")}).catch(B=>{f("[StartGame] :",B)}),u.value.removeEventListener("canplay",O)};u.value.addEventListener("canplay",O,{once:!0})}},200)}),Nt(()=>n.musicOn,L=>{if(u.value)if(L&&!n.paused)if(u.value.readyState>=2)u.value.play().catch(O=>{f("[StartGame] :",O)});else{const O=()=>{u.value.play().catch(B=>{f("[StartGame] :",B)}),u.value.removeEventListener("canplay",O)};u.value.addEventListener("canplay",O)}else u.value.pause()}),Nt(()=>n.paused,L=>{if(u.value){if(L)u.value.pause(),f("[StartGame] ");else if(n.musicOn){if(u.value.readyState>=2)u.value.play().catch(O=>{f("[StartGame] :",O)});else{const O=()=>{u.value.play().catch(B=>{f("[StartGame] :",B)}),u.value.removeEventListener("canplay",O)};u.value.addEventListener("canplay",O)}f("[StartGame] ")}}}),ys(()=>{window.removeEventListener("resize",F),u.value&&u.value.pause(),y.forEach(L=>{d&&d.remove(L)}),y.clear(),m&&m.dispose(),g&&g.dispose()}),(L,O)=>(G(),j("div",Zp,[h("div",Qp,[h("div",{class:"card__header"},[O[0]||(O[0]=h("div",{class:"card__title"},"",-1)),h("button",{class:"card__close",onClick:b,"aria-label":""},"")]),h("div",em,[h("div",tm,[o.value?(G(),j("div",sm,"...")):i.value?(G(),j("div",nm,ee(i.value),1)):(G(),j("div",om,[(G(!0),j(Be,null,Dt(a.value,B=>(G(),j("div",{key:B.id,class:nt(["item",{"item--selected":r.value.has(B.id)}]),onClick:ie=>X(B.id)},[h("div",am,[h("img",{src:B.icon,alt:B.name},null,8,rm)]),h("div",lm,[h("div",cm,ee(B.name),1),h("div",um,"Lv. "+ee(B.level),1)])],10,im))),128))])),O[1]||(O[1]=h("div",{class:"hint"},"3",-1))]),h("div",dm,[O[2]||(O[2]=h("div",{class:"preview__title"},"",-1)),h("div",{ref_key:"previewContainer",ref:l,class:"preview__scene"},null,512),h("div",fm,[C.value.length===0?(G(),j("div",hm,"  ")):(G(),j("div",pm,[(G(!0),j(Be,null,Dt(C.value,(B,ie)=>(G(),j("div",{key:B.id,class:"preview__name"},[h("span",mm,ee(ie+1),1),h("span",gm,ee(B.name),1)]))),128))]))])])]),h("div",_m,[h("button",{class:"btn btn--primary",disabled:!$.value,onClick:N},"  ",8,ym),h("button",{class:"btn",onClick:b},"")])]),h("audio",{ref_key:"audioRef",ref:u,src:Ae(c),loop:"",preload:"auto"},null,8,vm)]))}},xm=ct(Cm,[["__scopeId","data-v-376e11a2"]]),Em={:"spark",:"syrup",:"bubble",:"glimmer",:"turner",:"wrench",:"artifex",:"coil",:"drillbit",:"quickhand",:"rocky",:"wesley",:"bell",:"tumble",:"chief",:"gyro",:"tricky",:"pendulum",:"yoyo",:"karin",:"murmur",:"melody",:"clawster",:"diggs",:"hive"},km={IronWall:"iron_wall",Arcanist:"arcanist",Mechanic:"mechanic",Resonator:"resonator",CraftsMan:"craftsman"};function Rm(e){return Em[e]||e.toLowerCase()}function $m(e){return km[e]||e.toLowerCase()}const Pm={:"rivet_barrier",:"gear_arrow_tower",:"heart_source_mineral_drill",:"steam_mining_car",:"charging_coil",:"repair_workshop",:"mirro_light_refraction_tower",:"resonance_alarm_bell",:"storm_anvil",:"automatic_loading_gun"};function Lm(e){return Pm[e]||e.toLowerCase().replace(/\s+/g,"_")}const Im={class:"diamond-row diamond-row--top"},Om=["title"],Dm={class:"diamond-content"},Nm={class:"diamond-text"},Hm={class:"diamond-value"},Gm={class:"diamond border-orange-red"},Fm={class:"diamond-content"},Um={class:"diamond-text"},Bm={class:"diamond-value"},jm={class:"diamond-row diamond-row--bottom"},zm={class:"diamond border-orange-red"},Vm={class:"diamond-content"},Km={class:"diamond-text"},Wm={class:"diamond-value"},qm={class:"diamond border-green"},Xm={class:"diamond-content"},Ym={class:"diamond-text"},Jm={class:"diamond-value"},Zm={class:"diamond border-blue"},Qm={class:"diamond-content"},eg={class:"diamond-text"},tg={class:"diamond-value"},sg={__name:"DiamondPanel",props:{copperInfo:{type:Object,required:!0},inventoryItems:{type:Array,default:()=>[]},inventoryCapacity:{type:Number,default:5}},emits:["inventory-click"],setup(e,{emit:t}){tn(u=>({v62cfbc26:s,v20b15665:n,v6f2cafe5:o}));const s=`url('${oe("ui/border-blue.png")}')`,n=`url('${oe("ui/border-green.png")}')`,o=`url('${oe("ui/border-orange-red.png")}')`,i=e,a=t;function r(){i.inventoryCapacity!==0&&a("inventory-click")}const l=Z(null);return Rt(async()=>{if(!l.value)return;function u(d){return new Promise((p,m)=>{const g=new Image;g.onload=()=>p(g),g.onerror=()=>m(),g.src=d})}function c(d,p){l.value&&l.value.style.setProperty(d,String(p))}try{const[d,p,m]=await Promise.all([u(oe("ui/border-blue.png")),u(oe("ui/border-green.png")),u(oe("ui/border-orange-red.png"))]),g=Math.max(3,Math.round(d.naturalHeight/4)),v=Math.max(3,Math.round(p.naturalHeight/4)),y=Math.max(3,Math.round(m.naturalHeight/4));c("--border-blue-slice",g),c("--border-green-slice",v),c("--border-orange-red-slice",y)}catch{c("--border-blue-slice","8"),c("--border-green-slice","8"),c("--border-orange-red-slice","8")}}),(u,c)=>(G(),j("div",{ref_key:"diamondPanelRef",ref:l,class:"diamond-panel"},[h("div",Im,[h("div",{class:nt(["diamond border-blue",{"diamond--disabled":e.inventoryCapacity===0}]),onClick:r,title:e.inventoryCapacity===0?"":""},[h("div",Dm,[h("div",Nm,[c[0]||(c[0]=h("div",{class:"diamond-label"},"",-1)),h("div",Hm,ee(e.inventoryItems.length)+"/"+ee(e.inventoryCapacity),1)])])],10,Om),h("div",Gm,[h("div",Fm,[h("div",Um,[c[1]||(c[1]=h("div",{class:"diamond-label"},"",-1)),h("div",Bm,ee(e.copperInfo.position[0])+","+ee(e.copperInfo.position[1]),1)])])])]),h("div",jm,[h("div",zm,[h("div",Vm,[h("div",Km,[c[2]||(c[2]=h("div",{class:"diamond-label"},"",-1)),h("div",Wm,ee(e.copperInfo.attack),1)])])]),h("div",qm,[h("div",Xm,[h("div",Ym,[c[3]||(c[3]=h("div",{class:"diamond-label"},"",-1)),h("div",Jm,ee(e.copperInfo.defense),1)])])]),h("div",Zm,[h("div",Qm,[h("div",eg,[c[4]||(c[4]=h("div",{class:"diamond-label"},"",-1)),h("div",tg,ee(e.copperInfo.speed),1)])])])])],512))}},ng=ct(sg,[["__scopeId","data-v-ad381490"]]),og={class:"minecraft-inventory"},ig={class:"inventory-header-mc"},ag={class:"copper-name"},rg={class:"inventory-layout"},lg={class:"crafting-section"},cg={class:"crafting-grid"},ug=["src"],dg={class:"craft-result"},fg={class:"recipe-display"},hg=["src"],pg={class:"inventory-section"},mg={class:"inventory-grid"},gg=["src"],_g={class:"slot-count",style:{color:"#4488ff"}},yg={key:1,class:"transfer-targets-panel"},vg=["onClick"],bg={key:2,class:"slot-tooltip"},wg={class:"tooltip-name"},Sg={key:0,class:"transfer-targets"},Tg={key:1,class:"tooltip-buttons"},Ag=["onClick"],Mg=["onClick"],Cg={__name:"InventoryModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},inventoryItems:{type:Array,default:()=>[]},transferTargets:{type:Array,default:()=>[]},transferringItemIndex:{type:Number,default:null}},emits:["close","craft","drop","transfer","transferTo"],setup(e,{emit:t}){const s=e,n=t,o=["HeartCrystalDust","RecallGear","ResonantCrystal","RefinedCopper"];function i(){n("close")}function a(){console.log("[InventoryModal] "),n("craft")}function r(c){console.log(`[InventoryModal] : index=${c}`),n("drop",c)}function l(c){if(!s.inventoryItems[c]||(s.inventoryItems[c].count||1)<=0){console.log(`[InventoryModal] : index=${c}`);return}console.log(`[InventoryModal] : index=${c}`),n("transfer",c)}function u(c){console.log(`[InventoryModal] : ${c.name} (: ${c.position})`),n("transferTo",c.position)}return(c,d)=>{var p;return e.visible?(G(),j("div",{key:0,class:"inventory-modal",onClick:Vt(i,["self"])},[h("div",og,[h("div",ig,[h("h3",null,[h("span",ag,ee(e.copperName),1),d[0]||(d[0]=en("  ",-1))]),h("button",{class:"close-btn-mc",onClick:i},"")]),h("div",rg,[h("div",lg,[d[1]||(d[1]=h("div",{class:"crafting-title"},"",-1)),h("div",cg,[(G(),j(Be,null,Dt(o,(m,g)=>{var v;return h("div",{class:"craft-slot",key:g},[(v=Ae(ns)[m])!=null&&v.icon?(G(),j("img",{key:0,src:Ae(ns)[m].icon,class:"craft-icon"},null,8,ug)):we("",!0)])}),64))]),d[2]||(d[2]=h("div",{class:"craft-arrow"},"",-1)),h("div",dg,[h("div",fg,[(p=Ae(ns).SpiritalSpark)!=null&&p.icon?(G(),j("img",{key:0,src:Ae(ns).SpiritalSpark.icon,class:"recipe-icon"},null,8,hg)):we("",!0)])]),h("button",{class:"craft-button-mc",onClick:a},"")]),h("div",pg,[h("div",mg,[(G(),j(Be,null,Dt(5,(m,g)=>h("div",{key:g,class:nt(["inv-slot",{"has-item":g<e.inventoryItems.length}])},[g<e.inventoryItems.length?(G(),j(Be,{key:0},[Ae(La)(e.inventoryItems[g])?(G(),j("img",{key:0,src:Ae(La)(e.inventoryItems[g]),class:"slot-icon"},null,8,gg)):we("",!0),h("div",_g,ee(e.inventoryItems[g].count||1),1),e.transferringItemIndex===g&&e.transferTargets&&e.transferTargets.length>0?(G(),j("div",yg,[d[3]||(d[3]=h("div",{class:"transfer-title"},"",-1)),(G(!0),j(Be,null,Dt(e.transferTargets,v=>(G(),j("div",{key:v.id,class:"transfer-target-item",onClick:Vt(y=>u(v),["stop"])},ee(v.name),9,vg))),128))])):(G(),j("div",bg,[h("div",wg,ee(Ae(Eo)(e.inventoryItems[g])),1),e.transferringItemIndex===g&&e.transferTargets&&e.transferTargets.length===0?(G(),j("div",Sg,[...d[4]||(d[4]=[h("div",{class:"transfer-title",style:{color:"#ff4444"}},"  ",-1)])])):(G(),j("div",Tg,[h("button",{class:"tooltip-transfer",onClick:Vt(v=>l(g),["stop"])},"  ",8,Ag),h("button",{class:"tooltip-drop",onClick:Vt(v=>r(g),["stop"])},"  ",8,Mg)]))]))],64)):we("",!0)],2)),64))])])])])])):we("",!0)}}},xg=ct(Cg,[["__scopeId","data-v-08120a17"]]),Eg={class:"health-bar","aria-label":"Health Bar"},kg={class:"health-bar__border"},Rg={class:"health-bar__border-left"},$g=["src"],Pg={class:"health-bar__border-right"},Lg=["src"],Ig={class:"health-bar__text"},Og={__name:"HealthBar",props:{hp:{type:Number,default:0},maxHp:{type:Number,default:100}},setup(e){tn(l=>({f2086168:o,v80bbb6b0:i}));const t=e,s=oe("ui/blood-border-left.png"),n=oe("ui/blood-border-right.png"),o=`url('${oe("ui/blood-border-middle.png")}')`,i=`url('${oe("ui/blood-bar.png")}')`,a=ze(()=>{if(!t.maxHp||t.maxHp===0)return 0;const u=Math.max(0,Math.min(t.hp,t.maxHp))/t.maxHp*100;return Math.max(0,Math.min(100,u))}),r=ze(()=>{const l=Math.max(0,Math.min(t.hp,t.maxHp)),u=t.maxHp||100;return`${Math.round(l)}/${Math.round(u)}`});return(l,u)=>(G(),j("div",Eg,[h("div",kg,[h("div",Rg,[h("img",{src:Ae(s),alt:""},null,8,$g)]),u[0]||(u[0]=h("div",{class:"health-bar__border-middle"},null,-1)),h("div",Pg,[h("img",{src:Ae(n),alt:""},null,8,Lg)]),h("div",{class:"health-bar__fill",style:jt({width:`calc(${a.value}% + 20px)`})},null,4),h("div",Ig,ee(r.value),1)])]))}},Dg=ct(Og,[["__scopeId","data-v-a6a072c1"]]),Ng="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAABGdBTUEAALGPC/xhBQAAAAxQTFRFAAAAwMDA////AAAAyzCG0wAAAAF0Uk5TAEDm2GYAAABMSURBVAjXFcuxDcAgDETRLzGAR/JIGSH7mMIjhHWSiioFMiGmecU/HWgHVkAZF8jjDbXa+DbDfJPDsCNbrR31O5D1npSYnmfdyEpK/K7HIz8N2Pn7AAAAAElFTkSuQmCC",Hg={class:"tri-panel"},Gg={class:"diamond","aria-label":""},Fg=["src"],Ug=["src"],Bg=["title"],jg=["src"],zg=["src"],Vg=["title"],Kg=["src"],Wg=["src"],qg=["title"],Xg=["src"],Yg=["src"],Jg=["title"],Zg=["src"],Qg={__name:"TriPanel",props:{canMove:{type:Boolean,default:!0},canAttack:{type:Boolean,default:!0},canSummon:{type:Boolean,default:!1},canBuild:{type:Boolean,default:!0}},emits:["move","wait","attack","summon","build"],setup(e,{emit:t}){const s=e,n=t,o=oe("ui/your-image.png"),i=oe("ui/boot.png"),a=oe("ui/mushroom.png"),r=oe("ui/sword.png"),l=oe("ui/currentcupper.png");oe("ui/panel.png");function u(){s.canMove&&n("move")}function c(){n("wait")}function d(){s.canAttack&&n("attack")}function p(){s.canSummon&&n("summon")}function m(){s.canBuild&&n("build")}return(g,v)=>(G(),j("div",Hg,[h("div",Gg,[h("div",{class:"hex top",title:"",onClick:c},[h("img",{class:"hex-bg",src:Ae(o),alt:""},null,8,Fg),h("img",{class:"hex-icon",src:Ae(i),alt:""},null,8,Ug)]),h("div",{class:nt(["hex left",{"is-locked":e.canMove===!1}]),title:e.canMove?"":"",onClick:u},[h("img",{class:"hex-bg",src:Ae(o),alt:""},null,8,jg),h("img",{class:"hex-icon",src:Ae(a),alt:""},null,8,zg)],10,Bg),e.canSummon?(G(),j("div",{key:0,class:nt(["hex right",{"is-locked":e.canSummon===!1}]),title:e.canSummon?"":"",onClick:p},[h("img",{class:"hex-bg",src:Ae(o),alt:""},null,8,Kg),h("img",{class:"hex-icon",src:Ae(l),alt:""},null,8,Wg)],10,Vg)):(G(),j("div",{key:1,class:nt(["hex right",{"is-locked":e.canAttack===!1}]),title:e.canAttack?"":"",onClick:d},[h("img",{class:"hex-bg",src:Ae(o),alt:""},null,8,Xg),h("img",{class:"hex-icon",src:Ae(r),alt:""},null,8,Yg)],10,qg)),h("div",{class:nt(["hex bottom",{"is-locked":e.canBuild===!1}]),title:e.canBuild?"":"",onClick:m},[h("img",{class:"hex-bg",src:Ae(o),alt:""},null,8,Zg),v[0]||(v[0]=h("img",{class:"hex-icon",src:Ng,alt:""},null,-1))],10,Jg)])]))}},e_=ct(Qg,[["__scopeId","data-v-f3d9e1fd"]]),t_={class:"modal-info"},s_={class:"info-text"},n_={class:"copper-name"},o_={class:"modal-body"},i_={class:"structure-list"},a_=["onClick"],r_={class:"structure-header"},l_={class:"structure-name-row"},c_={class:"structure-name"},u_={class:"structure-type"},d_={class:"structure-stats"},f_={class:"stat"},h_={class:"stat-value"},p_={class:"stat"},m_={class:"stat-value"},g_={class:"stat"},__={class:"stat-value"},y_={class:"stat"},v_={class:"stat-value"},b_={class:"structure-cost"},w_={class:"cost-value"},S_={class:"structure-desc"},T_={key:0,class:"selected-badge"},A_={class:"modal-footer"},M_=["disabled"],C_={__name:"BuildModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},structureList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","build"],setup(e,{emit:t}){const s=e,n=t,o=Z(null),i=ze(()=>[...s.structureList].sort((d,p)=>{const m=g=>{var y;const v=((y=g.cost)==null?void 0:y.cost)||g.cost;return!Array.isArray(v)||v.length===0?0:Array.isArray(v[0])?v[0][1]:v[0].count};return m(d)-m(p)}));function a(d){o.value=d}function r(){if(!o.value){f("[BuildModal] ");return}f("[BuildModal] :",o.value.name),n("build",o.value.name),l()}function l(){o.value=null,n("close")}function u(d){return{:"",:"",:"",:""}[d]||""}function c(d){if(!d)return"";const p=d.cost||d;return!Array.isArray(p)||p.length===0?"":p.map(m=>{var g;if(Array.isArray(m)){const v=m[0],y=m[1];return`${((g=ns[v])==null?void 0:g.name)||v} x${y}`}return`${Eo(m)} x${m.count}`}).join(", ")}return(d,p)=>(G(),Ot(Ur,{to:"body"},[e.visible?(G(),j("div",{key:0,class:"modal-overlay",onClick:Vt(l,["self"])},[h("div",{class:"build-modal",onClick:p[0]||(p[0]=Vt(()=>{},["stop"]))},[h("div",{class:"modal-header"},[p[1]||(p[1]=h("h2",{class:"modal-title"}," ",-1)),h("button",{class:"close-btn",onClick:l,title:""},"")]),h("div",t_,[h("p",s_,[h("span",n_,ee(e.copperName),1),p[2]||(p[2]=en("  ",-1))]),p[3]||(p[3]=h("p",{class:"tip-text"}," ",-1))]),h("div",o_,[h("div",i_,[(G(!0),j(Be,null,Dt(i.value,m=>{var g,v,y;return G(),j("div",{key:m.name,class:nt(["structure-card",{selected:((g=o.value)==null?void 0:g.name)===m.name}]),onClick:$=>a(m)},[h("div",r_,[h("div",l_,[h("span",c_,ee(m.name),1)]),h("span",u_,ee(u(m.name)),1)]),h("div",d_,[h("div",f_,[p[4]||(p[4]=h("span",{class:"stat-label"},"",-1)),h("span",h_,ee(m.health),1)]),h("div",p_,[p[5]||(p[5]=h("span",{class:"stat-label"},"",-1)),h("span",m_,ee(((v=m.attribute)==null?void 0:v.attack)||""),1)]),h("div",g_,[p[6]||(p[6]=h("span",{class:"stat-label"},"",-1)),h("span",__,ee(m.has_storage?"":""),1)]),h("div",y_,[p[7]||(p[7]=h("span",{class:"stat-label"},"",-1)),h("span",v_,ee(m.attack_range||""),1)])]),h("div",b_,[p[8]||(p[8]=h("span",{class:"cost-label"}," ",-1)),h("span",w_,ee(c(m.cost)),1)]),h("div",S_,ee(m.description),1),((y=o.value)==null?void 0:y.name)===m.name?(G(),j("div",T_,"   ")):we("",!0)],10,a_)}),128))])]),h("div",A_,[h("button",{class:"btn btn-cancel",onClick:l},""),h("button",{class:"btn btn-confirm",disabled:!o.value,onClick:r},"  ",8,M_)])])])):we("",!0)]))}},x_=ct(C_,[["__scopeId","data-v-a0ad5903"]]),E_={key:0,class:"copper-panel-parent"},k_={key:0,class:"minimized-content"},R_={class:"minimized-info"},$_={class:"minimized-name"},P_={class:"minimized-action"},L_={class:"panel-content"},I_={key:0,class:"resources"},O_={class:"resources-list"},D_=["onClick"],N_={class:"resource-name"},H_={class:"resource-count"},G_={key:2,class:"enemy-info-tip"},F_={__name:"ActionPanel",props:{copper:{type:Object,default:null},resources:{type:Array,default:()=>[]},hasAttackTargets:{type:Boolean,default:!0},onSelectCopper:{type:Function,default:null},transferTargets:{type:Array,default:()=>[]}},emits:["close","action","selectCopper"],setup(e,{expose:t,emit:s}){tn(H=>({v295954b4:i.value,d900c8bc:a.value,v50bf6686:r.value,v17b5e670:l.value}));const n=e,o=s,i=ze(()=>`url('${oe("ui/sword.png")}')`),a=ze(()=>`url('${oe("ui/red.png")}')`),r=ze(()=>`url('${oe("ui/boot.png")}')`),l=ze(()=>`url('${oe("ui/green.png")}')`),u=Z("full"),c=Z(null),d=Z(!1),p=Z(null),m=Z(!1),g=Z([]),v=ze(()=>!n.copper||!n.copper.inventory?[]:n.copper.inventory.items||[]),y=ze(()=>{var H,ce,Te,et,ut,He,ke,_t,at,Je,$t,_;return n.copper?{id:n.copper.id,name:((ce=(H=n.copper.copper)==null?void 0:H.copper_info)==null?void 0:ce.name)||"",level:((Te=n.copper.copper)==null?void 0:Te.level)||1,hp:n.copper.now_health,maxHp:((ut=(et=n.copper.copper)==null?void 0:et.attribute)==null?void 0:ut.health)||100,attack:((ke=(He=n.copper.copper)==null?void 0:He.attribute)==null?void 0:ke.attack)||0,defense:((at=(_t=n.copper.copper)==null?void 0:_t.attribute)==null?void 0:at.defense)||0,speed:(($t=(Je=n.copper.copper)==null?void 0:Je.attribute)==null?void 0:$t.speed)||0,canMove:n.copper.can_move,canAttack:n.copper.can_attack,canSummon:n.copper.can_summon,position:n.copper.position,inventoryCapacity:((_=n.copper.inventory)==null?void 0:_.capacity)||0}:null});async function $(){if(!y.value.canMove)return;f("[ActionPanel] ");const H=n.copper.isOwnedEnemy===!0,ce=H?"on_enemy_move_start":"on_move_start";f(`[ActionPanel] : ${H?"":""}, : ${ce}`);const Te=JSON.stringify({type:ce,content:{id:String(y.value.id)}});await _e(Te),u.value="minimized",c.value="moving",o("action",{type:"moveStart",copperId:y.value.id})}async function C(){if(f("[ActionPanel] ",{canAttack:y.value.canAttack,copperId:y.value.id,name:y.value.name}),!y.value.canAttack){f("[ActionPanel] : ");return}f("[ActionPanel] ");const H=n.copper.isOwnedEnemy===!0,ce=H?"on_enemy_attack_start":"on_attack_start";f(`[ActionPanel] : ${H?"":""}, : ${ce}`);const Te=JSON.stringify({type:ce,content:{id:String(y.value.id)}});await _e(Te),u.value="minimized",c.value="attacking",o("action",{type:"attackStart",copperId:y.value.id})}async function S(){if(f("[ActionPanel] ",{canSummon:y.value.canSummon,copperId:y.value.id,name:y.value.name}),!y.value.canSummon){f("[ActionPanel] : ");return}f("[ActionPanel] ");const H=JSON.stringify({type:"on_summon_start",content:{id:String(y.value.id)}});await _e(H),u.value="minimized",c.value="summoning",o("action",{type:"summonStart",copperId:y.value.id})}async function M(){f("[ActionPanel] ",{copperId:y.value.id,name:y.value.name}),o("action",{type:"buildRequest",copperId:y.value.id})}function F(H){f("[ActionPanel] ",(H==null?void 0:H.length)||0,""),g.value=H||[],m.value=!0}async function X(H){f("[ActionPanel] :",H),m.value=!1;const ce=JSON.stringify({type:"on_structure_build_start",content:{id:String(y.value.id),name:H}});await _e(ce),u.value="minimized",c.value="building",o("action",{type:"buildStart",copperId:y.value.id,structureName:H})}function Y(){if(y.value.inventoryCapacity===0){f("[ActionPanel] 0");return}f("[ActionPanel] "),d.value=!0}async function P(H){f(`[ActionPanel] : index=${H}`);const ce=JSON.stringify({type:"on_copper_pick_up",content:{id:String(y.value.id),index:String(H)}});await _e(ce),await O()}async function R(H){f(`[ActionPanel] : index=${H}`);const ce=JSON.stringify({type:"on_copper_drop_item",content:{id:String(y.value.id),index:String(H)}});await _e(ce),await O()}async function V(){f("[ActionPanel] ");const H=JSON.stringify({type:"on_copper_craft",content:{id:String(y.value.id)}});await _e(H),await O()}async function N(){await V()}async function b(H){await R(H)}async function L(H){var ut;if(!y.value||!v.value[H])return;const Te=v.value[H].count||1;if(Te<=0){f(`[ActionPanel] : index=${H}, count=${Te}`);return}f(`[ActionPanel] : index=${H}, count=${Te}`),p.value=H,c.value="transferring",d.value||(d.value=!0),o("action",{type:"transferStart",copperId:y.value.id,itemIndex:H}),await new Promise(He=>setTimeout(He,50));const et=JSON.stringify({type:"on_transfer_start",content:{id:String(y.value.id),index:String(H),count:String(Te)}});await _e(et),await new Promise(He=>setTimeout(He,200)),f(`[ActionPanel] : ${((ut=n.transferTargets)==null?void 0:ut.length)||0}, transferringItemIndex=${p.value}`),n.transferTargets&&n.transferTargets.length>0&&f("[ActionPanel] :",n.transferTargets.map(He=>He.name))}async function O(){const ce=n.copper.isOwnedEnemy===!0?"on_click_enemy":"on_click_copper",Te=JSON.stringify({type:ce,content:{id:String(y.value.id)}});await _e(Te)}function B(){f("[ActionPanel] "),o("action",{type:"wait",copperId:y.value.id})}function ie(){u.value="full",c.value=null,d.value=!1,o("close")}function ae(){c.value==="transferring"&&(p.value=null,c.value=null,o("action",{type:"cancel",copperId:y.value.id})),d.value=!1}async function de(H){if(p.value!==null&&p.value!==void 0){f(`[ActionPanel] : ${H}`);const ce=JSON.stringify({type:"on_transfer_apply",content:{position:{x:String(H[0]),y:String(H[1])}}});await _e(ce);const Te=JSON.stringify({type:"on_transfer_end"});await _e(Te),p.value=null,c.value=null,o("action",{type:"transferComplete",copperId:y.value.id}),await new Promise(et=>setTimeout(et,100)),await O(),f("[ActionPanel] ")}}function xe(){u.value="full",c.value=null,o("action",{type:"cancel",copperId:y.value.id})}async function Ye(H){n.onSelectCopper?await n.onSelectCopper(H):o("selectCopper",H)}return t({cancelAction:xe,handleSelectCopper:Ye,showBuildMenu:F}),(H,ce)=>{var Te,et,ut,He,ke,_t,at,Je;return G(),j(Be,null,[e.copper?(G(),j("div",E_,[Qe(ng,{"copper-info":y.value,"inventory-items":v.value,"inventory-capacity":((Te=y.value)==null?void 0:Te.inventoryCapacity)||0,onInventoryClick:Y},null,8,["copper-info","inventory-items","inventory-capacity"]),Qe(Dg,{hp:((et=y.value)==null?void 0:et.hp)||0,"max-hp":((ut=y.value)==null?void 0:ut.maxHp)||100},null,8,["hp","max-hp"]),u.value==="minimized"||e.resources&&e.resources.length>0&&u.value==="full"?(G(),j("div",{key:0,class:nt(["copper-panel",{"copper-panel--minimized":u.value==="minimized","copper-panel--min-attack":u.value==="minimized"&&(c.value==="attacking"||c.value==="transferring"),"copper-panel--min-move":u.value==="minimized"&&c.value==="moving"}]),onClick:ce[0]||(ce[0]=Vt(()=>{},["stop"]))},[u.value==="minimized"?(G(),j("div",k_,[h("div",R_,[h("span",$_,ee(y.value.name),1),h("span",P_,ee(c.value==="moving"?"...":c.value==="attacking"?"...":c.value==="summoning"?"...":c.value==="building"?"...":c.value==="transferring"?"...":""),1)]),h("div",{class:"minimized-actions"},[h("button",{class:"mini-btn mini-btn--cancel",onClick:xe,title:""},"  ")])])):(G(),j(Be,{key:1},[h("button",{class:"close-btn",onClick:ie,title:""},""),h("div",L_,[e.resources&&e.resources.length>0?(G(),j("div",I_,[ce[3]||(ce[3]=h("div",{class:"resources-header"}," ",-1)),h("div",O_,[(G(!0),j(Be,null,Dt(e.resources,($t,_)=>(G(),j("div",{key:_,class:"resource-item",onClick:w=>P(_),title:""},[h("span",N_,ee(Ae(Eo)($t)),1),h("span",H_,"x"+ee($t.count||1),1),ce[2]||(ce[2]=h("span",{class:"resource-pickup"},"",-1))],8,D_))),128))])])):we("",!0)])],64))],2)):we("",!0),n.copper.isEnemy?we("",!0):(G(),Ot(e_,{key:1,"can-move":((He=y.value)==null?void 0:He.canMove)!==!1,"can-attack":((ke=y.value)==null?void 0:ke.canAttack)!==!1,"can-summon":((_t=y.value)==null?void 0:_t.canSummon)!==!1,"can-build":!0,onMove:$,onWait:B,onAttack:C,onSummon:S,onBuild:M},null,8,["can-move","can-attack","can-summon"])),n.copper.isEnemy?(G(),j("div",G_,[...ce[4]||(ce[4]=[h("span",null," ",-1)])])):we("",!0)])):we("",!0),Qe(xg,{visible:d.value,"copper-name":((at=y.value)==null?void 0:at.name)||"","inventory-items":v.value,"transfer-targets":n.transferTargets||[],"transferring-item-index":p.value,onClose:ae,onCraft:N,onDrop:b,onTransfer:L,onTransferTo:de},null,8,["visible","copper-name","inventory-items","transfer-targets","transferring-item-index"]),Qe(x_,{visible:m.value,"copper-name":((Je=y.value)==null?void 0:Je.name)||"","structure-list":g.value,onClose:ce[1]||(ce[1]=$t=>m.value=!1),onBuild:X},null,8,["visible","copper-name","structure-list"])],64)}}},U_=ct(F_,[["__scopeId","data-v-7eb62d00"]]),B_={class:"panel"},j_={class:"panel-inner"},z_={class:"section section-header"},V_=["aria-label"],K_={class:"section section-body"},W_={class:"current-doll",role:"status","aria-live":"polite"},q_={class:"section section-choices",role:"group","aria-label":"Character Queue"},X_=["aria-pressed","data-copper-id","title","onClick"],Y_=["alt","src","data-default-src","data-selected-src"],J_={class:"actions"},Z_=["disabled"],Q_={__name:"TurnSystem",props:{currentCopperId:{type:Number,default:null},copperList:{type:Array,default:()=>[]},roundNumber:{type:Number,default:1}},emits:["nextCopper","endRound","selectCopper"],setup(e,{emit:t}){tn(C=>({v03c06360:r,v09d44295:u,b5225d7c:l,v50623812:c,v7a0d86aa:d,v5cec6983:p,afc59b42:m}));const s=e,n=t,o=Z(null),i=oe("ui/choice.png"),a=oe("ui/choice-active.png"),r=`url('${oe("ui/ribbon-left.png")}')`,l=`url('${oe("ui/ribbon-middle.png")}')`,u=`url('${oe("ui/ribbon-right.png")}')`,c=`url('${oe("ui/panel.png")}')`,d=`url('${oe("ui/round1.png")}')`,p=`url('${oe("ui/currentcupper.png")}')`,m=`url('${oe("ui/btn.png")}')`,g=ze(()=>{if(!s.currentCopperId)return null;const C=s.copperList.find(S=>S.id===s.currentCopperId);return C?{id:C.id,name:C.name||` #${C.id}`,level:C.level||1}:null});function v(){n("nextCopper")}async function y(){const C=JSON.stringify({type:"on_game_round_pass"});await _e(C),n("endRound")}function $(C){n("selectCopper",C)}return Rt(async()=>{if(!o.value)return;function C(M){return new Promise((F,X)=>{const Y=new Image;Y.onload=()=>F(Y),Y.onerror=P=>{f(":",M,P),X(P)},Y.src=M})}function S(M,F){o.value&&(o.value.style.setProperty(M,String(F)),f(` CSS  ${M} = ${F}`))}try{const[M,F,X]=await Promise.all([C(oe("ui/panel.png")),C(oe("ui/btn.png")),C(oe("ui/currentcupper.png"))]),Y=Math.max(4,Math.round(M.naturalHeight/4)),P=Math.max(3,Math.round(F.naturalHeight/3)),R=Math.max(3,Math.round(X.naturalHeight/4));f(":",{panelSlice:Y,btnSlice:P,currentSlice:R,currentImgSize:`${X.naturalWidth}x${X.naturalHeight}`}),S("--panel-slice",Y),S("--btn-slice",P),S("--current-slice",R),setTimeout(()=>{const V=getComputedStyle(o.value);f("CSS :",{"--current-slice":V.getPropertyValue("--current-slice"),"--panel-slice":V.getPropertyValue("--panel-slice"),"--btn-slice":V.getPropertyValue("--btn-slice")})},100)}catch(M){f(":",M),S("--panel-slice","8"),S("--btn-slice","11"),S("--current-slice","8")}}),(C,S)=>{var M;return G(),j("div",{ref_key:"turnSystemRef",ref:o,class:"turn-system"},[S[0]||(S[0]=h("div",{class:"ribbon","aria-hidden":"true"},[h("div",{class:"ribbon-cap left"}),h("div",{class:"ribbon-fill"},"CONTROL"),h("div",{class:"ribbon-cap right"})],-1)),h("div",B_,[h("div",j_,[h("section",z_,[h("div",{class:"round-header",role:"img","aria-label":`Round ${e.roundNumber}`}," Round "+ee(e.roundNumber),9,V_)]),h("section",K_,[h("div",W_,ee(g.value?`${g.value.name||` #${e.currentCopperId}`}`:"")+" Lv."+ee(((M=g.value)==null?void 0:M.level)||1)+" ",1)]),h("section",q_,[(G(!0),j(Be,null,Dt(e.copperList,F=>(G(),j("button",{key:F.id,class:"choice",type:"button","aria-pressed":String(F.id===e.currentCopperId),"data-copper-id":F.id,title:F.name||` #${F.id}`,onClick:X=>$(F.id)},[h("img",{alt:F.name||`Character ${F.id}`,src:F.id===e.currentCopperId?Ae(a):Ae(i),"data-default-src":Ae(i),"data-selected-src":Ae(a)},null,8,Y_)],8,X_))),128))])])]),h("div",J_,[h("button",{class:"btn btn-primary",onClick:v,disabled:!e.currentCopperId},"  ",8,Z_),h("button",{class:"btn btn-secondary",onClick:y},"  ")])],512)}}},ey=ct(Q_,[["__scopeId","data-v-3c5f45ed"]]),ty={class:"modal-info"},sy={class:"info-text"},ny={class:"copper-name"},oy={class:"cost-text"},iy=["src"],ay={class:"modal-body"},ry={class:"enemy-list"},ly=["onClick"],cy={class:"enemy-header"},uy={class:"enemy-name-row"},dy={class:"enemy-name"},fy={class:"enemy-level"},hy={class:"enemy-type"},py={class:"enemy-stats"},my={class:"stat"},gy={class:"stat-value"},_y={class:"stat"},yy={class:"stat-value"},vy={class:"stat"},by={class:"stat-value"},wy={class:"stat"},Sy={class:"stat-value"},Ty={class:"stat"},Ay={class:"stat-value"},My={class:"enemy-desc"},Cy={key:0,class:"selected-badge"},xy={class:"modal-footer"},Ey=["disabled"],ky={__name:"SummonModal",props:{visible:{type:Boolean,default:!1},copperName:{type:String,default:""},enemyList:{type:Array,default:()=>[]},position:{type:Array,default:null}},emits:["close","summon"],setup(e,{emit:t}){const s=e,n=t,o=Z(null),i=ze(()=>[...s.enemyList].sort((c,d)=>c.level-d.level));function a(c){o.value=c}function r(){if(!o.value){f("[SummonModal] ");return}f("[SummonModal] :",o.value.name),n("summon",o.value.name),l()}function l(){o.value=null,n("close")}function u(c){return{goblin:"",cruiser:"",scout:"",boxer:"",horn:"",assassin:"",devourer:"",mirror:"",guard:"",demon:"",variant:"",shatra:"BOSS",glutton:"BOSS"}[c]||c}return(c,d)=>(G(),Ot(Ur,{to:"body"},[e.visible?(G(),j("div",{key:0,class:"modal-overlay",onClick:Vt(l,["self"])},[h("div",{class:"summon-modal",onClick:d[0]||(d[0]=Vt(()=>{},["stop"]))},[h("div",{class:"modal-header"},[d[1]||(d[1]=h("h2",{class:"modal-title"}," ",-1)),h("button",{class:"close-btn",onClick:l,title:""},"")]),h("div",ty,[h("p",sy,[h("span",ny,ee(e.copperName),1),d[2]||(d[2]=en("  ",-1))]),h("p",oy,[h("img",{class:"cost-icon",src:Ae(oe)("resource/spiritual_spark.webp"),alt:""},null,8,iy),d[3]||(d[3]=en(" ",-1)),d[4]||(d[4]=h("strong",null,"1 ",-1))])]),h("div",ay,[h("div",ry,[(G(!0),j(Be,null,Dt(i.value,p=>{var m,g;return G(),j("div",{key:p.name,class:nt(["enemy-card",{selected:((m=o.value)==null?void 0:m.name)===p.name}]),onClick:v=>a(p)},[h("div",cy,[h("div",uy,[h("span",dy,ee(p.name),1),h("span",fy,"Lv."+ee(p.level),1)]),h("span",hy,ee(u(p.enemy_type)),1)]),h("div",py,[h("div",my,[d[5]||(d[5]=h("span",{class:"stat-label"},"",-1)),h("span",gy,ee(p.health),1)]),h("div",_y,[d[6]||(d[6]=h("span",{class:"stat-label"},"",-1)),h("span",yy,ee(p.attack),1)]),h("div",vy,[d[7]||(d[7]=h("span",{class:"stat-label"},"",-1)),h("span",by,ee(p.defense),1)]),h("div",wy,[d[8]||(d[8]=h("span",{class:"stat-label"},"",-1)),h("span",Sy,ee(p.attack_range),1)]),h("div",Ty,[d[9]||(d[9]=h("span",{class:"stat-label"},"",-1)),h("span",Ay,ee(p.move_range),1)])]),h("div",My,ee(p.description),1),((g=o.value)==null?void 0:g.name)===p.name?(G(),j("div",Cy,"   ")):we("",!0)],10,ly)}),128))])]),h("div",xy,[h("button",{class:"btn btn-cancel",onClick:l},""),h("button",{class:"btn btn-confirm",disabled:!o.value,onClick:r},"  ",8,Ey)])])])):we("",!0)]))}},Ry=ct(ky,[["__scopeId","data-v-92788039"]]),$y={key:0,class:"minimized-content"},Py={class:"minimized-info"},Ly={class:"minimized-name"},Iy={class:"minimized-action"},Oy={key:1},Dy={class:"structure-panel__header"},Ny={class:"structure-panel__title"},Hy={class:"structure-panel__body"},Gy={class:"structure-panel__health"},Fy={class:"structure-panel__health-bar"},Uy={class:"structure-panel__health-text"},By={key:0,class:"structure-panel__storage"},jy={class:"structure-panel__storage-content"},zy={key:0,class:"structure-panel__storage-item"},Vy={class:"structure-panel__storage-name"},Ky={class:"structure-panel__storage-count"},Wy={key:1,class:"structure-panel__storage-empty"},qy={key:1,class:"structure-panel__ground-resources"},Xy={class:"structure-panel__ground-list"},Yy={class:"structure-panel__resource-name"},Jy={class:"structure-panel__resource-count"},Zy={key:2,class:"structure-panel__actions"},Qy={__name:"StructurePanel",props:{structure:{type:Object,required:!0},resources:{type:Array,default:()=>[]},actionMode:{type:String,default:null}},emits:["close","action","cancel"],setup(e,{emit:t}){const s=e,n=t,o=ze(()=>{var S;return((S=s.structure.structure_base)==null?void 0:S.name)||""}),i=ze(()=>s.structure.owned||!1),a=ze(()=>{var S;return((S=s.structure.structure_base)==null?void 0:S.has_storage)||!1}),r=ze(()=>s.structure.storage||null),l=ze(()=>s.structure.can_move||!1),u=ze(()=>s.structure.can_attack||!1),c=ze(()=>s.structure.now_health||0),d=ze(()=>{var S;return((S=s.structure.structure_base)==null?void 0:S.health)||100}),p=ze(()=>d.value===0?0:Math.max(0,Math.min(100,c.value/d.value*100))),m=ze(()=>{const S=p.value;return S>60?"#4ade80":S>30?"#facc15":"#ef4444"});oe("ui/panel.png");const g=ze(()=>s.actionMode!==null),v=ze(()=>s.actionMode==="move"?"...":s.actionMode==="attack"?"...":s.actionMode==="extract"?"...":s.actionMode==="transfer"?"...":"");function y(S){f(`[StructurePanel] : ${S}`),n("action",{type:S})}function $(){f("[StructurePanel] "),n("cancel")}function C(){n("close")}return(S,M)=>(G(),j("div",{class:nt(["structure-panel",{"structure-panel--minimized":g.value}])},[g.value?(G(),j("div",$y,[h("div",Py,[h("span",Ly,ee(o.value),1),h("span",Iy,ee(v.value),1)]),h("div",{class:"minimized-actions"},[h("button",{class:"mini-btn mini-btn--cancel",onClick:$,title:""},"  ")])])):(G(),j("div",Oy,[h("div",Dy,[h("div",Ny,[en(ee(o.value)+" ",1),h("span",{class:nt(["structure-panel__badge",{"structure-panel__badge--owned":i.value}])},ee(i.value?"":""),3)]),h("button",{class:"structure-panel__close",onClick:C,"aria-label":""},"")]),h("div",Hy,[h("div",Gy,[M[4]||(M[4]=h("div",{class:"structure-panel__health-label"},"",-1)),h("div",Fy,[h("div",{class:"structure-panel__health-fill",style:jt({width:p.value+"%",backgroundColor:m.value})},null,4)]),h("div",Uy,ee(Math.ceil(c.value))+" / "+ee(Math.ceil(d.value)),1)]),a.value?(G(),j("div",By,[M[5]||(M[5]=h("div",{class:"structure-panel__storage-label"},"",-1)),h("div",jy,[r.value?(G(),j("div",zy,[h("span",Vy,ee(Ae(Eo)(r.value)),1),h("span",Ky,"x"+ee(r.value.count||0),1)])):(G(),j("div",Wy,""))])])):we("",!0),e.resources&&e.resources.length>0?(G(),j("div",qy,[M[6]||(M[6]=h("div",{class:"structure-panel__ground-label"},"",-1)),h("div",Xy,[(G(!0),j(Be,null,Dt(e.resources,(F,X)=>(G(),j("div",{key:X,class:"structure-panel__ground-item"},[h("span",Yy,ee(F.name||""),1),h("span",Jy,"x"+ee(F.count||0),1)]))),128))])])):we("",!0),i.value?(G(),j("div",Zy,[l.value?(G(),j("button",{key:0,class:"structure-panel__action-btn structure-panel__action-btn--move",onClick:M[0]||(M[0]=F=>y("move"))},"  ")):we("",!0),u.value?(G(),j("button",{key:1,class:"structure-panel__action-btn structure-panel__action-btn--attack",onClick:M[1]||(M[1]=F=>y("attack"))},"  ")):we("",!0),a.value&&r.value?(G(),j("button",{key:2,class:"structure-panel__action-btn structure-panel__action-btn--transfer",onClick:M[2]||(M[2]=F=>y("transfer"))},"  ")):we("",!0),a.value?(G(),j("button",{key:3,class:"structure-panel__action-btn structure-panel__action-btn--extract",onClick:M[3]||(M[3]=F=>y("extract"))},"  ")):we("",!0)])):we("",!0)])]))],2))}},ev=ct(Qy,[["__scopeId","data-v-255f5486"]]),tv={class:"game-scene"},sv={key:4,class:"info-panel"},nv=["src"],ov=["src"],iv=["src"],av=["src"],rv=["src"],lv=.2,Va=.002,cv={__name:"GameScene",props:{isGameMode:{type:Boolean,default:!1},musicOn:{type:Boolean,default:!0}},emits:["back"],setup(e,{emit:t}){const s=e,n=Z(null),o=Z(null),i=oe("assets/gamescene.mp3"),a=Z(null),r=Z(null),l=Z(null),u=Z(null),c=oe("assets/move.mp3"),d=oe("assets/move_enemy.mp3"),p=oe("assets/attack.mp3"),m=oe("assets/attack_enemy.mp3");let g,v,y,$,C=[],S={focusPosition:null,focusTarget:null,lerpFactor:.08},M=null,F=new xt,X=null;const Y=new Map,P=new Map;function R(){Y.forEach((k,I)=>{const K=C.find(q=>q.id===I);K&&K.object&&(k.container.position.set(K.object.position.x,K.object.position.y+1,K.object.position.z),k.container.lookAt(v.position))})}const V={w:!1,a:!1,s:!1,d:!1,shift:!1,space:!1};function N(k){const I=k.key.toLowerCase();I==="w"||I==="a"||I==="s"||I==="d"?V[I]=!0:I==="shift"?V.shift=!0:I===" "&&(V.space=!0,k.preventDefault())}function b(k){const I=k.key.toLowerCase();I==="w"||I==="a"||I==="s"||I==="d"?V[I]=!1:I==="shift"?V.shift=!1:I===" "&&(V.space=!1)}let L=!1,O=0,B=0,ie=0,ae=0;function de(k){L=!0,O=k.clientX,B=k.clientY}function xe(){L=!1}function Ye(k){if(!L)return;const I=k.clientX-O,K=k.clientY-B;ae-=I*Va,ie-=K*Va,ie=Math.max(-Math.PI/2,Math.min(Math.PI/2,ie)),v.rotation.order="YXZ",v.rotation.y=ae,v.rotation.x=ie,O=k.clientX,B=k.clientY}const H=Z(null),ce=Z([]),Te=Z(null),et=Z(!1),ut=Z([]),He=Z([]),ke=Z(null),_t=Z(null),at=Z(!1),Je=Z(null),$t=Z([]),_=Z(null),w=Z(1),E=Z([]),U=Z(0),x=Z(null),z=ze(()=>{if(E.value.length===0)return null;const k=E.value[U.value];return k?k.id:null});Rt(async()=>{var I;f("[GameScene] "),se(),f("[GameScene] "),ue(),f("[GameScene] ");const{messageQueue:k}=await Al(async()=>{const{messageQueue:K}=await Promise.resolve().then(()=>rf);return{messageQueue:K}},void 0);if((I=k.sceneContext)!=null&&I.setTestMode&&k.sceneContext.setTestMode("eventloop"),window.__ACTUAL_COPPER_IDS__){const K=window.__ACTUAL_COPPER_IDS__;f("[GameScene] ID:",K);const q=JSON.stringify({type:"on_game_start",content:{ids:K}});_e(q).catch(le=>{f("[GameScene] ",le)}),delete window.__ACTUAL_COPPER_IDS__}window.addEventListener("keydown",N),window.addEventListener("keyup",b),window.addEventListener("mousedown",de),window.addEventListener("mouseup",xe),window.addEventListener("mousemove",Ye),Ge(),s.musicOn&&o.value&&setTimeout(()=>{if(o.value.readyState>=2)o.value.play().then(()=>{f("[GameScene] ")}).catch(q=>{f("[GameScene] :",q)});else{const q=()=>{o.value.play().then(()=>{f("[GameScene] ")}).catch(le=>{f("[GameScene] :",le)}),o.value.removeEventListener("canplay",q)};o.value.addEventListener("canplay",q,{once:!0})}},200)}),Nt(()=>s.musicOn,k=>{if(o.value)if(k)if(o.value.readyState>=2)o.value.play().catch(I=>{f("[GameScene] :",I)});else{const I=()=>{o.value.play().catch(K=>{f("[GameScene] :",K)}),o.value.removeEventListener("canplay",I)};o.value.addEventListener("canplay",I)}else o.value.pause()}),ys(()=>{window.removeEventListener("resize",Me),window.removeEventListener("click",Le),window.removeEventListener("keydown",N),window.removeEventListener("keyup",b),window.removeEventListener("mousedown",de),window.removeEventListener("mouseup",xe),window.removeEventListener("mousemove",Ye),o.value&&o.value.pause(),y&&y.dispose()});function se(){g=new fo,g.background=new os(2236962),v=new Rn(60,window.innerWidth/window.innerHeight,.1,2e3),v.position.set(0,5,10),M=new Wi,y=new ho({antialias:!0}),y.setSize(window.innerWidth,window.innerHeight),y.setPixelRatio(window.devicePixelRatio),n.value.appendChild(y.domElement),$=null;const k=new po(16777215,.8);g.add(k);const I=new hs(16777215,1);I.position.set(5,10,5),g.add(I),X=new ko;const K=new Ro;K.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),X.setDRACOLoader(K),s.isGameMode&&window.addEventListener("click",Le),Q(),f("[GameScene] "),f('[GameScene] - /(ID=1,2)""'),f("[GameScene] - EventLoop"),window.addEventListener("resize",Me)}function Q(){const k=new qt(.8,.8,.8),I=new kt({color:4491519}),K=new it(k,I);K.position.set(.5,.4,.5),g.add(K),C.push({id:1,object:K,name:"1",type:"test"});const q=new qt(.8,.8,.8),le=new kt({color:16729156}),re=new it(q,le);re.position.set(4.5,.4,4.5),g.add(re),C.push({id:2,object:re,name:"2",type:"test"}),f("[GameScene] :",C.map(rt=>`ID=${rt.id}`))}async function J(k,I,K,q=1){const le=Co(k,I);try{const re=await Lt.loadModel(le,!0);f(`[GameScene] : ${I}`);const rt=re.clone(!0);rt.traverse(D=>{D.material&&(Array.isArray(D.material)?D.material=D.material.map(te=>te.clone()):D.material=D.material.clone())});const Fe=new wt().setFromObject(rt).getSize(new Pe),T=new Xt;T.add(rt),T.position.set(K[0],0,K[1]),T.scale.set(q,q,q),T.rotation.y=0;const A=new wt().setFromObject(T);return T.position.y=-A.min.y,f(`[GameScene] : ${I}, URL: ${le}`),T}catch(re){return f(`[GameScene] : ${I}`,re),null}}async function W(k,I,K=1,q="model"){try{const le=await Lt.loadModel(k,!0);f(`[GameScene] : ${q}, url=${k}`);const re=le.clone(!0);re.traverse(T=>{T.material&&(Array.isArray(T.material)?T.material=T.material.map(A=>A.clone()):T.material=T.material.clone())});const Ze=new wt().setFromObject(re).getSize(new Pe),Fe=new Xt;return Fe.add(re),Fe.position.set(I[0],0,I[1]),Fe.scale.set(K,K,K),Fe}catch(le){return f(`[GameScene] : ${q}, url=${k}, error=${le}`),null}}async function he(k,I,K=1){const q=xo(k);try{const le=await Lt.loadModel(q,!0);f(`[GameScene] : ${k}`);const re=le.clone(!0);re.traverse(D=>{D.material&&(Array.isArray(D.material)?D.material=D.material.map(te=>te.clone()):D.material=D.material.clone())});const Ze=new wt().setFromObject(re).getSize(new Pe),Fe=new Xt;Fe.add(re),Fe.position.set(I[0],0,I[1]),Fe.scale.set(K,K,K),Fe.rotation.y=0;const T=new wt().setFromObject(Fe);Fe.position.y=-T.min.y;const A=new zs(16729156,2.5,12);return A.position.set(0,Ze.y*K*.8,0),Fe.add(A),f(`[GameScene] : ${k}, URL: ${q}`),Fe}catch(le){return f(`[GameScene] : ${k}`,le),null}}let ne=null;function ue(){const k=new Map,I=new Map,K=new Map;function q(T,A,D){const te=C.find(pe=>pe.id===T);if(!te||!te.object)return;let fe,$e;A==="move"?(fe=65280,$e=.8):A==="attack"?(fe=16711680,$e=1):A==="summon"?(fe=16776960,$e=1.2):(fe=16777215,$e=1),k.has(T)||k.set(T,{});const Se=k.get(T);if(Se[A]&&(g.remove(Se[A]),Se[A].geometry.dispose(),Se[A].material.dispose(),delete Se[A]),D){const pe=new qi($e-.1,$e,32),ve=new Bt({color:fe,side:Ds,transparent:!0,opacity:.6}),Ie=new it(pe,ve);Ie.rotation.x=-Math.PI/2,Ie.position.set(te.object.position.x,.1,te.object.position.z),g.add(Ie),Se[A]=Ie}}function le(T,A,D){const te=C.find(ve=>ve.id===T);if(!te||!te.object)return;const $e=te.type==="copper"?65280:16711680;if(!Y.has(T)){const De=new Xt,Ee=new Vn(1,.06),Re=new Bt({color:11184810,side:Ds,transparent:!0,opacity:.35}),Ke=new it(Ee,Re),tt=new Vn(1,.06),st=new Bt({color:$e,side:Ds}),je=new it(tt,st);je.position.z=.01,De.add(Ke),De.add(je),De.position.set(te.object.position.x,te.object.position.y+1,te.object.position.z),De.lookAt(v.position),g.add(De),Y.set(T,{container:De,background:Ke,foreground:je})}const Se=Y.get(T),pe=Math.max(0,Math.min(1,A/D));Se.foreground.scale.x=pe,Se.foreground.position.x=-1/2*(1-pe),Se.foreground.material&&Se.foreground.material.color&&Se.foreground.material.color.setHex($e),Se.container.position.set(te.object.position.x,te.object.position.y+1,te.object.position.z),Se.container.lookAt(v.position)}function re(T){if(Y.has(T)){const A=Y.get(T);g.remove(A.container),A.background.geometry.dispose(),A.background.material.dispose(),A.foreground.geometry.dispose(),A.foreground.material.dispose(),Y.delete(T)}}const rt=T=>{if(C.forEach(A=>{A.object&&(A.object.scale.set(1,1,1),A.object.traverse(D=>{var te;D.material&&((te=D.material.emissive)==null||te.setHex(0),D.material.emissiveIntensity!==void 0&&(D.material.emissiveIntensity=0))}))}),T!==null){const A=C.find(D=>D.id===T);if(A){A.object.scale.set(1.1,1.1,1.1),A.object.traverse(te=>{te.material&&te.material.emissive&&(te.material.emissive.setHex(16755200),te.material.emissiveIntensity=.5)});const D=A.type==="summon"?"":A.type==="copper"?"":"";f(`[GameScene] ${D}: ${A.name} (ID=${T})`)}}},Ze=(T,A,D)=>{const te=`${T[0]},${T[1]}`;if(P.has(te)){const pe=P.get(te);pe.material.color.setHex(A),pe.userData.type=D;return}const fe=new Vn(.9,.9),$e=new Bt({color:A,side:Ds,transparent:!0,opacity:.6}),Se=new it(fe,$e);Se.rotation.x=-Math.PI/2,Se.position.set(T[0],.08,T[1]),Se.userData={type:D,position:T},g.add(Se),P.set(te,Se)},Fe=T=>{const A=`${T[0]},${T[1]}`,D=P.get(A);f(`[GameScene] : =${T}, key=${A}, =${!!D}, =${P.size}`),D?(g.remove(D),D.geometry&&D.geometry.dispose(),D.material&&D.material.dispose(),P.delete(A),f(`[GameScene] : ${A}, =${P.size}`)):f(`[GameScene] : ${A}, keys:`,Array.from(P.keys()))};ne=(T,A)=>{const D=C.find(je=>je.id===T);if(!D)return;const te=new Map;D.object.traverse(je=>{je.material&&je.material.emissive&&(te.set(je,{color:je.material.emissive.getHex(),intensity:je.material.emissiveIntensity||0}),je.material.emissive.setHex(16711680),je.material.emissiveIntensity=.8)}),setTimeout(()=>{te.forEach((je,Mt)=>{Mt.material&&Mt.material.emissive&&(Mt.material.emissive.setHex(je.color),Mt.material.emissiveIntensity=je.intensity)})},500);const fe=D.object.position,$e=new Pe((A[0]-7)*1,.4,(A[1]-7)*1),Se=[fe,$e],pe=new bi().setFromPoints(Se),ve=new er({color:16729156,linewidth:3,transparent:!0,opacity:.8}),Ie=new tr(pe,ve);g.add(Ie);const De=new qi(.2,.4,32),Ee=new Bt({color:16711680,side:Ds,transparent:!0,opacity:.8}),Re=new it(De,Ee);Re.rotation.x=-Math.PI/2,Re.position.copy($e),Re.position.y=.5,g.add(Re);const Ke=performance.now(),tt=300;function st(){const Mt=(performance.now()-Ke)/tt;if(Mt<1){const nn=1-Mt;ve&&(ve.opacity=nn),Ee&&(Ee.opacity=nn),Re.scale.set(1+Mt*2,1+Mt*2,1),requestAnimationFrame(st)}else g.remove(Ie),g.remove(Re),pe.dispose(),ve.dispose(),De.dispose(),Ee.dispose()}st(),f(`[GameScene] : ID=${T}  ${A}`)},be.setSceneContext({scene:g,camera:v,controls:$,models:C,gridCellSize:1,focusState:S,focusOnModel:me,onShowCopperInfo:(T,A,D)=>{H.value=T,ce.value=A||[],et.value=D||!1,f(`[GameScene] : ID=${T.id}, has_attack_targets=${et.value}`)},onShowStructureInfo:(T,A)=>{var D;ke.value=T,_t.value={structure:T,resources:A},f(`[GameScene] : ID=${T.id}, =${(D=T.structure_base)==null?void 0:D.name}, =${T.now_health}/${T.structure_base.health}`)},highlightSelectedCopper:rt,floorBlocks:P,createAttackEffect:ne,onMoveComplete:T=>{if(!s.isGameMode)return;const A=C.find(te=>te.id===T);if((A==null?void 0:A.type)==="structure"){f("[GameScene] "),x.value=null,setTimeout(async()=>{await sn(T)},300);return}if(!E.value.some(te=>te.id===T)){f("[GameScene] ");return}f("[GameScene] "),x.value=null,Te.value&&Te.value.cancelAction(),setTimeout(async()=>{(A==null?void 0:A.type)==="summon"?await Dn(T,!1):await vs(T),setTimeout(()=>{if(ce.value&&ce.value.length>0){f("[GameScene] ");return}Ui()},100)},300)},onCraftResult:(T,A)=>{f(`[GameScene] : ${T?"":""} - ${A}`),alert(A)},onResourceNotEnough:T=>{f(`[GameScene] : ${T}`),alert(` ${T}`),x.value=null,_.value=null,at.value=!1,Je.value=null},onSummonFailed:T=>{f(`[GameScene] : ${T}`),alert(` ${T}`),x.value=null,at.value=!1,Je.value=null},onShowSummonMenu:T=>{f("[GameScene] :",T),$t.value=T||[]},onShowStructureMenu:T=>{var A;f("[GameScene] ",(T==null?void 0:T.length)||0,""),(A=Te.value)!=null&&A.showBuildMenu?Te.value.showBuildMenu(T||[]):f("[GameScene]  copperActionPanelRef.value.showBuildMenu ")},onRemoveCopper:T=>{const A=E.value.findIndex(D=>D.id===T);A>-1&&(f(`[GameScene] : ID=${T}`),E.value.splice(A,1),H.value&&H.value.id===T&&(H.value=null),U.value>=E.value.length&&E.value.length>0&&(U.value=0))},onAttackComplete:T=>{if(!s.isGameMode)return;const A=C.find(te=>te.id===T);if((A==null?void 0:A.type)==="structure"){f("[GameScene] "),x.value=null,setTimeout(async()=>{await sn(T)},300);return}if(!E.value.some(te=>te.id===T)){f("[GameScene] ");return}f("[GameScene] "),x.value=null,Te.value&&Te.value.cancelAction(),setTimeout(async()=>{(A==null?void 0:A.type)==="summon"?await Dn(T,!1):await vs(T),setTimeout(()=>{if(ce.value&&ce.value.length>0){f("[GameScene] ");return}Ui()},100)},300)},onSetMoveBlock:T=>{const A=`${T[0]},${T[1]}`;Ze(T,4521796,"move"),f(`[GameScene] : =${T}, key=${A}`)},onSetAttackBlock:T=>{if(x.value==="transferring"){ut.value.push(T);const A=C.find(D=>{if(D.type==="copper"&&D.object){const te=D.object.position;return Math.abs(te.x-T[0])<.1&&Math.abs(te.z-T[1])<.1}return!1});if(A){const D=E.value.find(fe=>fe.id===A.id);He.value.find(fe=>fe.id===A.id)||(He.value.push({id:A.id,name:A.name||(D?D.name:` #${A.id}`)||` #${A.id}`,position:T}),f(`[GameScene] : ${A.name||A.id} (ID=${A.id}), =${He.value.length}`))}else f(`[GameScene]  ${T} `)}else Ze(T,16729156,"attack"),et.value=!0,f(`[GameScene] : ${T}`)},onSetCanSummonBlock:T=>{const A=`${T[0]},${T[1]}`;Ze(T,16776960,"summon"),f(`[GameScene] : =${T}, key=${A}`)},onClearBlock:T=>{Fe(T)},onSetCopper:async(T,A,D)=>{var De,Ee,Re,Ke;if(f(`[GameScene] : id=${D.id}, pos=${A}`),C.find(tt=>tt.id===D.id)){f(`[GameScene] ID=${D.id}`);return}if(s.isGameMode){const tt={id:D.id,name:((De=D.copper.copper_info)==null?void 0:De.name)||` #${D.id}`,turnDone:!1},st=E.value.length===0;E.value.find(je=>je.id===D.id)||(E.value.push(tt),f(`[GameScene] : ${tt.name}`),st&&setTimeout(()=>{f(`[GameScene] : ${tt.name}`),vs(D.id)},500))}const fe=D.copper.copper_type||"Arcanist",$e=((Ee=D.copper.copper_info)==null?void 0:Ee.name)||"default",Se=(Re=D.copper.copper_info)==null?void 0:Re.model_url;let pe=1;switch(fe){case"IronWall":pe=1.2;break;case"Arcanist":pe=1;break;case"Mechanic":pe=1.1;break;case"Resonator":pe=1;break;case"CraftsMan":pe=1;break;default:pe=1}let ve;if(Se&&Se.includes("/enemy/")){const tt=oe(Se);if(f(`[GameScene] URL: ${Se} -> ${tt}`),ve=await W(tt,A,pe,$e),ve){const je=new wt().setFromObject(ve).getSize(new Pe),Mt=new wt().setFromObject(ve);ve.position.y=-Mt.min.y;const nn=new zs(4474111,2.5,12);nn.position.set(0,je.y*pe*.8,0),ve.add(nn)}}else{const tt=Rm($e),st=$m(fe);f(`[GameScene] : =${$e}, =${tt}, type=${fe}, typeFolder=${st}`),ve=await J(st,tt,A,pe)}if(!ve){f(`[GameScene] : ${$e}`);const tt=new qt(.8,.8,.8);let st=4491519;switch(fe){case"IronWall":st=8947848;break;case"Arcanist":st=16729224;break;case"Mechanic":st=4521864;break;case"Resonator":st=16755268;break;case"CraftsMan":st=4474111;break}const je=new kt({color:st});ve=new it(tt,je),ve.position.set(A[0],.4,A[1])}ve.userData.modelId=D.id,g.add(ve);const Ie={id:D.id,object:ve,name:((Ke=D.copper.copper_info)==null?void 0:Ke.name)||`Copper_${D.id}`,type:"copper"};C.push(Ie),f(`[GameScene] : ${Ie.name} (ID=${D.id})`)},onSetEnemy:async(T,A,D)=>{var De,Ee,Re,Ke,tt;const te=D.id,fe=D.owned||!1;if(f(`[GameScene] : id=${te}, pos=${A}, owned=${fe}`),C.find(st=>st.id===te)){f(`[GameScene] ID=${te}`);return}const pe=(((De=D.enemy_base)==null?void 0:De.enemy_type)||"").toLowerCase()||"goblin";let ve=1;switch(pe){case"demon":case"glutton":case"devourer":ve=1.5;break;case"guard":case"horn":ve=1.2;break;default:ve=1}let Ie=await he(pe,A,ve);if(!Ie){f(`[GameScene] : ${pe}`);const st=new qt(.8,.8,.8),je=new kt({color:fe?4474111:16711680});Ie=new it(st,je),Ie.position.set(A[0],.4,A[1])}if(fe&&Ie){const je=new wt().setFromObject(Ie).getSize(new Pe),Mt=new zs(4474111,2.5,12);Mt.position.set(0,je.y*ve*.8,0),Ie.add(Mt),f(`[GameScene] : ${pe}`)}Ie.userData.modelId=te,g.add(Ie),C.push({id:te,object:Ie,name:((Ee=D.enemy_base)==null?void 0:Ee.enemy_type)||`Enemy_${te}`,type:fe?"summon":"enemy"}),D.now_health!==void 0&&((Re=D.enemy_base)==null?void 0:Re.health)!==void 0&&(le(te,D.now_health,D.enemy_base.health),f(`[GameScene] : ${pe} (${D.now_health}/${D.enemy_base.health})`)),fe&&(E.value.push({id:te,name:((Ke=D.enemy_base)==null?void 0:Ke.name)||pe,type:"summon",enemy:D}),f(`[GameScene] : ${pe} (ID=${te})`)),f(`[GameScene] : ${((tt=D.enemy_base)==null?void 0:tt.enemy_type)||te}, owned=${fe}`)},onSetMaterial:async(T,A,D)=>{var ve,Ie,De;if(f(`[GameScene] : id=${T}, pos=${A}, name=${(ve=D.material_base)==null?void 0:ve.name}`),C.find(Ee=>Ee.id===T)){f(`[GameScene] ID=${T}`);return}const fe=((Ie=D.material_base)==null?void 0:Ie.name)||"",$e=(De=D.material_base)==null?void 0:De.model_url;if(!$e){f("[GameScene] model_url");const Ee=new qt(.5,.5,.5),Re=new kt({color:16755200,metalness:.3,roughness:.7}),Ke=new it(Ee,Re);Ke.position.set(A[0],.25,A[1]),Ke.userData.modelId=T,g.add(Ke),C.push({id:T,object:Ke,name:fe||`Material_${T}`,type:"material"});return}const Se=Xd($e);let pe=null;try{const Ee=await Lt.loadModel(Se,!0),Re=new Xt;Re.add(Ee),Re.position.set(A[0],0,A[1]),Re.scale.set(1,1,1),Re.rotation.y=0;const Ke=new wt().setFromObject(Re);Re.position.y=-Ke.min.y,pe=Re,f(`[GameScene] : ${fe}, URL: ${Se}`)}catch(Ee){f(`[GameScene] : ${fe}`,Ee);const Re=new qt(.5,.5,.5),Ke=new kt({color:16755200,metalness:.3,roughness:.7});pe=new it(Re,Ke),pe.position.set(A[0],.25,A[1])}pe.userData.modelId=T,g.add(pe),C.push({id:T,object:pe,name:fe||`Material_${T}`,type:"material"}),f(`[GameScene] : ${fe}`)},onSetStructure:async(T,A,D)=>{var ve,Ie;if(f(`[GameScene] : id=${T}, pos=${A}`),C.find(De=>De.id===T)){f(`[GameScene] ID=${T}`);return}const fe=((ve=D.structure_base)==null?void 0:ve.name)||"",$e=Lm(fe),Se=Tl($e);let pe=null;try{const De=await Lt.loadModel(Se,!0),Ee=new Xt;Ee.add(De),Ee.position.set(A[0],0,A[1]),Ee.scale.set(1,1,1),Ee.rotation.y=0;const Re=new wt().setFromObject(Ee);Ee.position.y=-Re.min.y,pe=Ee,f(`[GameScene] : ${fe}, URL: ${Se}`)}catch(De){f(`[GameScene] : ${fe}`,De);const Ee=new qt(.9,1.2,.9),Re=new kt({color:6710886,metalness:.5,roughness:.6});pe=new it(Ee,Re),pe.position.set(A[0],.6,A[1])}pe.userData.modelId=T,g.add(pe),C.push({id:T,object:pe,name:fe||`Structure_${T}`,type:"structure"}),f(`[GameScene] : ${fe}`),D.now_health!==void 0&&((Ie=D.structure_base)!=null&&Ie.health)&&(le(T,D.now_health,D.structure_base.health),f(`[GameScene] : ${fe} (${D.now_health}/${D.structure_base.health})`))},onPutResourceMarker:T=>{const A=`${T[0]},${T[1]}`;if(K.has(A)){const Re=K.get(A);g.remove(Re),Re.traverse(Ke=>{Ke.geometry&&Ke.geometry.dispose(),Ke.material&&(Array.isArray(Ke.material)?Ke.material.forEach(tt=>tt.dispose()):Ke.material.dispose())}),K.delete(A)}const D=new Xt,te=new yc(.15,.2,.25,8),fe=new kt({color:16766720,emissive:16755200,emissiveIntensity:.6,metalness:.7,roughness:.3}),$e=new it(te,fe);$e.position.y=.125,D.add($e);const Se=new vc(.08,8,8),pe=new kt({color:16776960,emissive:16776960,emissiveIntensity:1}),ve=new it(Se,pe);ve.position.y=.3,D.add(ve);const Ie=T[0],De=T[1];D.position.set(Ie,.15,De);const Ee=new zs(16766720,1.5,3);Ee.position.set(0,.3,0),D.add(Ee),g.add(D),K.set(A,D)},onClearResourceMarker:T=>{const A=`${T[0]},${T[1]}`;if(K.has(A)){const D=K.get(A);g.remove(D),D.traverse(te=>{te.geometry&&te.geometry.dispose(),te.material&&(Array.isArray(te.material)?te.material.forEach(fe=>fe.dispose()):te.material.dispose())}),K.delete(A)}},onDisplayCanMove:(T,A)=>{f(`[GameScene] : id=${T}, show=${A}`),q(T,"move",A),H.value&&H.value.id===T&&(H.value={...H.value,can_move:A},f(`[GameScene] selectedCopper.can_move=${A}`))},onDisplayCanAttack:(T,A)=>{f(`[GameScene] : id=${T}, show=${A}`),q(T,"attack",A),H.value&&H.value.id===T&&(H.value={...H.value,can_attack:A},f(`[GameScene] selectedCopper.can_attack=${A}`))},onDisplayCanSummon:(T,A)=>{f(`[GameScene] : id=${T}, show=${A}`),q(T,"summon",A),H.value&&H.value.id===T&&(H.value={...H.value,can_summon:A},f(`[GameScene] selectedCopper.can_summon=${A}`))},onClearState:T=>{if(f(`[GameScene] : id=${T}`),k.has(T)){const A=k.get(T);A.move&&(g.remove(A.move),A.move.geometry.dispose(),A.move.material.dispose(),delete A.move),A.attack&&(g.remove(A.attack),A.attack.geometry.dispose(),A.attack.material.dispose(),delete A.attack),A.summon&&(g.remove(A.summon),A.summon.geometry.dispose(),A.summon.material.dispose(),delete A.summon),k.delete(T)}},onUpdateHealth:(T,A,D)=>{f(`[GameScene] : id=${T}, hp=${A}/${D}`),le(T,A,D)},onRemoveHealthBar:T=>{f(`[GameScene] : id=${T}`),re(T)},onPutMapBlock:T=>{const A=`${T[0]},${T[1]}`;if(I.has(A)){const $e=I.get(A);g.remove($e),$e.geometry.dispose(),$e.material.dispose()}const D=new qt(.9,.05,.9),te=new Bt({color:8421504}),fe=new it(D,te);fe.position.set(T[0],.025,T[1]),g.add(fe),I.set(A,fe)},animateModelMove:(T,A,D)=>{if(!T||!T.object)return;const te=T.type==="enemy",fe=te?r.value:a.value;fe&&(fe.currentTime=0,fe.play().catch(De=>{f(`[GameScene]  (${te?"":""}):`,De)})),T.isMoving=!0;const $e=T.object.position.clone(),Se=new Pe(A.x,A.y,A.z),pe=500,ve=performance.now();function Ie(){if(!T||!T.object){D&&D();return}const De=performance.now()-ve,Ee=Math.min(De/pe,1),Re=1-Math.pow(1-Ee,2);T.object.position.lerpVectors($e,Se,Re),Ee<1?requestAnimationFrame(Ie):(T.object.position.copy(Se),T.isMoving=!1,D&&D())}Ie()},setTestMode:T=>{f(`[GameScene] ${T==="backend"?"":"EventLoop"}`),C.forEach(A=>{A.type==="test"?A.object.visible=T==="backend":(A.type==="copper"||A.type==="enemy")&&(A.object.visible=T==="eventloop")}),f(`[GameScene] ${T==="backend"?"":""}${T==="eventloop"?"":""}EventLoop`)}}),f("[GameScene] ")}function me(k,I,K){const q=new Pe;k.getWorldPosition(q);const le=window.cameraFocusDistance||8,re=window.cameraFocusHeight||6,rt=0,Ze=le;return{focusPosition:new Pe(q.x+rt,q.y+re,q.z+Ze).clone(),focusTarget:q.clone(),lerpFactor:.1}}function Me(){v.aspect=window.innerWidth/window.innerHeight,v.updateProjectionMatrix(),y.setSize(window.innerWidth,window.innerHeight)}function Ge(){if(requestAnimationFrame(Ge),V.w||V.a||V.s||V.d||V.shift||V.space){const k=new Pe;V.w&&(k.z-=1),V.s&&(k.z+=1),V.a&&(k.x-=1),V.d&&(k.x+=1),V.shift&&(k.y-=1),V.space&&(k.y+=1),k.applyQuaternion(v.quaternion),k.y=V.shift?-1:V.space?1:0,v.position.add(k.multiplyScalar(lv))}S.focusPosition&&S.focusTarget&&(v.position.lerp(S.focusPosition,S.lerpFactor),v.lookAt(S.focusTarget),ae=v.rotation.y,ie=v.rotation.x,v.position.distanceTo(S.focusPosition)<.5&&(f("[GameScene] "),S.focusPosition=null,S.focusTarget=null)),R(),y.render(g,v)}function Le(k){if(k.target.tagName!=="CANVAS")return;if(F.x=k.clientX/window.innerWidth*2-1,F.y=-(k.clientY/window.innerHeight)*2+1,M.setFromCamera(F,v),x.value==="moving"||x.value==="attacking"||x.value==="summoning"||x.value==="building"||x.value==="transferring"||x.value==="structureMoving"||x.value==="structureAttacking"||x.value==="structureExtract"||x.value==="structureTransfer"){ht(F);return}const I=C.filter(q=>(q.type==="copper"||q.type==="summon"||q.type==="enemy"||q.type==="structure")&&q.object).map(q=>q.object),K=M.intersectObjects(I,!0);if(K.length>0){let q=K[0].object;for(;q.parent&&!q.userData.modelId;)q=q.parent;const le=q.userData.modelId;if(le!==void 0){const re=C.find(Fe=>Fe.id===le),Ze={copper:"",summon:"",enemy:"",structure:""}[re==null?void 0:re.type]||"";f(`[GameScene] ${Ze}ID:`,le),(re==null?void 0:re.type)==="summon"||(re==null?void 0:re.type)==="enemy"?Dn(le,(re==null?void 0:re.type)==="enemy"):(re==null?void 0:re.type)==="structure"?sn(le):vs(le)}}else H.value=null,ke.value=null}async function ht(k){const I=new or(new Pe(0,1,0),0),K=new Wi;K.setFromCamera(k,v);const q=new Pe;if(K.ray.intersectPlane(I,q),q){const le=Math.round(q.x),re=Math.round(q.z);f(`[GameScene] : (${le}, ${re})`);const rt=`${le},${re}`,Ze=P.get(rt);if(!Ze){f(`[GameScene]  (${le}, ${re}) `);return}const Fe={moving:"move",attacking:"attack",summoning:"summon",building:"summon",structureMoving:"move",structureAttacking:"attack",structureExtract:"attack",structureTransfer:"attack"}[x.value];if(Ze.userData.type!==Fe){f(`[GameScene] : expected=${Fe}, actual=${Ze.userData.type}`);return}x.value==="moving"?await pt(le,re):x.value==="attacking"?await Ht(le,re):x.value==="summoning"?await Gt(le,re):x.value==="building"?await ks(le,re):x.value==="structureMoving"?await Ol(le,re):x.value==="structureAttacking"?await Dl(le,re):x.value==="structureExtract"?await Nl(le,re):x.value==="structureTransfer"&&await Hl(le,re)}}async function pt(k,I){if(!H.value)return;const K=H.value.isOwnedEnemy===!0,q=K?"on_enemy_move_apply":"on_move_apply";f(`[GameScene] : (${k}, ${I}), =${K?"":""}, =${q}`);const le=JSON.stringify({type:q,content:{id:String(H.value.id),position:{x:String(k),y:String(I)}}});await _e(le)}async function Ht(k,I){if(!H.value)return;const K=H.value.isOwnedEnemy===!0,q=K?"on_enemy_attack_apply":"on_attack_apply";f(`[GameScene] : (${k}, ${I}), =${K?"":""}, =${q}`);const le=H.value.id,re=C.find(Ze=>Ze.id===le);if(re){const Ze=re.type==="enemy",Fe=Ze?u.value:l.value;Fe&&(Fe.currentTime=0,Fe.play().catch(T=>{f(`[GameScene]  (${Ze?"":""}):`,T)})),ne&&ne(le,[k,I])}const rt=JSON.stringify({type:q,content:{id:String(H.value.id),position:{x:String(k),y:String(I)}}});await _e(rt)}async function Gt(k,I){if(!H.value)return;f(`[GameScene] : (${k}, ${I})`),Je.value=[k,I];const K=JSON.stringify({type:"on_get_summon_menu"});await _e(K),await new Promise(q=>setTimeout(q,100)),at.value=!0}async function ks(k,I){if(!H.value||!_.value)return;f(`[GameScene]  ${_.value} : (${k}, ${I})`);const K=JSON.stringify({type:"on_structure_build_apply",content:{id:String(H.value.id),position:{x:String(k),y:String(I)},name:_.value}});await _e(K),x.value=null,_.value=null,Te.value&&Te.value.cancelAction()}async function Ln(k){if(!H.value||!Je.value)return;const[I,K]=Je.value;f(`[GameScene]  ${k} : (${I}, ${K})`);try{const q=JSON.stringify({type:"on_summon_apply",content:{id:String(H.value.id),position:{x:String(I),y:String(K)},name:k}});await _e(q)}catch(q){f("[GameScene] :",q)}finally{at.value=!1,x.value=null,Je.value=null,Te.value&&Te.value.cancelAction();try{const q=JSON.stringify({type:"on_summon_end"});await _e(q)}catch(q){f("[GameScene] :",q)}}}function yt(){at.value=!1,Je.value=null,x.value=null;const k=JSON.stringify({type:"on_summon_end"});_e(k).catch(I=>{f("[GameScene] ",I)})}function Pt(){if(f("[GameScene] "),x.value==="structureMoving"){const k=JSON.stringify({type:"on_structure_move_end"});_e(k).catch(I=>{f("[GameScene] ",I)})}else if(x.value==="structureAttacking"){const k=JSON.stringify({type:"on_structure_attack_end"});_e(k).catch(I=>{f("[GameScene] ",I)})}else if(x.value==="structureExtract"){const k=JSON.stringify({type:"on_structure_extract_end"});_e(k).catch(I=>{f("[GameScene] ",I)})}else if(x.value==="structureTransfer"){const k=JSON.stringify({type:"on_structure_transfer_end"});_e(k).catch(I=>{f("[GameScene] ",I)})}x.value=null}function In(){Pt(),ke.value=null,_t.value=null,f("[GameScene] ")}async function On(k){if(!ke.value)return;const I=ke.value.id;switch(f(`[GameScene] : ${k.type}, ID=${I}`),k.type){case"move":await $l(I);break;case"attack":await Pl(I);break;case"transfer":await Il(I);break;case"extract":await Ll(I);break;default:f("[GameScene] :",k.type)}}async function $l(k){f(`[GameScene]  ${k} `);const I=JSON.stringify({type:"on_structure_move_start",content:{id:String(k)}});await _e(I),x.value="structureMoving"}async function Pl(k){f(`[GameScene]  ${k} `);const I=JSON.stringify({type:"on_structure_attack_start",content:{id:String(k)}});await _e(I),x.value="structureAttacking"}async function Ll(k){f(`[GameScene]  ${k} `);const I=JSON.stringify({type:"on_structure_extract_start",content:{id:String(k)}});await _e(I),x.value="structureExtract"}async function Il(k){f(`[GameScene]  ${k} `);const I=JSON.stringify({type:"on_structure_transfer_start",content:{id:String(k)}});await _e(I),x.value="structureTransfer"}async function Ol(k,I){if(!ke.value)return;f(`[GameScene]  ${ke.value.id}  (${k}, ${I})`);const K=JSON.stringify({type:"on_structure_move_apply",content:{id:String(ke.value.id),position:{x:String(k),y:String(I)}}});await _e(K),x.value=null}async function Dl(k,I){if(!ke.value)return;f(`[GameScene]  ${ke.value.id}  (${k}, ${I})`);const K=JSON.stringify({type:"on_structure_attack_apply",content:{id:String(ke.value.id),position:{x:String(k),y:String(I)}}});await _e(K),x.value=null}async function Nl(k,I){if(!ke.value)return;f(`[GameScene]  ${ke.value.id}  (${k}, ${I}) `);const K=ke.value.id,q=JSON.stringify({type:"on_structure_extract_apply",content:{id:String(K),position:{x:String(k),y:String(I)}}});await _e(q),f("[GameScene] ");const le=JSON.stringify({type:"on_structure_extract_end"});await _e(le),await new Promise(re=>setTimeout(re,100)),f("[GameScene] "),x.value=null,setTimeout(async()=>{f("[GameScene] "),await sn(K)},300)}async function Hl(k,I){if(!ke.value)return;f(`[GameScene]  ${ke.value.id}  (${k}, ${I}) `);const K=ke.value.id,q=JSON.stringify({type:"on_structure_transfer_apply",content:{id:String(K),position:{x:String(k),y:String(I)}}});await _e(q),f("[GameScene] ");const le=JSON.stringify({type:"on_structure_transfer_end"});await _e(le),await new Promise(re=>setTimeout(re,100)),f("[GameScene] "),x.value=null,setTimeout(async()=>{f("[GameScene] "),await sn(K)},300)}async function vs(k){const I=E.value.findIndex(q=>q.id===k);I!==-1&&(U.value=I),ke.value=null;const K=JSON.stringify({type:"on_click_copper",content:{id:String(k)}});await _e(K)}async function sn(k){f(`[GameScene] : ID=${k}`),H.value=null;const I=JSON.stringify({type:"on_click_structure",content:{id:String(k)}});await _e(I)}async function Dn(k,I=!1){if(!I){const q=E.value.findIndex(le=>le.id===k);q!==-1&&(U.value=q)}ke.value=null;const K=JSON.stringify({type:"on_click_enemy",content:{id:String(k)}});await _e(K)}function Gl(){H.value=null,ce.value=[],x.value=null}async function Fl(k){if(f("[GameScene] :",k),k.type==="moveStart")x.value="moving";else if(k.type==="attackStart")x.value="attacking";else if(k.type==="summonStart")x.value="summoning";else if(k.type==="buildRequest"){f("[GameScene] ");const I=JSON.stringify({type:"on_get_structure_menu"});await _e(I)}else if(k.type==="buildStart")x.value="building",_.value=k.structureName||null;else if(k.type==="transferring"||k.type==="transferStart")x.value="transferring",ut.value=[],He.value=[];else if(k.type==="transferComplete")x.value=null,ut.value=[],He.value=[];else if(k.type==="cancel"){const I=x.value;if(I==="moving"){const K=JSON.stringify({type:"on_move_end"});_e(K).catch(q=>{f("[GameScene] ",q)})}else if(I==="attacking"){const K=JSON.stringify({type:"on_attack_end"});_e(K).catch(q=>{f("[GameScene] ",q)})}else if(I==="transferring"){const K=JSON.stringify({type:"on_transfer_end"});_e(K).catch(q=>{f("[GameScene] ",q)}),ut.value=[],He.value=[]}else if(I==="summoning"){const K=JSON.stringify({type:"on_summon_end"});_e(K).catch(q=>{f("[GameScene] ",q)}),at.value=!1}else if(I==="building"){const K=JSON.stringify({type:"on_structure_build_end"});_e(K).catch(q=>{f("[GameScene] ",q)}),_.value=null,Je.value=null}x.value=null}else k.type==="wait"&&(f("[GameScene] "),$o())}function Ui(){if(E.value.length!==0){if(H.value){const k=H.value.can_move,I=H.value.can_attack,K=H.value.can_summon;if(f(`[GameScene] : ID=${H.value.id}, can_move=${k}, can_attack=${I}, can_summon=${K}, hasAttackTargets=${et.value}`),k||I&&et.value||K){f("[GameScene] ");return}}f("[GameScene] "),$o()}}async function $o(){var K,q,le;if(E.value.length===0)return;H.value=null,x.value=null,U.value;let k=0;const I=E.value.length;for(;k<I;){U.value=(U.value+1)%E.value.length;const re=E.value[U.value];f(`[GameScene] : ${re.name||re.id} ( ${k+1}/${I})`),await new Promise(A=>{setTimeout(async()=>{const D=C.find(fe=>fe.id===re.id);(D==null?void 0:D.type)==="summon"?await Dn(re.id,!1):await vs(re.id),A()},300)}),await new Promise(A=>setTimeout(A,200));const rt=((K=H.value)==null?void 0:K.can_move)||!1,Ze=((q=H.value)==null?void 0:q.can_attack)||!1,Fe=((le=H.value)==null?void 0:le.can_summon)||!1,T=rt||Ze&&et.value||Fe;if(f(`[GameScene]  ${re.name}: can_move=${rt}, can_attack=${Ze}, can_summon=${Fe}, hasTargets=${et.value}, valid=${T}`),H.value&&T){f(`[GameScene] : ${re.name||re.id}`);return}k++}f("[GameScene] "),H.value=null,s.isGameMode&&f('[GameScene] ""')}function Ul(){w.value++,U.value=0,H.value=null,x.value=null,E.value.forEach(k=>k.turnDone=!1),f(`[GameScene]  ${w.value}`),E.value.length>0&&setTimeout(()=>{const k=E.value[0];f(`[GameScene] : ${k.name}`),vs(k.id)},500)}return(k,I)=>{var K,q,le,re;return G(),j("div",tv,[h("div",{ref_key:"container",ref:n,class:"scene-container"},null,512),e.isGameMode?(G(),Ot(ey,{key:0,currentCopperId:z.value,copperList:E.value,roundNumber:w.value,onNextCopper:$o,onEndRound:Ul,onSelectCopper:vs},null,8,["currentCopperId","copperList","roundNumber"])):we("",!0),e.isGameMode&&H.value?(G(),Ot(U_,{key:1,ref_key:"copperActionPanelRef",ref:Te,copper:H.value,resources:ce.value,hasAttackTargets:et.value,transferTargets:He.value,onSelectCopper:vs,onClose:Gl,onAction:Fl},null,8,["copper","resources","hasAttackTargets","transferTargets"])):we("",!0),e.isGameMode?(G(),Ot(Ry,{key:2,visible:at.value,"copper-name":((le=(q=(K=H.value)==null?void 0:K.copper)==null?void 0:q.copper_info)==null?void 0:le.name)||"","enemy-list":$t.value,position:Je.value,onClose:yt,onSummon:Ln},null,8,["visible","copper-name","enemy-list","position"])):we("",!0),e.isGameMode&&ke.value?(G(),Ot(ev,{key:3,structure:ke.value,resources:((re=_t.value)==null?void 0:re.resources)||[],"action-mode":x.value==="structureMoving"?"move":x.value==="structureAttacking"?"attack":x.value==="structureExtract"?"extract":x.value==="structureTransfer"?"transfer":null,onClose:In,onAction:On,onCancel:Pt},null,8,["structure","resources","action-mode"])):we("",!0),e.isGameMode?we("",!0):(G(),j("div",sv,[...I[0]||(I[0]=[hi('<h3 data-v-bd83eec5>3D</h3><p style="color:#ffd700;font-weight:600;" data-v-bd83eec5> </p><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-bd83eec5><p style="font-weight:600;" data-v-bd83eec5> </p><p style="font-size:12px;" data-v-bd83eec5>  = ID:1</p><p style="font-size:12px;" data-v-bd83eec5>  = ID:2</p></div><div style="margin:8px 0;padding:8px;background:rgba(255, 255, 255, 0.1);border-radius:6px;" data-v-bd83eec5><p style="font-weight:600;" data-v-bd83eec5> EventLoop</p><p style="font-size:12px;" data-v-bd83eec5>1.   EventLoop</p><p style="font-size:12px;" data-v-bd83eec5>2. &quot; &quot;</p><p style="font-size:12px;" data-v-bd83eec5>3. 3</p><p style="font-size:11px;" data-v-bd83eec5>  =IronWall  =Arcanist  =CraftsMan </p></div>',4)])])),h("audio",{ref_key:"audioRef",ref:o,src:Ae(i),loop:"",preload:"auto"},null,8,nv),h("audio",{ref_key:"moveSoundRef",ref:a,src:Ae(c),preload:"auto"},null,8,ov),h("audio",{ref_key:"moveEnemySoundRef",ref:r,src:Ae(d),preload:"auto"},null,8,iv),h("audio",{ref_key:"attackSoundRef",ref:l,src:Ae(p),preload:"auto"},null,8,av),h("audio",{ref_key:"attackEnemySoundRef",ref:u,src:Ae(m),preload:"auto"},null,8,rv)])}}},uv=ct(cv,[["__scopeId","data-v-bd83eec5"]]),dv={class:"stage"},fv={key:0,style:{position:"relative",width:"100%",height:"100%"}},hv={key:2,class:"modal"},pv={class:"modal-title"},mv={key:2,class:"overlay",style:{"z-index":"30000","align-items":"flex-start","justify-content":"flex-start",background:"rgba(0, 0, 0, 0.25)"}},gv={class:"settings"},_v={class:"settings__content"},yv={__name:"App",setup(e){const t=Z(!1),s=Z(null),n=Z(!1),o=Z(null),i=Z([]);Z(0);const a=Z(!0),r=Z(!1),l=Z(!1);let u=null;function c(P){s.value!==P&&(i.value.push(s.value),s.value=P),window.__START_MENU_PAUSE__&&window.__START_MENU_PAUSE__(),t.value=!0}function d(){a.value=!1,u&&clearTimeout(u),u=setTimeout(()=>{a.value||(f("[App] StartMenu"),l.value=!0)},5*60*1e3)}function p(){s.value=null,i.value=[],window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),t.value=!1}function m(P){f("[App] ID:",P.ids),p(),r.value=!0,f("[App] ")}function g(){r.value=!1}function v(){n.value=!0,t.value=!0}function y(){n.value=!1,s.value||(window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__(),t.value=!1)}function $(){if(n.value){y();return}if(s.value){if(s.value==="warehouse"&&o.value&&o.value.handleBack&&o.value.handleBack())return;const P=i.value.pop()??null;s.value=P,P||(t.value=!1);return}if(!a.value){u&&(clearTimeout(u),u=null),l.value&&(l.value=!1,f("[App] StartMenu")),a.value=!0,setTimeout(()=>{window.__INIT_THREE_SCENE__?window.__INIT_THREE_SCENE__().then(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}).catch(()=>{window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()}):window.__START_MENU_RESUME__&&window.__START_MENU_RESUME__()},100),t.value=!1;return}}const C=Z(!0),S=Z(null);function M(){C.value=!C.value,f("[App] :",C.value?"":"")}function F(){try{const P={version:1,savedAt:Date.now(),payload:{}},R=new Blob([JSON.stringify(P,null,2)],{type:"application/json"}),V=document.createElement("a");V.href=URL.createObjectURL(R),V.download="save.json",V.click(),URL.revokeObjectURL(V.href)}catch{}}function X(){try{S.value&&S.value.click()}catch{}}function Y(P){try{const R=P.target&&P.target.files&&P.target.files[0];if(!R)return;const V=new FileReader;V.onload=()=>{try{JSON.parse(String(V.result||"{}"))}catch{}P.target.value=""},V.readAsText(R)}catch{}}return Rt(()=>{Cl(P=>{})}),ys(()=>{u&&(clearTimeout(u),u=null)}),(P,R)=>(G(),j("div",dv,[r.value?(G(),Ot(uv,{key:0,isGameMode:!0,"music-on":C.value,onBack:g},null,8,["music-on"])):we("",!0),r.value?we("",!0):(G(),j(Be,{key:1},[l.value?we("",!0):Nr((G(),Ot(Np,{key:0,visible:a.value,onStarted:d},null,8,["visible"])),[[bl,a.value]]),a.value?we("",!0):(G(),Ot(Ua,{key:1,"music-on":C.value,onBack:$,onOpenSettings:v,onToggleMusic:M},null,8,["music-on"])),Qe(Qd,{"music-on":C.value,paused:s.value==="start"||s.value==="warehouse"||r.value,onStartGame:R[0]||(R[0]=V=>c("start")),onOpenWarehouse:R[1]||(R[1]=V=>c("warehouse")),onOpenTutorial:R[2]||(R[2]=V=>c("tutorial")),onOpenEncyclopedia:R[3]||(R[3]=V=>c("encyclopedia")),onToggleMusic:M},null,8,["music-on","paused"]),s.value?(G(),j("div",{key:2,class:nt(["overlay",{"overlay--warehouse":s.value==="warehouse"}])},[s.value==="warehouse"?(G(),j("div",fv,[Qe(Ua,{"music-on":C.value,onBack:$,onOpenSettings:v,onToggleMusic:M},null,8,["music-on"]),Qe(wp,{ref_key:"warehouseRef",ref:o,"music-on":C.value},null,8,["music-on"])])):s.value==="start"?(G(),Ot(xm,{key:1,"music-on":C.value,paused:r.value,onClose:p,onConfirm:m},null,8,["music-on","paused"])):(G(),j("div",hv,[h("h2",pv,ee(s.value==="warehouse"?"  Copper Warehouse":s.value==="tutorial"?"  Tutorial":s.value==="encyclopedia"?"  Game Encyclopedia":"  Start Game"),1),R[4]||(R[4]=h("p",{class:"modal-body"},"",-1)),h("button",{class:"close-btn",onClick:p},"")]))],2)):we("",!0)],64)),n.value?(G(),j("div",mv,[h("div",gv,[h("div",{class:"settings__header"},[R[6]||(R[6]=h("div",{class:"settings__title"},"",-1)),h("button",{class:"settings__close",onClick:y,"aria-label":""},[...R[5]||(R[5]=[h("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[h("path",{d:"M18 6L6 18M6 6l12 12",stroke:"#fff","stroke-width":"2","stroke-linecap":"round"})],-1)])])]),h("div",_v,[h("button",{class:"settings__item",onClick:F},[...R[7]||(R[7]=[hi('<span class="settings__icon" data-v-b3f9ee5d><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b3f9ee5d><path d="M12 3v12m0 0l-4-4m4 4l4-4" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b3f9ee5d></path><path d="M4 19h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-b3f9ee5d></path></svg></span><span class="settings__label" data-v-b3f9ee5d></span>',2)])]),h("button",{class:"settings__item",onClick:X},[...R[8]||(R[8]=[hi('<span class="settings__icon" data-v-b3f9ee5d><svg width="44" height="44" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-b3f9ee5d><path d="M12 21V9m0 0l4 4m-4-4L8 13" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-b3f9ee5d></path><path d="M4 5h16" stroke="#fff" stroke-width="2" stroke-linecap="round" data-v-b3f9ee5d></path></svg></span><span class="settings__label" data-v-b3f9ee5d></span>',2)])]),h("input",{ref_key:"fileInput",ref:S,type:"file",accept:".json",onChange:Y,style:{display:"none"}},null,544)])])])):we("",!0)]))}},Ka=ct(yv,[["__scopeId","data-v-b3f9ee5d"]]);function vv(){const e=navigator.userAgent;return/Safari/.test(e)&&!/Chrome/.test(e)&&!/Chromium/.test(e)}function bv(){const e=document.getElementById("safari-warning"),t=document.getElementById("loading-screen");e.style.display="flex",t.style.display="none",document.getElementById("continue-safari").addEventListener("click",()=>{e.style.display="none",t.style.display="flex",Rl()}),document.getElementById("download-chrome").addEventListener("click",()=>{window.open("https://www.google.com/chrome/","_blank")})}function Jo(e,t,s,n=""){const o=document.getElementById("progress-bar"),i=document.getElementById("progress-text"),a=document.querySelector(".loading-subtitle");o&&(o.style.width=s+"%"),i&&(e===0&&t===0?i.textContent=`${s}%`:i.textContent=`${e} / ${t} (${s}%)`),a&&n&&(a.textContent=n)}function Wa(){const e=document.getElementById("loading-screen");e&&(e.classList.add("fade-out"),setTimeout(()=>{e.style.display="none"},500))}async function Rl(){try{f("..."),await _i(Jo,["high"]),f(""),Jo(0,100,100,"..."),$a(Ka).mount("#app"),await new Promise(t=>setTimeout(t,200)),window.__INIT_THREE_SCENE__&&await window.__INIT_THREE_SCENE__((t,s,n)=>{Jo(0,0,n,`3D... ${n}%`)}),f(""),setTimeout(()=>{Wa()},300),setTimeout(async()=>{try{f("..."),await _i(null,["medium"]),f("")}catch(t){f(":",t)}},1e3)}catch(e){f(":",e),$a(Ka).mount("#app"),Wa()}}vv()?(f("Safari"),bv()):(f("Safari"),Rl());
